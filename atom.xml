<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mr.Drive2Far</title>
  
  <subtitle>开过头先生的主页</subtitle>
  <link href="https://www.cssass.com/atom.xml" rel="self"/>
  
  <link href="https://www.cssass.com/"/>
  <updated>2023-06-29T05:50:11.791Z</updated>
  <id>https://www.cssass.com/</id>
  
  <author>
    <name>Neo One</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>天命：响应式布局的单位——VW/VH</title>
    <link href="https://www.cssass.com/2023/06/29/%E5%A4%A9%E5%91%BD%EF%BC%9A%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80%E7%9A%84%E5%8D%95%E4%BD%8D%E2%80%94%E2%80%94VW-VH/"/>
    <id>https://www.cssass.com/2023/06/29/%E5%A4%A9%E5%91%BD%EF%BC%9A%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80%E7%9A%84%E5%8D%95%E4%BD%8D%E2%80%94%E2%80%94VW-VH/</id>
    <published>2023-06-29T05:22:11.000Z</published>
    <updated>2023-06-29T05:50:11.791Z</updated>
    
    <content type="html"><![CDATA[<p>本文最早发布于知乎的一个回答：<a href="https://www.zhihu.com/question/37179916/answer/101810379" title="" target="">vw相比rem，在实际开发中究竟有多大区别？</a><br>几年前，人们谈论响应式布局的时候，必会提到一个单位：rem，其基于rem的布局思路影响一直持续到今天。那么rem是否是最好的呢？有没有更合理的布局结局方案呢？以下是原文：</p><p>我认为基于vw开发布局比基于rem不知道要高明到哪里去了。</p><p>vw可以轻松搞定弹性布局，流体布局。而网上那些吹捧rem的文章，所用的响应式适配方案都是基于弹性布局的。流体布局？人家说了，流体布局不好，见 <a href="https://isux.tencent.com/web-app-rem.html" title="" target="">web app变革之rem</a></p><p>vw逻辑非常清晰，”1vw ＝ 1&#x2F;100th viewport width”，用viewport width的百分比来设置element width。rem是什么？“The font size of the root element”，就是说你用它来布局，就相当于用font size 来设置 width size，中间你要转一道。<br>基于以上，我也发出了题主的疑问，为什么rem这种单位会被用来布局，而vw这种天生的布局单位缺鲜有人关注？</p><p>所以今天深扒了一下关于这两个单位在 W3C组织 的邮件组里的讨论，<br>rem这个单位，我能找到的最早讨论是在2002年4月，一封比较各种样式语言的邮件中：<a href="http://lists.w3.org/Archives/Public/www-style/2002Apr/0010.html">http://lists.w3.org/Archives/Public/www-style/2002Apr/0010.html</a> ，</p><blockquote><p>CSS3 would just need a unit relative to the Root element’s EM – say, ‘rem’</p></blockquote><p>之后有理由相信，rem最晚在2003年8月，已经被讨论组内人士所公认，并有可能已处在 w3c 工作组成员的笔记之中：<a href="http://lists.w3.org/Archives/Public/www-style/2003Aug/0044.html">http://lists.w3.org/Archives/Public/www-style/2003Aug/0044.html</a></p><blockquote><p>According to my experience, when some authors look for exotic ways to define size of some element, it really comes to trying to define size of that element relative to viewport size. Nowadays, one has to use percentages and carefully compute size of every element from root to the element one wants to set size for. This is logical addition to ‘rem’ unit (root’s em).</p></blockquote><p>邮件的作者此时也提出了两个单位：</p><blockquote><p>vpw: viewport width<br>vph: viewport height</p></blockquote><p>仔细一看，这不就是现在的vw 和 vh 么。</p><p>其实，再早半年，也已经有人提出了与 vw 和 vh 接近的概念：<a href="http://lists.w3.org/Archives/Public/www-style/2003Feb/0110.html">http://lists.w3.org/Archives/Public/www-style/2003Feb/0110.html</a></p><blockquote><p>The unit should be relative to the screen (or paper) width.<br>The unit should be referenced to the preferred screen resolution.</p><p>I suggest those units:<br>sw8 &#x3D; (screen.width &#x2F; 800 ) px;<br>sw12 &#x3D; (screen.width &#x2F; 1200 ) px;<br>sw16 &#x3D; (screen.width &#x2F; 1600 ) px;<br>sw24 &#x3D; (screen.width &#x2F; 2400 ) px;</p></blockquote><p>2005年3月，从一封讨论CSS运算表达式的邮件里 <a href="http://lists.w3.org/Archives/Public/www-style/2005Mar/0057.html">http://lists.w3.org/Archives/Public/www-style/2005Mar/0057.html</a> 可以确定 vw 已基本被定下，同时被定下的还有vh 和 vm (也就是后来的vmin)：</p><blockquote><p>the working group recently decided to investigate the implications of allowing simple, linear expressions as values.</p><p>Some common cases can be done without expressions, by means of a few new units:</p><p>gd &#x3D; the grid unit from CSS3 Text<br>rem &#x3D; the font size of the root element<br>vw &#x3D; the viewport width (or 1&#x2F;100th of it)<br>vh &#x3D; the viewport height (or 1&#x2F;100th of it)<br>vm &#x3D; min(vw, vh)</p></blockquote><p>当然</p><blockquote><p>There is not even a draft yet, though.</p></blockquote><p>不过话音刚落，到了当年7月26日，working draft 发布： CSS3 Values and Units</p><p>此次是第二次发布CSS3 Values and Units草案，距离首次发布已经过去整整4年，显而易见： ren, vw, vh, vm 是同时进的草案。</p><p>之后，2012年3月8日，vm 更改为 vmin。2012年8月28日，发布Candidate Recommendation（备选标准），增加 vmax。截止到现在，CSS3 Values and Units依然处于备选标准阶段，并不是一个正式标准，CSS Values and Units Module Level 3。</p><p>但俨然它是一个事实标准，因为浏览器厂商从来不是等标准确定后才付之实施，否则就会落后于人。我猜也不乏浏览器厂家在事先实现了某个features，继而正式递交工作组要求成为标准的，当然大多数浏览器厂商本身就是标准制定组成员。所以，虽然同时进入标准，rem 和 vw 的命运还得看浏览器厂家们是否积极去实现。</p><p>我们来看看 rem 和 vw 在 Moliza 家的待遇：<br>2009-01-05：有用户提交bug要求支持rem：472195 – support css3 root em (‘rem’ or ‘re’) units<br>2009-07-11：有用户提交bug要求实现vw：503720 – Implement vw&#x2F;vh&#x2F;vmin&#x2F;vmax (viewport sizes) from CSS 3 Values and Units<br>相差半年<br>2010-1-21: Firefox3.6发布，支持rem：Firefox 3.6 for developers<br>2013-2-19: Firefox 19发布，支持vw：Firefox 19 for developers<br>晚了三年</p><p>其它各家皆是如此，厚此而薄彼，就导致了如下的支持度差异：<br>rem：</p><img src="https://pic2.zhimg.com/b4f035b1007996aba311cab004425179_b.png" class=""><p>vw:</p><img src="https://pic4.zhimg.com/a6df85f2f4c38db8ff30da6f5276362f_b.png" class=""><p>回到原题，vw被支持的太晚是其并不流行的根本原因，而当时移动端web app&#x2F;page的开发需求已经十分旺盛，弹性布局是一种不错的移动端界面兼容展现方式，对于rem机遇就此而来，便成为一个实现弹性布局效果的极佳方案。</p><p>其实看目前状况，对vw最不利的是Android Browser，据我调查Android Browser 4.4以下的还占全部Android Browser的 9% 左右, 这个量还是不容忽视的。</p><p>好在既然所有最新浏览器都已经支持，那么随着时间推移，相信未来vw必将会流行。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文最早发布于知乎的一个回答：&lt;a href=&quot;https://www.zhihu.com/question/37179916/answer/101810379&quot; title=&quot;&quot; target=&quot;&quot;&gt;vw相比rem，在实际开发中究竟有多大区别？&lt;/a&gt;&lt;br&gt;几年前，人们</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Date对象初始化Month，Day参数的奇葩设定的解释</title>
    <link href="https://www.cssass.com/2014/08/16/Date%E5%AF%B9%E8%B1%A1%E5%88%9D%E5%A7%8B%E5%8C%96Month%EF%BC%8CDay%E5%8F%82%E6%95%B0%E7%9A%84%E5%A5%87%E8%91%A9%E8%AE%BE%E5%AE%9A%E7%9A%84%E8%A7%A3%E9%87%8A/"/>
    <id>https://www.cssass.com/2014/08/16/Date%E5%AF%B9%E8%B1%A1%E5%88%9D%E5%A7%8B%E5%8C%96Month%EF%BC%8CDay%E5%8F%82%E6%95%B0%E7%9A%84%E5%A5%87%E8%91%A9%E8%AE%BE%E5%AE%9A%E7%9A%84%E8%A7%A3%E9%87%8A/</id>
    <published>2014-08-16T05:11:07.000Z</published>
    <updated>2023-06-29T05:17:33.170Z</updated>
    
    <content type="html"><![CDATA[<p>new一个Date对象时，当以年份Y，月份M，日期D为参数传入来设定的时候，我们会发现：月份M是从0开始的，而日期D却是从1开始的。<br>即：M:0是一月，1是二月，11是十二月，但D：1 是一号，2是二号，31是三十一号。<br>如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var t1 = new Date(2014,0,1).toLocaleString(),</span><br><span class="line">t2 = new Date(2014,1,2).toLocaleString(),</span><br><span class="line">t3 = new Date(2014,11,29).toLocaleString()</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,0,&quot;&amp;nbsp;&quot;,1,&quot;&lt;br /&gt;&quot;,t1,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,1,&quot;&amp;nbsp;&quot;,2,&quot;&lt;br /&gt;&quot;,t2,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,11,&quot;&amp;nbsp;&quot;,29,&quot;&lt;br /&gt;&quot;,t3,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>是不是觉得很别扭，很奇葩？</p><p>对于习惯了以“一月”称呼“January”，“二月”称呼“February”的人来说，让”0″和”一”对应，”1″和”二”对应肯定是超级别扭啊，<br>但对于计算机从业者来说倒合情合理，第一位都是0开始数的嘛。</p><p>那问题抛向了另一边，为什么Day又是从1开始呢？<br>那么我告诉你1Day其实根本不是数组的第一项，日期的初始也是0！<br>当1Day完成的时候，时间就已经过去了二十四小时，1Day已经结束了。<br>所以0Day才是days的开始，那么我们来看看0Day到底是什么时候，让我们从1Day开始往前回溯，其实我们将每一天的开始设在了前夜。<br>如果按小数来细分的话，每月1号的正午应该算是0.5号，而10号的下午6点就是九又四分之三号！</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var t3 = new Date(2014,11,29).toLocaleString(),</span><br><span class="line">t2 = new Date(2014,1,2).toLocaleString(),</span><br><span class="line">t1 = new Date(2014,0,1).toLocaleString(),</span><br><span class="line">t0 = new Date(2014,0,0).toLocaleString();</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,11,&quot;&amp;nbsp;&quot;,29,&quot;&lt;br /&gt;&quot;,t3,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,1,&quot;&amp;nbsp;&quot;,2,&quot;&lt;br /&gt;&quot;,t2,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,0,&quot;&amp;nbsp;&quot;,1,&quot;&lt;br /&gt;&quot;,t1,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(2014,&quot;&amp;nbsp;&quot;,0,&quot;&amp;nbsp;&quot;,0,&quot;&lt;br /&gt;&quot;,t0,&quot;&lt;br /&gt;&lt;br /&gt;&quot;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>0Day的设计，其实还有一个巨大的好处，我们调用new Date就可以轻松拿到当月的最后一号，而不用你自己去考虑大小月、闰年2月。<br>如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var t1 = new Date(2014,1,0).toLocaleString(),</span><br><span class="line">t2 = new Date(2014,2,0).toLocaleString(),</span><br><span class="line">t3 = new Date(2014,3,0).toLocaleString(),</span><br><span class="line">t4 = new Date(2014,4,0).toLocaleString();</span><br><span class="line">document.write(t1,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(t2,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(t3,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(t4,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>全文结束。<br>插一个小问题，在知乎上看见有人提问javascript 里面为什么不提供date的格式化函数？其实在Firefox上是提供了一个toLocaleFormat方法的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">(function()&#123;</span><br><span class="line">if(!new Date().toLocaleFormat) return alert(&quot;Date has no method &#x27;toLocaleFormat&#x27;&quot;);</span><br><span class="line">var t1 = new Date().toLocaleFormat(&quot;%y/%m/%d&quot;);</span><br><span class="line">t2 = new Date(&quot;2015,2,14&quot;).toLocaleFormat(&quot;%y-%m-%d&quot;);</span><br><span class="line">t3 = new Date(1391012219050).toLocaleFormat();</span><br><span class="line">document.write(t1,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(t2,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">document.write(t3,&quot;&lt;br /&gt;&quot;);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;new一个Date对象时，当以年份Y，月份M，日期D为参数传入来设定的时候，我们会发现：月份M是从0开始的，而日期D却是从1开始的。&lt;br&gt;即：M:0是一月，1是二月，11是十二月，但D：1 是一号，2是二号，31是三十一号。&lt;br&gt;如下：&lt;/p&gt;
&lt;figure clas</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Unicode中的Emoji表情字符</title>
    <link href="https://www.cssass.com/2014/05/09/Unicode%E4%B8%AD%E7%9A%84Emoji%E8%A1%A8%E6%83%85%E5%AD%97%E7%AC%A6/"/>
    <id>https://www.cssass.com/2014/05/09/Unicode%E4%B8%AD%E7%9A%84Emoji%E8%A1%A8%E6%83%85%E5%AD%97%E7%AC%A6/</id>
    <published>2014-05-09T03:37:28.000Z</published>
    <updated>2023-06-29T05:18:49.625Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line">&lt;title&gt;Unicode6.0字符显示&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body&#123;font-size:50px;padding:20px;&#125;</span><br><span class="line">h3&#123;padding:20px 10px;background:#eee;&#125;</span><br><span class="line">p&#123;word-wrap:break-word;border:1px solid #ccc; padding:10px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=&quot;showcode&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var code = &quot;&lt;h3&gt;Emoticons&lt;/h3&gt;&lt;p&gt;&quot;;</span><br><span class="line">for(var i = 0x1f600 ; i &lt;= 0x1f64f; i = i + 1 )&#123;</span><br><span class="line">code += &quot;&amp;#&quot; + i + &quot;;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">code += &quot;&lt;h3&gt;Miscellaneous Symbols And Pictographs&lt;/h3&gt;&lt;p&gt;&quot;;</span><br><span class="line">for(var i = 0x1F300 ; i &lt;= 0x1F5FF; i = i + 1 )&#123;</span><br><span class="line">code += &quot;&amp;#&quot; + i + &quot;;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">code += &quot;&lt;h3&gt;Playing Cards&lt;/h3&gt;&lt;p&gt;&quot;;</span><br><span class="line">for(var i = 0x1F0A0 ; i &lt;= 0x1F0FF; i = i + 1 )&#123;</span><br><span class="line">code += &quot;&amp;#&quot; + i + &quot;;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">code += &quot;&lt;h3&gt;Transport And Map symbols&lt;/h3&gt;&lt;p&gt;&quot;;</span><br><span class="line">for(var i = 0x1F680 ; i &lt;= 0x1F6FF; i = i + 1 )&#123;</span><br><span class="line">code += &quot;&amp;#&quot; + i + &quot;;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">code += &quot;&lt;h3&gt;Dingbats&lt;/h3&gt;&lt;p&gt;&quot;;</span><br><span class="line">for(var i = 0x2700 ; i &lt;= 0x27BF; i = i + 1 )&#123;</span><br><span class="line">code += &quot;&amp;#&quot; + i + &quot;;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">code += &quot;&lt;h3&gt;Miscellaneous Technical&lt;/h3&gt;&lt;p&gt;&quot;;</span><br><span class="line">for(var i = 0x2300 ; i &lt;= 0x23ff; i = i + 1 )&#123;</span><br><span class="line">code += &quot;&amp;#&quot; + i + &quot;;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$id(&quot;showcode&quot;).insertAdjacentHTML(&quot;beforeend&quot;,code);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>附一个QQ表情库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line">&lt;title&gt;QQ Emoticons&lt;/title&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">img &#123;padding:10px;margin:10px;border:3px double #eee;border-radius:8px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;showEmo&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var $id = function(o)&#123;</span><br><span class="line">return document.getElementById(o);</span><br><span class="line">&#125;;</span><br><span class="line">var Emo = &#123;</span><br><span class="line">url : &quot;http://ctc.qzonestyle.gtimg.cn/qzone/em/e&quot;,</span><br><span class="line">index : 0,</span><br><span class="line">removeArr : &#123;205:300,371:500,778:829,954:1000,1012:1500,1503:2000,2074:2172,2325:2801,2804:3000,3079:3173,3200:4001,4021:4300,4302:4400,4411:6001,6096:7000,7450:10000,10075:100000,100179:100491,100730:110000,110157:120000,120043:121001,121036:326980,326981:327183,327184:327343,327570:327743,328710:332445&#125;,</span><br><span class="line">getEmoStr : function(start,num)&#123;</span><br><span class="line">var str = &quot;&quot;;</span><br><span class="line">Emo.index = start + num;</span><br><span class="line">for(var i = start; i &lt; Emo.index; i++)&#123;</span><br><span class="line">if(i in Emo.removeArr)&#123;</span><br><span class="line">Emo.index =  Emo.removeArr[i];</span><br><span class="line">str += &quot;&lt;br /&gt;&quot;;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">str += &quot;&lt;img title=&quot;+i+&quot; src=&quot; + Emo.url + i + &quot;.gif /&gt;&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">return str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var showDIV = $id(&quot;showEmo&quot;);</span><br><span class="line">showDIV.insertAdjacentHTML(&quot;beforeend&quot;,Emo.getEmoStr(Emo.index, 1000));</span><br><span class="line">window.onscroll=function()&#123;</span><br><span class="line">var scrollTop = document.body.scrollTop || document.documentElement.scrollTop,</span><br><span class="line">windowHeight = document.documentElement.clientHeight,</span><br><span class="line">documentHeight = document.body.offsetHeight;</span><br><span class="line">if(windowHeight + scrollTop &gt; documentHeight - 50 )&#123;</span><br><span class="line">showDIV.insertAdjacentHTML(&quot;beforeend&quot;,Emo.getEmoStr(Emo.index, 200));</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>鲸鱼夫妇</title>
    <link href="https://www.cssass.com/2013/07/09/%E9%B2%B8%E9%B1%BC%E5%A4%AB%E5%A6%87/"/>
    <id>https://www.cssass.com/2013/07/09/%E9%B2%B8%E9%B1%BC%E5%A4%AB%E5%A6%87/</id>
    <published>2013-07-09T03:27:15.000Z</published>
    <updated>2023-06-29T05:19:25.674Z</updated>
    
    <content type="html"><![CDATA[<p>写了个小东西，用于展示JS语言中类的模拟。已发布到chrome应用商店：安装地址，可以在chrome浏览器上添加这个扩展应用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">function inherit(klass,parent)&#123;</span><br><span class="line">function F()&#123;&#125;</span><br><span class="line">F.prototype = parent.prototype;</span><br><span class="line">klass.prototype = new F();</span><br><span class="line">klass.prototype.constructor = klass;</span><br><span class="line">return klass;</span><br><span class="line">&#125;</span><br><span class="line">function getRandInt(min, max) &#123;</span><br><span class="line">return (Math.random() * (max - min) + min) &gt;&gt; 0;</span><br><span class="line">&#125;</span><br><span class="line">var family = [];</span><br><span class="line">function Whale(options)&#123;</span><br><span class="line">var self = this;</span><br><span class="line">(function(options) &#123;</span><br><span class="line">self.option = &#123;</span><br><span class="line">size : [240, 120],</span><br><span class="line">pos : [0, 0],</span><br><span class="line">speed : [6, 2],</span><br><span class="line">spritX : [10, -3360],</span><br><span class="line">spritY : 0</span><br><span class="line">&#125;;</span><br><span class="line">extendCopy(options || &#123;&#125;, self.options);</span><br><span class="line">&#125;)();</span><br><span class="line">this.gender = &#x27;male&#x27;</span><br><span class="line">this.init();</span><br><span class="line">&#125;</span><br><span class="line">Whale.prototype = &#123;</span><br><span class="line">init : function()&#123;</span><br><span class="line">this.create();</span><br><span class="line">this.play();</span><br><span class="line">this.swim();</span><br><span class="line">family.push(this);</span><br><span class="line">&#125;,</span><br><span class="line">create : function()&#123;</span><br><span class="line">var that = this;</span><br><span class="line">var whaleBox = document.createElement(&quot;DIV&quot;);</span><br><span class="line">whaleBox.className = &quot;whale&quot;;</span><br><span class="line">whaleBox.style.width = this.option.size[0] + &quot;px&quot;;</span><br><span class="line">whaleBox.style.height = this.option.size[1] + &quot;px&quot;;</span><br><span class="line">document.body.appendChild(whaleBox);</span><br><span class="line">events.addEvent(whaleBox, &quot;mousedown&quot;, function()&#123;</span><br><span class="line">var e = arguments[0] || window.event;</span><br><span class="line">that._drag(e);</span><br><span class="line">&#125;);</span><br><span class="line">this.whaleBox = whaleBox;</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">_swimTimer : null,</span><br><span class="line">swim : function()&#123;</span><br><span class="line">var that = this,</span><br><span class="line">pos = this.option.pos,</span><br><span class="line">speed = this.option.speed,</span><br><span class="line">step = [Math.abs(this.option.speed[0]), Math.abs(this.option.speed[1])],</span><br><span class="line">dir = [speed[0]/step[0], speed[1]/step[1]],</span><br><span class="line">size = this.option.size;</span><br><span class="line">var moveX = 0,</span><br><span class="line">moveY = 0;</span><br><span class="line">this._swimTimer = setInterval(function()&#123;</span><br><span class="line">moveX = dir[0] * getRandInt(1,step[0]);</span><br><span class="line">moveY = dir[1] * getRandInt(1,step[1]);</span><br><span class="line">if(pos[0] + moveX &gt; Whale.windowSize[0] - size[0] || pos[0] + moveX &lt; 0 )&#123;</span><br><span class="line">//边境时候掉头</span><br><span class="line">moveX = 0;</span><br><span class="line">speed[0] = - speed[0];</span><br><span class="line">dir[0] = - dir[0];</span><br><span class="line">that.option.spritY += dir[0] * size[1];</span><br><span class="line">that.play();</span><br><span class="line">&#125;</span><br><span class="line">if(pos[1] + moveX &gt; Whale.windowSize[1] - size[1] || pos[1] + moveY &lt; 0 )&#123;</span><br><span class="line">moveY = 0;</span><br><span class="line">speed[1] = - speed[1];</span><br><span class="line">dir[1] = - dir[1];</span><br><span class="line">&#125;</span><br><span class="line">pos[0] += moveX;</span><br><span class="line">pos[1] += moveY;</span><br><span class="line">that.whaleBox.style.left = pos[0] + &quot;px&quot;;</span><br><span class="line">that.whaleBox.style.top = pos[1] + &quot;px&quot;;</span><br><span class="line">&#125;,200);</span><br><span class="line">&#125;,</span><br><span class="line">hook : function()&#123;</span><br><span class="line"> clearInterval(this._swimTimer);</span><br><span class="line">&#125;,</span><br><span class="line">_playTimer : null,</span><br><span class="line">play : function()&#123;</span><br><span class="line">var that = this,</span><br><span class="line">s = Math.abs(this.option.speed[0]),</span><br><span class="line">spritX = this.option.spritX,</span><br><span class="line">x = spritX[0], //sprite开始位置</span><br><span class="line">y = this.option.spritY;</span><br><span class="line">clearInterval(this._playTimer);</span><br><span class="line">this._playTimer = setInterval(function()&#123;</span><br><span class="line">x = (x &lt;= spritX[1]) ? spritX[0] : x;</span><br><span class="line">that.whaleBox.style.cssText += &quot;background-position:&quot;+x+&quot;px &quot;+ y +&quot;px;&quot;;</span><br><span class="line">x -= that.option.size[0];</span><br><span class="line">&#125;,1000/s/1);</span><br><span class="line">&#125;,</span><br><span class="line">_drag : function(e)&#123;</span><br><span class="line">var that = this;</span><br><span class="line">var whaleBox = that.whaleBox;</span><br><span class="line">var sX = whaleBox.offsetLeft,</span><br><span class="line">sY = whaleBox.offsetTop,</span><br><span class="line">dx = e.clientX,</span><br><span class="line">dy = e.clientY;</span><br><span class="line">that.hook();</span><br><span class="line">whaleBox.style.zIndex = Whale.zIndex++;</span><br><span class="line">events.addEvent(document, &#x27;mousemove&#x27;, dragHandle);</span><br><span class="line">events.addEvent(document, &#x27;mouseup&#x27;, cancelDragHandle);</span><br><span class="line">var largeL = Whale.windowSize[0] -  this.option.size[0],</span><br><span class="line">largeT = Whale.windowSize[1] -  this.option.size[1];</span><br><span class="line">function dragHandle() &#123;</span><br><span class="line">var e = arguments[0] || window.event;</span><br><span class="line">var oX = sX + (e.clientX - dx),</span><br><span class="line">oY = sY + (e.clientY - dy);</span><br><span class="line">if(oX &gt; largeL || oX &lt; 0)&#123;</span><br><span class="line">oX = (oX &lt; 0) ? 0 : largeL</span><br><span class="line">&#125;</span><br><span class="line">if(oY &gt; largeT || oY &lt; 0)&#123;</span><br><span class="line">oY = (oY &lt; 0) ? 0 : largeT</span><br><span class="line">&#125;</span><br><span class="line">that.option.pos[0] = oX;</span><br><span class="line">that.option.pos[1] = oY;</span><br><span class="line">whaleBox.style.left = oX + &quot;px&quot;;</span><br><span class="line">whaleBox.style.top = oY + &quot;px&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">function cancelDragHandle() &#123;</span><br><span class="line">events.removeEvent(document, &#x27;mousemove&#x27;, dragHandle);</span><br><span class="line">events.removeEvent(document, &#x27;mouseup&#x27;, cancelDragHandle);</span><br><span class="line">that.swim();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Whale.zIndex = 1000;</span><br><span class="line">Whale.windowSize = [document.documentElement.offsetWidth, Math.max(document.documentElement.clientHeight, document.body.offsetHeight)];</span><br><span class="line">Whale.mating = function()&#123;</span><br><span class="line">for(var i= 0 ; i&lt; family.length; i++)&#123;</span><br><span class="line">if(family[i].gender !== &quot;male&quot;) continue;</span><br><span class="line">for(var j= 0; j&lt; family.length; j++)&#123;</span><br><span class="line">if(family[j].gender !== &quot;female&quot;) continue;</span><br><span class="line">if(Math.abs(family[i].option.pos[0] - family[j].option.pos[0]) &lt; 10 &amp;&amp; Math.abs(family[i].option.pos[1] - family[j].option.pos[1]) &lt; 10 &amp;&amp; !family[j].option.gestation)&#123;</span><br><span class="line">(function(j)&#123;</span><br><span class="line">family[j].option.gestation = true;</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">family[j].option.gestation = false;</span><br><span class="line">&#125;,5 * 60 * 1000);</span><br><span class="line">new WhaleBaby(&#123;pos:[family[j].option.pos[0] + 80, family[j].option.pos[1] + 30]&#125;);</span><br><span class="line">&#125;)(j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">function WhaleLady(options)&#123;</span><br><span class="line">var self = this;</span><br><span class="line">(function(options) &#123;</span><br><span class="line">self.option = &#123;</span><br><span class="line">size : [210, 100],</span><br><span class="line">pos : [80, 200],</span><br><span class="line">speed : [4, -2],</span><br><span class="line">spritX : [10, -2940],</span><br><span class="line">spritY : -300</span><br><span class="line">&#125;;</span><br><span class="line">extendCopy(options || &#123;&#125;, self.options);</span><br><span class="line">&#125;)();</span><br><span class="line">this.gender = &quot;female&quot;;</span><br><span class="line">this.gestation = false;</span><br><span class="line">this.init();</span><br><span class="line">&#125;</span><br><span class="line">function WhaleBaby(options)&#123;</span><br><span class="line">var self = this;</span><br><span class="line">(function(options) &#123;</span><br><span class="line">self.option = &#123;</span><br><span class="line">size : [120, 60],</span><br><span class="line">pos : [0, 100],</span><br><span class="line">speed : [7, -3],</span><br><span class="line">spritX : [2, -1650],</span><br><span class="line">spritY : -600</span><br><span class="line">&#125;;</span><br><span class="line">extendCopy(options || &#123;&#125;, self.option);</span><br><span class="line">&#125;)(options);</span><br><span class="line">this.init();</span><br><span class="line">&#125;</span><br><span class="line">inherit(WhaleLady, Whale);</span><br><span class="line">inherit(WhaleBaby, WhaleLady);</span><br><span class="line">var bb = new WhaleLady();</span><br><span class="line">var aa = new Whale();</span><br><span class="line">setInterval(Whale.mating,1000);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;写了个小东西，用于展示JS语言中类的模拟。已发布到chrome应用商店：安装地址，可以在chrome浏览器上添加这个扩展应用&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre</summary>
      
    
    
    
    
    <category term="JS" scheme="https://www.cssass.com/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>使用Threejs制作3D螺旋线</title>
    <link href="https://www.cssass.com/2013/02/06/%E4%BD%BF%E7%94%A8Threejs%E5%88%B6%E4%BD%9C3D%E8%9E%BA%E6%97%8B%E7%BA%BF/"/>
    <id>https://www.cssass.com/2013/02/06/%E4%BD%BF%E7%94%A8Threejs%E5%88%B6%E4%BD%9C3D%E8%9E%BA%E6%97%8B%E7%BA%BF/</id>
    <published>2013-02-06T03:31:36.000Z</published>
    <updated>2023-06-29T03:38:22.020Z</updated>
    
    <content type="html"><![CDATA[<p>做了一个3D螺旋线的生成器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Threejs制作3D螺旋线&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body&#123;background:#333;color:#fff;&#125;</span><br><span class="line">.controlBar&#123;position:absolute;&#125;</span><br><span class="line">#control ul&#123;width:150px;float:left;list-style:none;&#125;</span><br><span class="line">#control b&#123;position:relative;display:inline-block;width:120px;height:5px;font-size:0;line-height:0;background:#fff;border:1px solid #aaa;border-radius:2px;&#125;</span><br><span class="line">#control i&#123;position:absolute;cursor:pointer;top:-4px;left:50%;width:10px;height:10px;margin-left:-4px;border:1px solid #d3d3d3;background:#ececec;border-radius:2px;&#125;</span><br><span class="line">#control i:hover&#123;border:1px solid #999;background:#dcdcdc;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;/blog/resource/threejs/three.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;controlBar&quot;&gt;</span><br><span class="line">&lt;div id=&quot;control&quot;&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li&gt;x:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;85.2&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;y:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;205.2&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;z:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;-64.8&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li&gt;x:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;60&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;y:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;-49.8&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;z:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;184.8&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li&gt;x:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;225&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;y:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;-195&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;z:  &lt;b class=&#x27;range&#x27;&gt;&lt;i data-value=&#x27;195&#x27;&gt;&amp;nbsp;&lt;/i&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;button onclick=&quot;Producer.createPoints()&quot;&gt;增加操作点&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var controlElm = $id(&quot;control&quot;),</span><br><span class="line">iElm = $tag(&quot;i&quot;, controlElm);</span><br><span class="line">for(var i = 0; i &lt; iElm.length; i++)&#123;</span><br><span class="line">iElm[i].style.left = (iElm[i].dataset[&#x27;value&#x27;] - 0 + 300) * 100 /600 + &quot;%&quot;;</span><br><span class="line">&#125;</span><br><span class="line">var Producer = &#123;</span><br><span class="line">points : [],</span><br><span class="line">getPoints : function()&#123;</span><br><span class="line">Producer.points = [];</span><br><span class="line">var UL = $tag(&quot;UL&quot;, controlElm), item, jsondata;</span><br><span class="line">for(var i = 0 ; i &lt;UL.length; i++)&#123;</span><br><span class="line">item =  $tag(&quot;i&quot;,UL[i]);</span><br><span class="line">jsondata = &#123;</span><br><span class="line">x : item[0].dataset[&#x27;value&#x27;]-0,</span><br><span class="line">y : item[1].dataset[&#x27;value&#x27;]-0,</span><br><span class="line">z : item[2].dataset[&#x27;value&#x27;]-0,</span><br><span class="line">&#125;</span><br><span class="line">Producer.points.push(jsondata);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">createPoints : function()&#123;</span><br><span class="line">$id(&quot;control&quot;).insertAdjacentHTML(&#x27;beforeEnd&#x27;,$tag(&quot;UL&quot;,$id(&quot;control&quot;))[0].outerHTML);</span><br><span class="line">&#125;,</span><br><span class="line">changePoints : function(o,e)&#123;</span><br><span class="line">var l = 600;</span><br><span class="line">if(!window.event) &#123;e.preventDefault();&#125;</span><br><span class="line">var tX = o.offsetLeft,</span><br><span class="line">dx = e.clientX;</span><br><span class="line">events.addEvent(document,&#x27;mousemove&#x27;,mouseMove);</span><br><span class="line">events.addEvent(document,&#x27;mouseup&#x27;,mouseUp);</span><br><span class="line">function mouseMove()&#123;</span><br><span class="line">var e = arguments[0] || window.event;</span><br><span class="line">var len = tX + e.clientX - dx + 8, val;</span><br><span class="line">if(len &gt;=0 &amp;&amp; len &lt;= 120)&#123;</span><br><span class="line">var rat = (len / 120) * 100;</span><br><span class="line">o.style.left = rat+ &quot;%&quot;;</span><br><span class="line">val = l * Math.round((rat - 50)*10)/1000;</span><br><span class="line">o.dataset[&#x27;value&#x27;] = val;</span><br><span class="line">o.title = val;</span><br><span class="line">&#125;</span><br><span class="line">if(window.event) e.returnValue=false;</span><br><span class="line">&#125;</span><br><span class="line">function mouseUp()&#123;</span><br><span class="line">events.removeEvent(document,&#x27;mousemove&#x27;,mouseMove);</span><br><span class="line">events.removeEvent(document,&#x27;mouseup&#x27;,mouseUp);</span><br><span class="line">spiralDemo.init().animate();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">function Spiral3D()&#123;</span><br><span class="line">this.width = Math.max(1000, document.documentElement.offsetWidth);</span><br><span class="line">this.height = 800;</span><br><span class="line">this.camera = new THREE.PerspectiveCamera( 33, this.width / this.height, 1, 10000);</span><br><span class="line">this.scene = new THREE.Scene();</span><br><span class="line">this.renderer = null;</span><br><span class="line">this.create();</span><br><span class="line">&#125;</span><br><span class="line">Spiral3D.prototype = &#123;</span><br><span class="line">create : function()&#123;</span><br><span class="line">try&#123;</span><br><span class="line">this.renderer = new THREE.WebGLRenderer( &#123; antialias: true &#125; ); //webgl</span><br><span class="line">&#125;catch(e)&#123;</span><br><span class="line">this.renderer = new THREE.CanvasRenderer(); //canvas</span><br><span class="line">&#125;</span><br><span class="line">this.renderer.setSize( this.width, this.height);</span><br><span class="line">document.body.appendChild( this.renderer.domElement );</span><br><span class="line">this.init();</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">init : function() &#123;</span><br><span class="line">this.scene = new THREE.Scene();</span><br><span class="line">this.stop();</span><br><span class="line">Producer.getPoints();</span><br><span class="line">var spline = new THREE.Spline( Producer.points ),  //以关键点创建曲线</span><br><span class="line">geometry = new THREE.Geometry(),</span><br><span class="line">material = new THREE.LineBasicMaterial( &#123; color: 0xffffff, opacity: 1, linewidth: 1, vertexColors: THREE.VertexColors &#125; );</span><br><span class="line">//自动补全曲线点</span><br><span class="line">for ( var i =0, position, l = Producer.points.length * 7; i &lt; l; i ++ ) &#123;</span><br><span class="line">position = spline.getPoint( i/l );</span><br><span class="line">geometry.vertices[ i ] = new THREE.Vector3( position.x, position.y, position.z );</span><br><span class="line">geometry.colors[ i ] = new THREE.Color( 0x00ffff );</span><br><span class="line">geometry.colors[ i ].setHSV( ( 100 + position.x ) / 400 * i/8, ( 200 + position.x ) / 400, ( 250 + position.x ) / 300);</span><br><span class="line">&#125;</span><br><span class="line">//创建100条线</span><br><span class="line">for(var line, i=0, l = 100 ; i&lt;l; i++)&#123;</span><br><span class="line">line = new THREE.Line(geometry,  material);</span><br><span class="line">line.position = &#123;x: 0, y: 0, z: 0&#125;;</span><br><span class="line">if(i &gt; 0) &#123;</span><br><span class="line">line.rotation.y = Math.PI * 2 * (i/l);</span><br><span class="line">&#125;</span><br><span class="line">this.scene.add( line ); //将显示对象加入场景</span><br><span class="line">&#125;</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">render : function() &#123;</span><br><span class="line">var timer = Date.now() * 0.0005;</span><br><span class="line">this.camera.position.x = Math.cos( timer ) * 500;</span><br><span class="line">this.camera.position.z = Math.sin( timer ) * 500;</span><br><span class="line">this.camera.lookAt( this.scene.position );</span><br><span class="line">this.renderer.render( this.scene, this.camera ); //使用渲染器</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">_reqID : &#123;&#125;,</span><br><span class="line">animate : function() &#123;</span><br><span class="line">var that = this;</span><br><span class="line">var _loop = function()&#123;</span><br><span class="line">that._reqID = requestAnimationFrame( _loop );</span><br><span class="line">that.render();</span><br><span class="line">&#125;</span><br><span class="line">_loop();</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">stop : function()&#123;</span><br><span class="line">var that = this;</span><br><span class="line">cancelAnimationFrame(that._reqID);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">var spiralDemo = new Spiral3D();</span><br><span class="line">spiralDemo.animate();</span><br><span class="line">events.delegate(controlElm, &#x27;i&#x27;, &#x27;mousedown&#x27;,function()&#123;</span><br><span class="line">var e = arguments[0] || window.event,</span><br><span class="line">target = e.srcElement || e.target;</span><br><span class="line">Producer.changePoints(target,e);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>配套做一个动画效果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Threejs 3D lines&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body&#123;background:#333;color:#fff;overflow:hidden;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;/blog/resource/threejs/three.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var Producer = &#123;</span><br><span class="line">points : [&#123;</span><br><span class="line">x : 85.2,</span><br><span class="line">y : 205.2,</span><br><span class="line">z : -64.8,</span><br><span class="line">a : 1,</span><br><span class="line">b : 1,</span><br><span class="line">c : 1</span><br><span class="line">&#125;,&#123;</span><br><span class="line">x : 60,</span><br><span class="line">y : -49.8,</span><br><span class="line">z : 184.8,</span><br><span class="line">a : 1,</span><br><span class="line">b : 1,</span><br><span class="line">c : 2</span><br><span class="line">&#125;,&#123;</span><br><span class="line">x : 225,</span><br><span class="line">y : -195,</span><br><span class="line">z : 195,</span><br><span class="line">a : 1,</span><br><span class="line">b : 2,</span><br><span class="line">c : 1</span><br><span class="line">&#125;,&#123;</span><br><span class="line">x : 40,</span><br><span class="line">y : -40.8,</span><br><span class="line">z : 114.8,</span><br><span class="line">a : 2,</span><br><span class="line">b : 1,</span><br><span class="line">c : 1</span><br><span class="line">&#125;,&#123;</span><br><span class="line">x : 85.2,</span><br><span class="line">y : 105.2,</span><br><span class="line">z : -24.8,</span><br><span class="line">a : 2,</span><br><span class="line">b : 1,</span><br><span class="line">c : 1</span><br><span class="line">&#125;,&#123;</span><br><span class="line">x : 85.2,</span><br><span class="line">y : 205.2,</span><br><span class="line">z : -64.8,</span><br><span class="line">a : 1,</span><br><span class="line">b : 1,</span><br><span class="line">c : 1</span><br><span class="line">&#125;],</span><br><span class="line">changePoints : function()&#123;</span><br><span class="line">var points = Producer.points;</span><br><span class="line">for(var i = 0 ; i &lt; points.length; i++)&#123;</span><br><span class="line">item =  points[i];</span><br><span class="line">if(item.x &lt; -250 || item.x &gt; 250) item.a = -item.a;</span><br><span class="line">if(item.y &lt; -250 || item.y &gt; 250) item.b = -item.b;</span><br><span class="line">if(item.z &lt; -250 || item.z &gt; 250) item.c = -item.c;</span><br><span class="line">item.x -= item.a,</span><br><span class="line">item.y -= item.b,</span><br><span class="line">item.z -= item.c</span><br><span class="line">&#125;</span><br><span class="line">spiralDemo.init().animate();</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">function Spiral3D()&#123;</span><br><span class="line">this.width = document.documentElement.offsetWidth;</span><br><span class="line">this.height = Math.max(document.documentElement.clientHeight,document.body.offsetHeight);</span><br><span class="line">this.camera = new THREE.PerspectiveCamera( 33, this.width / this.height, 1, 10000);</span><br><span class="line">this.scene = new THREE.Scene();</span><br><span class="line">this.renderer = null;</span><br><span class="line">this.create();</span><br><span class="line">&#125;</span><br><span class="line">Spiral3D.prototype = &#123;</span><br><span class="line">create : function()&#123;</span><br><span class="line">try&#123;</span><br><span class="line">this.renderer = new THREE.WebGLRenderer( &#123; antialias: true &#125; ); //webgl</span><br><span class="line">&#125;catch(e)&#123;</span><br><span class="line">this.renderer = new THREE.CanvasRenderer(); //canvas</span><br><span class="line">&#125;</span><br><span class="line">this.renderer.setSize( this.width, this.height);</span><br><span class="line">document.body.appendChild( this.renderer.domElement );</span><br><span class="line">this.init();</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">init : function() &#123;</span><br><span class="line">this.scene = new THREE.Scene();</span><br><span class="line">this.stop();</span><br><span class="line">var spline = new THREE.Spline( Producer.points ),  //以关键点创建曲线</span><br><span class="line">geometry = new THREE.Geometry(),</span><br><span class="line">material = new THREE.LineBasicMaterial( &#123; color: 0xffffff, opacity: 1, linewidth: 1, vertexColors: THREE.VertexColors &#125; );</span><br><span class="line">//自动补全曲线点</span><br><span class="line">for ( var i =0, position, l = Producer.points.length * 7; i &lt; l; i ++ ) &#123;</span><br><span class="line">position = spline.getPoint( i/l );</span><br><span class="line">geometry.vertices[ i ] = new THREE.Vector3( position.x, position.y, position.z );</span><br><span class="line">geometry.colors[ i ] = new THREE.Color( 0x00ffff );</span><br><span class="line">geometry.colors[ i ].setHSV( ( 100 + position.x ) / 400 * i/8, ( 200 + position.x ) / 400, ( 250 + position.x ) / 300);</span><br><span class="line">&#125;</span><br><span class="line">//创建100条线</span><br><span class="line">for(var line, i=0, l = 100 ; i&lt;l; i++)&#123;</span><br><span class="line">line = new THREE.Line(geometry,  material);</span><br><span class="line">line.position = &#123;x: 0, y: 0, z: 0&#125;;</span><br><span class="line">if(i &gt; 0) &#123;</span><br><span class="line">line.rotation.y = Math.PI * 2 * (i/l);</span><br><span class="line">&#125;</span><br><span class="line">this.scene.add( line ); //将显示对象加入场景</span><br><span class="line">&#125;</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">render : function() &#123;</span><br><span class="line">var timer = Date.now() * 0.0005;</span><br><span class="line">this.camera.position.x = Math.cos( timer ) * 500;</span><br><span class="line">this.camera.position.z = Math.sin( timer ) * 500;</span><br><span class="line">this.camera.lookAt( this.scene.position );</span><br><span class="line">this.renderer.render( this.scene, this.camera ); //使用渲染器</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">_reqID : &#123;&#125;,</span><br><span class="line">animate : function() &#123;</span><br><span class="line">var that = this;</span><br><span class="line">var _loop = function()&#123;</span><br><span class="line">that._reqID = requestAnimationFrame( _loop );</span><br><span class="line">that.render();</span><br><span class="line">&#125;</span><br><span class="line">_loop();</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">stop : function()&#123;</span><br><span class="line">var that = this;</span><br><span class="line">cancelAnimationFrame(that._reqID);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var spiralDemo = new Spiral3D();</span><br><span class="line">spiralDemo.animate();</span><br><span class="line">setInterval(Producer.changePoints,50);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;做了一个3D螺旋线的生成器&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line</summary>
      
    
    
    
    
    <category term="JS" scheme="https://www.cssass.com/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>Metro风混搭瀑布流</title>
    <link href="https://www.cssass.com/2012/12/09/Metro%E9%A3%8E%E6%B7%B7%E6%90%AD%E7%80%91%E5%B8%83%E6%B5%81/"/>
    <id>https://www.cssass.com/2012/12/09/Metro%E9%A3%8E%E6%B7%B7%E6%90%AD%E7%80%91%E5%B8%83%E6%B5%81/</id>
    <published>2012-12-09T05:06:11.000Z</published>
    <updated>2023-06-29T05:08:38.844Z</updated>
    
    <content type="html"><![CDATA[<p>去年做了一个自号“ 格子块的智能堆砌 ”的效果, 当时瀑布流已激发了国内的第一批模仿者，微软的Merto也刚震撼了设计界。</p><p>今天把原来的效果改动优化了下，打造一个Metro风混搭瀑布流。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;Metro风兼搭瀑布流&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body&#123;background:#000;&#125;</span><br><span class="line">.myMetro&#123;position:relative;overflow:hidden;zoom:1;margin:0 auto;&#125;</span><br><span class="line">.MBox&#123;float:left;vertical-align:middle;&#125;</span><br><span class="line">.widgetBox&#123;position:relative;display:block;overflow:hidden;width:180px;height:160px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script src=&quot;http://www.cssass.com/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">/* 格子排序 */</span><br><span class="line">var metro = &#123;&#125;;</span><br><span class="line">metro.init=function(wrap)&#123;</span><br><span class="line">metro.gen=&#123;w:190,h:170&#125;;</span><br><span class="line">metro.wrap = wrap;</span><br><span class="line">metro.sizeArray= []; //格子,[1,2]就表示1X2的大格子</span><br><span class="line">metro.preset();</span><br><span class="line">metro.putData(wrap);</span><br><span class="line">&#125;;</span><br><span class="line">metro.preset = function()&#123;</span><br><span class="line">metro.nameSpace= &#123;&#125;;</span><br><span class="line">metro.maxY = -1;</span><br><span class="line">metro.basePos = &#123;x:0, y:0&#125;;</span><br><span class="line">metro.memory = &#123;flag:Infinity, x: Infinity, y:Infinity&#125;;</span><br><span class="line">metro.row = document.documentElement.offsetWidth / metro.gen.w &gt;&gt; 0;</span><br><span class="line">metro.wrap.style.width = metro.row * metro.gen.w + &quot;px&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">metro.resort=function()&#123;</span><br><span class="line">metro.preset();</span><br><span class="line">metro.mbox = $class(&quot;MBox&quot;);</span><br><span class="line">metro.sort(metro.sizeArray);</span><br><span class="line">&#125;;</span><br><span class="line">metro.putData = function(list)&#123;</span><br><span class="line">(function setBig()&#123;  //大格子初始化设置</span><br><span class="line"> var bigBox = $class(&quot;bigBox&quot;,list);</span><br><span class="line">   if(bigBox.length==0) return false;</span><br><span class="line">var i = 0, nx, ny, bigBoxCont;</span><br><span class="line">while(i &lt; bigBox.length)&#123;</span><br><span class="line">bigBoxCont =  $class(&quot;innerBox&quot;,bigBox[i]);</span><br><span class="line">nx = Math.floor(bigBoxCont[0].offsetWidth / metro.gen.w); //bigBox横向占的块数</span><br><span class="line">ny = Math.floor(bigBoxCont[0].offsetHeight / metro.gen.h);</span><br><span class="line">bigBox[i].style.width = nx*metro.gen.w - 10 + &#x27;px&#x27; ;</span><br><span class="line">bigBox[i].style.height = ny*metro.gen.h - 10 + &#x27;px&#x27; ;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">metro.mbox = $class(&quot;MBox&quot;,list);</span><br><span class="line">var i = 0 , nx, ny, tempSizeArray = [];</span><br><span class="line">while( i &lt; this.mbox.length)&#123;</span><br><span class="line">if( $class(&quot;bigBox&quot;,this.mbox[i]).length &gt; 0 )&#123;</span><br><span class="line">nx = Math.ceil(this.mbox[i].offsetWidth / this.gen.w);</span><br><span class="line">nx = (nx &gt; this.row) ? this.row : nx; //bigBox宽度尺寸过大</span><br><span class="line">ny = Math.ceil(this.mbox[i].offsetHeight / this.gen.h);</span><br><span class="line">tempSizeArray.push([nx,ny]);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">tempSizeArray.push([1,1]);</span><br><span class="line">&#125;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">this.sizeArray = this.sizeArray.concat(tempSizeArray);</span><br><span class="line">metro.sort(tempSizeArray);</span><br><span class="line">&#125;</span><br><span class="line">metro.sort = function(size)&#123;</span><br><span class="line">var x = metro.basePos.x,</span><br><span class="line">y = metro.basePos.y,</span><br><span class="line">memory = metro.memory,</span><br><span class="line">name;</span><br><span class="line">for(var n=0; n &lt; size.length ; n++)&#123;</span><br><span class="line">if(memory.flag == 0)&#123;</span><br><span class="line">x = memory.x;</span><br><span class="line">y = memory.y;</span><br><span class="line">&#125;</span><br><span class="line">memory.flag --;</span><br><span class="line">if(x &gt; metro.row-1)&#123; //换行</span><br><span class="line">x = 0;</span><br><span class="line">y ++;</span><br><span class="line">&#125;</span><br><span class="line">name = x+&#x27;_&#x27;+y;  //对象属性名（反映占领的格子）</span><br><span class="line">if(name in this.nameSpace) &#123;  //判断属性名是否存在</span><br><span class="line">n--;</span><br><span class="line">x++;</span><br><span class="line">memory.flag &lt; Infinity &amp;&amp; memory.flag++;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(size[n][0] * size[n][1] == 1)&#123;  //普通格子</span><br><span class="line">metro.nameSpace[name]=[x,y];  //项值（反映坐标值）</span><br><span class="line">setPos(x,y,n);</span><br><span class="line">x++;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;  //大格子</span><br><span class="line">if(beOver(x,y,size[n])) &#123;</span><br><span class="line">if(memory.y &gt; y)&#123;</span><br><span class="line">memory.y = y;</span><br><span class="line">memory.x = x;</span><br><span class="line">&#125;</span><br><span class="line">if(memory.y &lt; Infinity) memory.flag = 1;</span><br><span class="line">n--;</span><br><span class="line">x++;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">metro.nameSpace[name] = [x,y];</span><br><span class="line">setPos(x,y,n);</span><br><span class="line">hold(x,y,size[n]);</span><br><span class="line">x += size[n][0];</span><br><span class="line">&#125;</span><br><span class="line">if(memory.flag == -1) memory = &#123;flag:Infinity ,x: Infinity, y:Infinity&#125;;</span><br><span class="line">metro.maxY = Math.max(metro.maxY, y + size[n][1]);</span><br><span class="line">&#125;</span><br><span class="line">metro.basePos = &#123;&quot;x&quot;:x,&quot;y&quot;:y&#125;</span><br><span class="line">metro.memory = memory;</span><br><span class="line">metro.wrap.style.height= metro.gen.h * metro.maxY +&#x27;px&#x27;;</span><br><span class="line">function beOver(x,y,item)&#123;  //判断是否会重叠</span><br><span class="line">var name;</span><br><span class="line">if(x + item[0] &gt; metro.row) return true; //超出显示范围</span><br><span class="line">for(var k=1; k&lt;item[1]; k++)&#123;</span><br><span class="line">name=x+&#x27;_&#x27;+(y-0+k);</span><br><span class="line">if(name in metro.nameSpace) return true; //左侧一列有无重叠</span><br><span class="line">&#125;</span><br><span class="line">for(k=1; k&lt;item[0]; k++)&#123;</span><br><span class="line">name=(x-0+k)+&#x27;_&#x27;+y;</span><br><span class="line">if(name in metro.nameSpace) return true; //上侧一行有无重叠</span><br><span class="line">&#125;</span><br><span class="line">return false;</span><br><span class="line">&#125;;</span><br><span class="line">function hold(x,y,item)&#123;  //大格子多占的位置</span><br><span class="line">for(var t=0; t &lt; item[0]; t++) &#123;</span><br><span class="line">for(var k=0; k &lt; item[1]; k++)&#123;</span><br><span class="line">name = (x+t)+&#x27;_&#x27;+(y+k);</span><br><span class="line">if(t==0 &amp;&amp; k==0)   continue;</span><br><span class="line">metro.nameSpace[name] = 0;   //多占的格子无坐标值</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">function setPos(x,y,n)&#123;</span><br><span class="line">var left = metro.gen.w * x,</span><br><span class="line">top = metro.gen.h * y;</span><br><span class="line">metro.mbox[n].style.cssText += &quot;position:absolute;left:&quot;+ left +&quot;px;top:&quot; + top + &quot;px;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;myMetro&quot; class=&quot;myMetro&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">//随机数据</span><br><span class="line">var myMetro = $id(&quot;myMetro&quot;),</span><br><span class="line">colorList = [&#x27;f4b300&#x27;,&#x27;78ba00&#x27;,&#x27;2673ec&#x27;,&#x27;ae113d&#x27;,&#x27;632f00&#x27;,&#x27;b01e00&#x27;,&#x27;4e0038&#x27;,&#x27;c1004f&#x27;,&#x27;7200ac&#x27;,&#x27;2d004e&#x27;,&#x27;006ac1&#x27;,&#x27;001e4e&#x27;,&#x27;008287&#x27;,&#x27;004d60&#x27;,&#x27;004a00&#x27;,&#x27;00c13f&#x27;,&#x27;15992a&#x27;,&#x27;ff981d&#x27;,&#x27;e56c19&#x27;,&#x27;b81b1b&#x27;,&#x27;ff1d77&#x27;,&#x27;b81b6c&#x27;,&#x27;aa40ff&#x27;,&#x27;691bb8&#x27;,&#x27;1faeff&#x27;,&#x27;1b58b8&#x27;,&#x27;56c5ff&#x27;,&#x27;569ce3&#x27;,&#x27;00d8cc&#x27;,&#x27;00aaaa&#x27;,&#x27;91d100&#x27;,&#x27;b81b6c&#x27;,&#x27;e1b700&#x27;,&#x27;d39d09&#x27;,&#x27;ff76bc&#x27;,&#x27;e064b7&#x27;,&#x27;00a4a4&#x27;,&#x27;ff7d23&#x27;,&#x27;4cafb5&#x27;,&#x27;044d91&#x27;,&#x27;832772&#x27;,&#x27;d15a44&#x27;,&#x27;de971b&#x27;,&#x27;017802&#x27;,&#x27;6e2ea0&#x27;],</span><br><span class="line">color = colorList[0];</span><br><span class="line">function createTestData(n)&#123;</span><br><span class="line">var spanWrap = document.createElement(&quot;span&quot;),</span><br><span class="line">content = &quot;&quot;;</span><br><span class="line">for(i = 0; i &lt; n; i++) &#123;</span><br><span class="line">color = colorList[(colorList.length * Math.random())&gt;&gt;0];</span><br><span class="line">if(!(Math.random()*3 &gt;&gt; 0))&#123; //输出大模块测试数据。宽高在一个范围内都是随意的，未做其他限制</span><br><span class="line">height = Math.floor(Math.random()*320 + 160);</span><br><span class="line">width = Math.floor(Math.random()*360 + 180);</span><br><span class="line">content += &#x27;&lt;div class=&quot;MBox&quot; style=&quot;background:#&#x27;+color+&#x27;&quot;&gt;&lt;div class=&quot;bigBox&quot; &gt;&lt;a href=&quot;http://www.cssass.com&quot; target=&quot;_blank&quot; style=&quot;width:&#x27; + width +&#x27;px;height:&#x27; + height +&#x27;px;top:&#x27;+(-height%170)/2+&#x27;px;left:&#x27;+(-width%190)/2+&#x27;px;&quot; class=&quot;widgetBox innerBox&quot;&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;</span><br><span class="line">&#125;else&#123; //输出普通模块数据</span><br><span class="line">content += &#x27;&lt;div class=&quot;MBox&quot; style=&quot;background:#&#x27;+color+&#x27;&quot;&gt;&lt;a href=&quot;http://www.cssass.com&quot; target=&quot;_blank&quot; class=&quot;widgetBox&quot; &gt;&lt;/a&gt;&lt;/div&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">spanWrap.innerHTML = content;</span><br><span class="line">myMetro.appendChild(spanWrap);</span><br><span class="line">return spanWrap;</span><br><span class="line">&#125;</span><br><span class="line">window.onload = function()&#123;</span><br><span class="line">createTestData(35);</span><br><span class="line">metro.init(myMetro);</span><br><span class="line">&#125;;</span><br><span class="line">window.onresize = function()&#123;</span><br><span class="line">metro.resort(myMetro);</span><br><span class="line">&#125;;</span><br><span class="line">window.onscroll=function()&#123;</span><br><span class="line">var scrollTop = document.body.scrollTop || document.documentElement.scrollTop,</span><br><span class="line">windowHeight = document.documentElement.clientHeight,</span><br><span class="line">documentHeight = document.body.offsetHeight;</span><br><span class="line">if(windowHeight + scrollTop &gt; documentHeight - 50)&#123;</span><br><span class="line">metro.putData(createTestData(15));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>应大家要求，我将主要的sort方法取出来，再做个简单demo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;CSSASS&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var metro = &#123;</span><br><span class="line">    //初始化数据。表示格子大小：1*1，1*2，2*3...</span><br><span class="line">    sizeArray : [[1, 1], [1, 2], [2, 1], [2, 3], [1, 1], [1, 2], [1, 1], [2, 2], [1, 1]],</span><br><span class="line">    //单元格尺寸</span><br><span class="line">    gen: &#123;</span><br><span class="line">        w: 200,</span><br><span class="line">        h: 180</span><br><span class="line">    &#125;,</span><br><span class="line">    //nameSpace的key用于判断对应的坐标位置有没被占有,我们就是要保证key是唯一的。而value就是最终设置的坐标了。</span><br><span class="line">    nameSpace: &#123;</span><br><span class="line">        /* 1_0: [1,0] */</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">metro.init = function () &#123;</span><br><span class="line">    metro.row = 1000 / metro.gen.w &gt;&gt; 0; //一行最多能排下的单元格个数/ 测试宽度以1000px计。</span><br><span class="line">    metro.sort(metro.sizeArray);</span><br><span class="line">&#125;;</span><br><span class="line">metro.sort = function (size) &#123;</span><br><span class="line">    var x = 0,</span><br><span class="line">        y = 0,</span><br><span class="line">        memory = &#123;</span><br><span class="line">            flag: Infinity,</span><br><span class="line">            x: Infinity,</span><br><span class="line">            y: Infinity</span><br><span class="line">        &#125;,</span><br><span class="line">        name;</span><br><span class="line">    for (var n = 0; n &lt; size.length; n++) &#123;</span><br><span class="line">        if (memory.flag == 0) &#123;</span><br><span class="line">            x = memory.x;</span><br><span class="line">            y = memory.y;</span><br><span class="line">        &#125;</span><br><span class="line">        memory.flag--;</span><br><span class="line">        if (x &gt; metro.row - 1) &#123; //换行</span><br><span class="line">            x = 0;</span><br><span class="line">            y ++;</span><br><span class="line">        &#125;</span><br><span class="line">        name = x + &#x27;_&#x27; + y; //对象属性名（反映占领的格子）</span><br><span class="line">        if (name in this.nameSpace) &#123; //判断属性名是否存在</span><br><span class="line">            n --;</span><br><span class="line">            x ++;</span><br><span class="line">            memory.flag &lt; Infinity &amp;&amp; memory.flag++;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if (size[n][0] * size[n][1] == 1) &#123; //普通格子</span><br><span class="line">            metro.nameSpace[name] = [x, y]; //项值（反映坐标值）</span><br><span class="line">            LOG(x, y, n, name, metro.nameSpace[name]); /* 显示及打印信息 */</span><br><span class="line">            x++;</span><br><span class="line">        &#125; else &#123; //大格子</span><br><span class="line">            if (beOver(x, y, size[n])) &#123;</span><br><span class="line">                if (memory.y &gt; y) &#123;</span><br><span class="line">                    memory.y = y;</span><br><span class="line">                    memory.x = x;</span><br><span class="line">                &#125;</span><br><span class="line">                if (memory.y &lt; Infinity) memory.flag = 1;</span><br><span class="line">                n --;</span><br><span class="line">                x ++;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            metro.nameSpace[name] = [x, y];</span><br><span class="line">            LOG(x, y, n, name, metro.nameSpace[name]); /* 显示及打印信息 */</span><br><span class="line">            hold(x, y, n);</span><br><span class="line">            x += size[n][0];</span><br><span class="line">        &#125;</span><br><span class="line">        if (memory.flag == -1) memory = &#123;</span><br><span class="line">            flag: Infinity,</span><br><span class="line">            x: Infinity,</span><br><span class="line">            y: Infinity</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    function beOver(x, y, item) &#123; //判断是否会重叠</span><br><span class="line">        var name;</span><br><span class="line">        if (x + item[0] &gt; metro.row) return true; //超出显示范围</span><br><span class="line">        for (var k = 1; k &lt; item[1]; k++) &#123;</span><br><span class="line">            name = x + &#x27;_&#x27; + (y - 0 + k);</span><br><span class="line">            if (name in metro.nameSpace) return true; //左侧一列有无重叠</span><br><span class="line">        &#125;</span><br><span class="line">        for (k = 1; k &lt; item[0]; k++) &#123;</span><br><span class="line">            name = (x - 0 + k) + &#x27;_&#x27; + y;</span><br><span class="line">            if (name in metro.nameSpace) return true; //上侧一行有无重叠</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;;</span><br><span class="line">    function hold(x, y, n) &#123; //大格子多占的位置</span><br><span class="line">        var item = metro.sizeArray[n];</span><br><span class="line">        for (var t = 0; t &lt; item[0]; t++) &#123;</span><br><span class="line">            for (var k = 0; k &lt; item[1]; k++) &#123;</span><br><span class="line">                name = (x + t) + &#x27;_&#x27; + (y + k);</span><br><span class="line">                if (t == 0 &amp;&amp; k == 0) continue;</span><br><span class="line">                metro.nameSpace[name] = 0; //多占的格子无坐标值</span><br><span class="line">                LOG_2(n ,name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">metro.init();</span><br><span class="line">function LOG(x, y, n, key) &#123;</span><br><span class="line">    //用于显示</span><br><span class="line">    var left = metro.gen.w * x,</span><br><span class="line">        top = metro.gen.h * y,</span><br><span class="line">        width = metro.sizeArray[n][0] * metro.gen.w,</span><br><span class="line">        height = metro.sizeArray[n][1] * metro.gen.h;</span><br><span class="line">    var box = document.createElement(&quot;div&quot;);</span><br><span class="line">    box.id = &quot;ID&quot; + n;</span><br><span class="line">    box.innerHTML = &quot;&lt;h3&gt;&quot; + n +&quot;&lt;/h3&gt;&quot; + key + &quot;:(&quot; + metro.nameSpace[key] + &quot;)&lt;br/&gt;&quot;;</span><br><span class="line">    box.style.cssText = &quot;position:absolute;border:1px solid #333;left:&quot; + left + &quot;px;top:&quot; + top + &quot;px;width:&quot; + width + &quot;px;height:&quot; + height + &quot;px;&quot;;</span><br><span class="line">    document.body.appendChild(box);</span><br><span class="line">&#125;</span><br><span class="line">function LOG_2(n, key)&#123;</span><br><span class="line">    //大格子多占位置的信息。</span><br><span class="line">    document.getElementById(&quot;ID&quot; + n).innerHTML +=  key + &quot;:(&quot; + metro.nameSpace[key] + &quot;)&lt;br/&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;去年做了一个自号“ 格子块的智能堆砌 ”的效果, 当时瀑布流已激发了国内的第一批模仿者，微软的Merto也刚震撼了设计界。&lt;/p&gt;
&lt;p&gt;今天把原来的效果改动优化了下，打造一个Metro风混搭瀑布流。&lt;/p&gt;
&lt;figure class=&quot;highlight plainte</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>canvas模拟繁花曲线规</title>
    <link href="https://www.cssass.com/2012/12/05/canvas%E6%A8%A1%E6%8B%9F%E7%B9%81%E8%8A%B1%E6%9B%B2%E7%BA%BF%E8%A7%84/"/>
    <id>https://www.cssass.com/2012/12/05/canvas%E6%A8%A1%E6%8B%9F%E7%B9%81%E8%8A%B1%E6%9B%B2%E7%BA%BF%E8%A7%84/</id>
    <published>2012-12-05T02:56:41.000Z</published>
    <updated>2023-06-29T02:58:27.236Z</updated>
    
    <content type="html"><![CDATA[<p>不算难，就是几个相对运动。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&#x27;UTF-8&#x27; /&gt;</span><br><span class="line">&lt;title&gt;繁花曲线规&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body&#123;background:#eee;overflow-x:hidden;&#125;</span><br><span class="line">#operationBar&#123;position: fixed;z-index:10000;bottom:0;width:100%;text-align:center;background:#FBFDFE;border-top:2px solid #CC0F16;padding:5px 0;&#125;</span><br><span class="line">.optText&#123;width:35px;&#125;</span><br><span class="line">.dialog_Wrap&#123;background:#666;border: 1px solid #585858;border-top:0;border-radius: 0 0 8px 8px;box-shadow: 1px 1px 2px #aaa; overflow: hidden;&#125;</span><br><span class="line">.dialog_Head&#123;background:#000;height:26px;line-height:26px;padding: 0 5px;border-top:2px solid #CC0F16;cursor:move;color:#fff;font-size:12px;&#125;</span><br><span class="line">.dialog_close&#123;text-decoration:none;color:#fff; display:inline-block;width:15px;height:15px;font-size:12px;text-align:center;line-height:15px;font-family:&#x27;Comic Sans MS&#x27;;&#125;</span><br><span class="line">.dialog_Head .dialog_Opts&#123;position:absolute;right:5px;top:0;height:21px;cursor:default;&#125;</span><br><span class="line">.dialog_Body&#123;overflow:auto;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/litewin.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;operationBar&quot;&gt;</span><br><span class="line">&lt;label&gt;&lt;input class=&quot;opt&quot; id=&quot;showCricle&quot; type=&quot;checkbox&quot; /&gt;圈&lt;/label&gt;</span><br><span class="line">&lt;label&gt;&lt;input class=&quot;opt&quot; id=&quot;showLine&quot; type=&quot;checkbox&quot; checked/&gt;线&lt;/label&gt;</span><br><span class="line">&lt;label&gt;&lt;input class=&quot;opt&quot; id=&quot;showPoint&quot; type=&quot;checkbox&quot; /&gt;点&lt;/label&gt;</span><br><span class="line">&lt;label&gt;&lt;input class=&quot;opt&quot; id=&quot;showColor&quot; type=&quot;checkbox&quot; checked /&gt;变色&lt;/label&gt;</span><br><span class="line">&lt;label&gt;&lt;input class=&quot;opt&quot; id=&quot;isRefresh&quot; type=&quot;checkbox&quot; /&gt;刷新&lt;/label&gt;</span><br><span class="line">&lt;label&gt;外圈半径:&lt;input class=&quot;opt optText&quot; id=&quot;bigRadius&quot; type=&quot;text&quot; value=&quot;133&quot; /&gt;&lt;/label&gt;</span><br><span class="line">&lt;label&gt;内圈半径:&lt;input class=&quot;opt optText&quot; id=&quot;smallRadius&quot; type=&quot;text&quot; value=&quot;140&quot; /&gt;&lt;/label&gt;</span><br><span class="line">&lt;label&gt;线长:&lt;input class=&quot;opt optText&quot; id=&quot;lineLength&quot; type=&quot;text&quot; value=&quot;123&quot; /&gt;&lt;/label&gt;</span><br><span class="line">&lt;label&gt;&lt;input id=&quot;runBtn&quot; type=&quot;button&quot; value=&quot;新建&quot;/&gt;&lt;/label&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function Toy(options)&#123;</span><br><span class="line">this.setOptions(options);</span><br><span class="line">this.createPad();</span><br><span class="line">this.draw(true);</span><br><span class="line">&#125;</span><br><span class="line">Toy.prototype = &#123;</span><br><span class="line">setOptions: function(options) &#123;</span><br><span class="line">this.options = &#123;</span><br><span class="line">R:133, //大圈半径</span><br><span class="line">r:140, //小圈半径</span><br><span class="line">l:123, //线长</span><br><span class="line">showPoint: false, //显示小点</span><br><span class="line">showCricle: false, //显示小圈</span><br><span class="line">showLine: true, //显示线条</span><br><span class="line">isRefresh: false, //每次清屏</span><br><span class="line">showColor : true, //颜色变化</span><br><span class="line">count : 1500 //绘制次数</span><br><span class="line">&#125;;</span><br><span class="line">extendCopy(options || &#123;&#125;, this.options);</span><br><span class="line">//实际占用区域半径的计算</span><br><span class="line">var delta = 0;</span><br><span class="line">if(this.options.R &gt; this.options.r)&#123;</span><br><span class="line">delta = (this.options.r &gt; this.options.l) ? 0 : this.options.l - this.options.r;</span><br><span class="line">this.radius = this.options.R + delta;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">delta = (this.options.r &gt; this.options.l) ? this.options.r - this.options.R : this.options.l - this.options.R;</span><br><span class="line">this.radius = this.options.r + delta;</span><br><span class="line">&#125;</span><br><span class="line">this.radius += 10;</span><br><span class="line">this.color = &#123;</span><br><span class="line">r : 0,</span><br><span class="line">g : 0,</span><br><span class="line">b : 255,</span><br><span class="line">a : 0.5</span><br><span class="line">&#125;;</span><br><span class="line">this.v =  20;</span><br><span class="line">this.colorValue = &quot;rgba(&quot;+this.color.r+&quot;,&quot;+this.color.g+&quot;,&quot;+this.color.b+&quot;,&quot;+this.color.a+&quot;)&quot;;</span><br><span class="line">this.angle = 0;</span><br><span class="line">this.timePlay = null;</span><br><span class="line">  &#125;,</span><br><span class="line">  changeColor : function()&#123;</span><br><span class="line">  //颜色变换模式1</span><br><span class="line">  this.color.r += this.v;</span><br><span class="line">  if(this.color.r &gt; 255)&#123;</span><br><span class="line">  this.color.r = 0;</span><br><span class="line">  this.color.g += this.v;</span><br><span class="line">  &#125;</span><br><span class="line">  if(this.color.g &gt; 255)&#123;</span><br><span class="line">  this.color.r = 0;</span><br><span class="line">  this.color.g = 0;</span><br><span class="line">  this.color.b += this.v;</span><br><span class="line">  &#125;</span><br><span class="line">  if(this.color.b &gt; 255)&#123;</span><br><span class="line">  this.color.r = 0;</span><br><span class="line">  this.color.g = 0;</span><br><span class="line">  this.color.b = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  this.colorValue = &quot;rgba(&quot;+this.color.r+&quot;,&quot;+this.color.g+&quot;,&quot;+this.color.b+&quot;,&quot;+this.color.a+&quot;)&quot;;</span><br><span class="line">  &#125;,</span><br><span class="line">  changeColor2 : function()&#123;</span><br><span class="line">  //颜色变换模式2</span><br><span class="line">  if(Toy.isIn(this.color.r + this.v, -1, 255))&#123;</span><br><span class="line">  this.color.r += this.v;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">  if(Toy.isIn(this.color.g + this.v, -1, 255))&#123;</span><br><span class="line">  this.color.g += this.v;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">  if(Toy.isIn(this.color.b + this.v, -1, 255))&#123;</span><br><span class="line">  this.color.b += this.v;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">  this.v = -this.v;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  this.colorValue = &quot;rgba(&quot;+this.color.r+&quot;,&quot;+this.color.g+&quot;,&quot;+this.color.b+&quot;,&quot;+this.color.a+&quot;)&quot;;</span><br><span class="line">  &#125;,</span><br><span class="line">createPad : function(isReset)&#123;</span><br><span class="line">if(!isReset)&#123;</span><br><span class="line">this.pad = document.createElement(&quot;canvas&quot;);</span><br><span class="line">&#125;</span><br><span class="line">this.pad.width =  this.radius * 2;</span><br><span class="line">this.pad.height = this.radius * 2;</span><br><span class="line">this.ctx = this.pad.getContext(&#x27;2d&#x27;);</span><br><span class="line">this.ctx.lineJoin = &#x27;round&#x27;;</span><br><span class="line">this.ctx.lineCap = &#x27;round&#x27;;</span><br><span class="line">this.ctx.lineWidth=.5;</span><br><span class="line">this.ctx.strokeStyle = this.colorValue;</span><br><span class="line">this.ctx.fillStyle = this.colorValue;</span><br><span class="line">if(!isReset)&#123;</span><br><span class="line">var dialogs = $class(&quot;myDialog&quot;),</span><br><span class="line">lastOne = dialogs[dialogs.length - 1],</span><br><span class="line">pos = [0,0],</span><br><span class="line">scrollT = document.body.scrollTop || document.documentElement.scrollTop;</span><br><span class="line">if(lastOne)&#123;</span><br><span class="line">var rect = lastOne.getBoundingClientRect();</span><br><span class="line">if (rect.right &gt; document.documentElement.offsetWidth - lastOne.offsetWidth) &#123;</span><br><span class="line">pos = [rect.bottom + 10 + scrollT, 0];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">pos = [rect.top + scrollT, rect.right+ 10];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">this.myPad = Win.open(&#123;</span><br><span class="line">title : &quot;Pad - &quot; + Toy.t++,</span><br><span class="line">html : &quot;&quot;,</span><br><span class="line">width : this.pad.width +10,</span><br><span class="line">height : this.pad.height + 35,</span><br><span class="line">onclose : this.stop</span><br><span class="line">&#125;).position(&quot;leftTop&quot;).css(&quot;top:&quot;+pos[0]+&quot;px;left:&quot;+ pos[1] +&quot;px;&quot;);</span><br><span class="line">$class(&quot;dialog_Cont&quot;,this.myPad.dom)[0].appendChild(this.pad);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">draw : function(isFirst)&#123;</span><br><span class="line">this.ctx.save();</span><br><span class="line">if(this.options.showColor)&#123;</span><br><span class="line">this.changeColor2();</span><br><span class="line">this.ctx.strokeStyle = this.colorValue;</span><br><span class="line">this.ctx.fillStyle = this.colorValue;</span><br><span class="line">&#125;</span><br><span class="line">//大圆</span><br><span class="line">this.ctx.translate(this.radius, this.radius);</span><br><span class="line">if(isFirst)&#123;</span><br><span class="line">this.ctx.beginPath();</span><br><span class="line">this.ctx.arc(0,0,this.options.R,0,Math.PI*2,true);</span><br><span class="line">this.ctx.closePath();</span><br><span class="line">this.ctx.stroke();</span><br><span class="line">&#125;</span><br><span class="line">//小圆</span><br><span class="line">this.ctx.rotate(-this.angle);</span><br><span class="line">this.ctx.translate(this.options.R-this.options.r,0);</span><br><span class="line">if(this.options.showCricle || isFirst)&#123;</span><br><span class="line">this.ctx.beginPath();</span><br><span class="line">this.ctx.arc(0,0,this.options.r,0,Math.PI*2,true);</span><br><span class="line">this.ctx.closePath();</span><br><span class="line">this.ctx.stroke();</span><br><span class="line">&#125;</span><br><span class="line">//线</span><br><span class="line">this.ctx.rotate(this.angle * this.options.R/this.options.r);</span><br><span class="line">if(this.options.showLine || isFirst)&#123;</span><br><span class="line">this.ctx.beginPath();</span><br><span class="line">this.ctx.moveTo(0,0);</span><br><span class="line">this.ctx.lineTo(this.options.l,0);</span><br><span class="line">this.ctx.stroke();</span><br><span class="line">&#125;</span><br><span class="line">//小点</span><br><span class="line">if(this.options.showPoint || isFirst)&#123;</span><br><span class="line">this.ctx.translate(this.options.l,0);</span><br><span class="line">this.ctx.beginPath();</span><br><span class="line">this.ctx.arc(0,0,1,0,Math.PI*2,true);</span><br><span class="line">this.ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line">this.ctx.restore();</span><br><span class="line">this.angle += 0.2;</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">move : function()&#123;</span><br><span class="line">var that = this,</span><br><span class="line">count = 0,</span><br><span class="line">_s = function()&#123;</span><br><span class="line">that.clear(count == 0).draw();</span><br><span class="line">count ++;</span><br><span class="line">that.timePlay = setTimeout(_s,50);</span><br><span class="line">if(that.options.count &lt; count) &#123;</span><br><span class="line">clearTimeout(that.timePlay)</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">_s();</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">stop : function()&#123;</span><br><span class="line">clearTimeout(this.timePlay);</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">clear : function(isInit)&#123;</span><br><span class="line">if(this.options.isRefresh || isInit)&#123;</span><br><span class="line">this.ctx.clearRect(0,0,this.radius * 2,this.radius * 2);</span><br><span class="line">this.ctx.font = &#x27;10px Helvetica&#x27;;</span><br><span class="line">this.ctx.fillStyle = &#x27;#fff&#x27;;</span><br><span class="line">this.ctx.fillText(&quot;R: &quot;+this.options.R, this.radius * 2 - 35, this.radius * 2-24 );</span><br><span class="line">this.ctx.fillText(&quot;r : &quot;+this.options.r, this.radius * 2 - 35, this.radius * 2 - 12);</span><br><span class="line">this.ctx.fillText(&quot;l : &quot;+this.options.l, this.radius * 2 - 35, this.radius * 2 );</span><br><span class="line">&#125;</span><br><span class="line">return this;</span><br><span class="line">&#125;,</span><br><span class="line">reset : function(options)&#123;</span><br><span class="line">this.setOptions(options);</span><br><span class="line">this.createPad(true);</span><br><span class="line">this.draw(true);</span><br><span class="line">return this;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Toy.isIn = function(v,min,max)&#123;</span><br><span class="line">return (v &gt; min &amp;&amp; v &lt; max)</span><br><span class="line">&#125;;</span><br><span class="line">Toy.t = new Date();</span><br><span class="line">function getOpt()&#123;</span><br><span class="line">return &#123;</span><br><span class="line">R : $id(&quot;bigRadius&quot;).value - 0 || 133,</span><br><span class="line">r : $id(&quot;smallRadius&quot;).value - 0 || 140,</span><br><span class="line">l : $id(&quot;lineLength&quot;).value - 0 || 123,</span><br><span class="line">showPoint: $id(&quot;showPoint&quot;).checked,</span><br><span class="line">showCricle: $id(&quot;showCricle&quot;).checked,</span><br><span class="line">showLine: $id(&quot;showLine&quot;).checked,</span><br><span class="line">isRefresh: $id(&quot;isRefresh&quot;).checked,</span><br><span class="line">showColor : $id(&quot;showColor&quot;).checked</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">window.onload = function()&#123;</span><br><span class="line">var opt = getOpt();</span><br><span class="line">var temp1 = new Toy(opt),</span><br><span class="line">temp2 = new Toy(opt).move(),</span><br><span class="line">temp3 = new Toy(&#123;R:103,r:40,l:50&#125;).move(),</span><br><span class="line">temp4 = new Toy(&#123;R:113,r:140,l:123&#125;).move();</span><br><span class="line">var inputs = $class(&quot;opt&quot;);</span><br><span class="line">for (var i = inputs.length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">inputs[i].onchange = function()&#123;</span><br><span class="line">temp1.reset(getOpt());</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">events.addEvent($id(&quot;runBtn&quot;),&#x27;click&#x27;, function()&#123;</span><br><span class="line">new Toy(getOpt()).move();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;不算难，就是几个相对运动。&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line</summary>
      
    
    
    
    
    <category term="canvas" scheme="https://www.cssass.com/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>XMLHttpRequest Level 2的跨域功能</title>
    <link href="https://www.cssass.com/2012/12/03/XMLHttpRequest%20Level%202%E7%9A%84%E8%B7%A8%E5%9F%9F%E5%8A%9F%E8%83%BD/"/>
    <id>https://www.cssass.com/2012/12/03/XMLHttpRequest%20Level%202%E7%9A%84%E8%B7%A8%E5%9F%9F%E5%8A%9F%E8%83%BD/</id>
    <published>2012-12-03T02:39:06.000Z</published>
    <updated>2023-06-29T02:43:58.976Z</updated>
    
    <content type="html"><![CDATA[<p>XMLHttpRequest Level 2的功能已经大幅提升了，<br>参见：<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html">http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html</a></p><p>我们知道，受到浏览器”同域限制“制约，以前的xhr对象是无法完成跨域请求的，而现在只需在Server端做一个访问控制，Client端再用xhr对象请求就行了，一般情况下Client并不需要设置，当然还有些相关的方法属性可供使用的，比如setRequestHeader，withCredentials。<br>服务端设置参见： <a href="https://developer.mozilla.org/en-US/docs/Server-Side_Access_Control">https://developer.mozilla.org/en-US/docs/Server-Side_Access_Control</a></p><p>下面我们简单的做个demo<br>Server端代码(PHP)：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if($_SERVER[&#x27;HTTP_ORIGIN&#x27;] == &quot;http://www.cssass.com&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            header(&#x27;Access-Control-Allow-Origin: http://www.cssass.com&#x27;);</span><br><span class="line">            header(&#x27;Content-Type: text/plain&#x27;);</span><br><span class="line">            if($_SERVER[&#x27;REQUEST_METHOD&#x27;] == &quot;GET&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                $arr = array( </span><br><span class="line">                    &#x27;id&#x27; =&gt; &#x27;1&#x27;,</span><br><span class="line">                    &#x27;name&#x27; =&gt; &#x27;XMLHttpRequest Response&#x27; </span><br><span class="line">                );</span><br><span class="line">                echo json_encode($arr);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>http响应头设置参见：<a href="https://developer.mozilla.org/en-US/docs/HTTP_access_control#The_HTTP_response_headers">https://developer.mozilla.org/en-US/docs/HTTP_access_control#The_HTTP_response_headers</a></p><p>Client端代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;XMLHttpRequest 2演示&lt;/title&gt;</span><br><span class="line">&lt;a href=&quot;javascript:;&quot; onclick=&quot;get_xhr2()&quot;&gt;获取数据!(xhr2)&lt;/a&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function get_xhr2()&#123;</span><br><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.open(&#x27;GET&#x27;, &#x27;http://www.hzmilo.com/me.php?r=/xhr2/send&#x27;); //POST也支持</span><br><span class="line">xhr.onload = function(e) &#123; //绑定onload</span><br><span class="line">  var data = JSON.parse(this.response); //json解析</span><br><span class="line">  alert(data.name);</span><br><span class="line">&#125;</span><br><span class="line">xhr.send();</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>正如你所知，ie下是不支持XMLHttpRequest Level 2的，不过ie8引入了自己的跨域对象XDomainRequest。(同时ie8下的xhr对象也引入了 timeou属性t和ontimeout方法）<br>所以我们做下兼容（不支持ie6，ie7）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;XMLHttpRequest 2演示&lt;/title&gt;</span><br><span class="line">&lt;a href=&quot;javascript:;&quot; onclick=&quot;get_xhr2()&quot;&gt;获取数据!(xhr2)&lt;/a&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function get_xhr2()&#123;</span><br><span class="line">var xr,xrName;</span><br><span class="line">if(window.XDomainRequest)&#123;</span><br><span class="line">xr = new XDomainRequest();</span><br><span class="line">xrName = &quot;XDomainRequest&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">xr = new XMLHttpRequest();</span><br><span class="line">xrName = &quot;XMLHttpRequest&quot;;</span><br><span class="line">&#125;</span><br><span class="line">xr.open(&#x27;GET&#x27;, &#x27;http://www.hzmilo.com/me.php?r=/xhr2/send/&amp;xr=&#x27;+xrName);</span><br><span class="line">xr.onload = function(e) &#123;</span><br><span class="line">  var data = JSON.parse(this.responseText); //json解析</span><br><span class="line">  alert(data.name);</span><br><span class="line">&#125;</span><br><span class="line">xr.send();</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>接下来，我们来了解下JSONP这种在同域限制的情况下实现跨域请求（GET）的实现过程。<br>原理其实就是：以script标签的形式在页面中放置一个请求地址，该请求地址返回的数据格式为：</p><p>jsonp1354513528560({“id”:”2″,”name”:”JSON with Padding”})</p><p>如果jsonp1354513528560是一个预先定义好的JS方法，那么获取其参数（我们实际需要获取的数据）就顺理成章了。</p><p>以下是Client端的实现代码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;</span><br><span class="line">        //jsonp的具体实现</span><br><span class="line">          var randomNum = (new Date).getTime(),</span><br><span class="line">              callName = null,</span><br><span class="line">              sendScriptRequest = function(url,id)&#123;</span><br><span class="line">                  //将请求地址以script标签形式插入到页面。（注定是GET请求）</span><br><span class="line">                var head = document.getElementsByTagName(&quot;head&quot;)[0];</span><br><span class="line">                var script = document.createElement(&quot;script&quot;);</span><br><span class="line">                script.id = id;</span><br><span class="line">                script.src = url;</span><br><span class="line">                script.charset = &#x27;utf-8&#x27;;</span><br><span class="line">                head.appendChild(script);</span><br><span class="line">            &#125;,</span><br><span class="line">            buildTempFunction = function(callback)&#123;</span><br><span class="line">                //创建一个全局方法，并将方法名当做请求地址的一个参数</span><br><span class="line">                callName = &quot;jsonp&quot; + randomNum++;</span><br><span class="line">                window[ callName ] = function(data)&#123;</span><br><span class="line">                    callback(data);</span><br><span class="line">                    window[ callName ] = undefined;</span><br><span class="line">                    try&#123; </span><br><span class="line">                        delete window[ callName ];</span><br><span class="line">                        //var jsNode = document.getElementById(callName);</span><br><span class="line">                        //jsNode.parentElement.removeChild(jsNode);  //执行全局方法后，将script标签删除</span><br><span class="line">                    &#125; catch(e)&#123;&#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                return callName;</span><br><span class="line">            &#125;,</span><br><span class="line">            $jsonp = function(url,params)&#123;</span><br><span class="line">                //生成GET请求地址</span><br><span class="line">                  params.callback = buildTempFunction(params.callback);</span><br><span class="line">                  url += (url.indexOf(&quot;?&quot;)&gt;0 ) ? &quot;&quot; : &quot;?&quot; ;</span><br><span class="line">                  for(var i in params)</span><br><span class="line">                      url += &quot;&amp;&quot; + i + &quot;=&quot; + params[i];</span><br><span class="line">                sendScriptRequest(url,callName);</span><br><span class="line">              &#125;;</span><br><span class="line">            //对外开放接口：$jsonp</span><br><span class="line">            /**</span><br><span class="line">            * @$jsonp JSONP方法</span><br><span class="line">            * @param &#123;String&#125; url 请求地址</span><br><span class="line">            * @param &#123;Object&#125; params 请求参数</span><br><span class="line">            */ </span><br><span class="line">              if (!window.$jsonp)</span><br><span class="line">                   window.$jsonp = $jsonp;</span><br><span class="line">    &#125;)();</span><br></pre></td></tr></table></figure><p>Server端很简单,只需拼接输出一个js的执行方法即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$jsonp = $_GET[&#x27;callback&#x27;]; //请求端传递的callback参数，作为输出的方法名</span><br><span class="line">        $arr = array( </span><br><span class="line">            &#x27;id&#x27; =&gt; &#x27;2&#x27;,</span><br><span class="line">            &#x27;name&#x27; =&gt; &#x27;JSON with Padding&#x27; </span><br><span class="line">        );</span><br><span class="line">        echo $jsonp, &#x27;(&#x27;, json_encode($arr), &#x27;)&#x27;;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>演示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;jsonp演示&lt;/title&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;a href=&quot;javascript:;&quot; onclick=&quot;get_jsonp()&quot;&gt;获取数据!(jsonp)&lt;/a&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function get_jsonp()&#123;</span><br><span class="line">$jsonp(&#x27;http://www.hzmilo.com/me.php?r=/xhr2/send2&#x27;,&#123;&quot;id&quot;:1001&#125;,function(data)&#123;</span><br><span class="line">alert(data.name);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>因为大多数网站不会开启server端的访问控制，所以xhr2目前比较适用于自己所属的几个域名下网站的连结,并且放弃ie6、7。<br>JSONP应用倒是很普遍，很多网站开放API的时候，也会用jsonp的形式给js提供接口，这样一来，使得ajax也能直接调用到API，当然只限一些普通的无需授权即用的接口。</p><p>然而很多网站并未开放API, 也未在服务端设置callback之类的参数，而我们也不想自己写server端代码去抓取。<br>那么我们可以试试中间代理：<a href="http://developer.yahoo.com/yql/">http://developer.yahoo.com/yql/</a></p><p>演示：我们抓取一下我很喜欢的一个电影网站（dianying.fm）的数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;yql演示&lt;/title&gt;</span><br><span class="line">&lt;script src=&quot;/public/js/extend.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;a href=&quot;javascript:;&quot; onclick=&quot;get_yql()&quot;&gt;获取数据!(jsonp代理)&lt;/a&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function get_yql()&#123;</span><br><span class="line">$jsonp(&#x27;http://query.yahooapis.com/v1/public/yql&#x27;,&#123;</span><br><span class="line">q: &quot;select * from json where url=\&quot;http://dianying.fm/reflect/cannes/e30=/2\&quot;&quot;,</span><br><span class="line">    format: &quot;json&quot;&#125;,function(data)&#123;</span><br><span class="line">alert(data.query.results.json.html);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;XMLHttpRequest Level 2的功能已经大幅提升了，&lt;br&gt;参见：&lt;a href=&quot;http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html&quot;&gt;http://www.ruanyifen</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>使用Three.js展现3D模型</title>
    <link href="https://www.cssass.com/2012/02/24/%E4%BD%BF%E7%94%A8Three-js%E5%B1%95%E7%8E%B03D%E6%A8%A1%E5%9E%8B/"/>
    <id>https://www.cssass.com/2012/02/24/%E4%BD%BF%E7%94%A8Three-js%E5%B1%95%E7%8E%B03D%E6%A8%A1%E5%9E%8B/</id>
    <published>2012-02-24T02:49:35.000Z</published>
    <updated>2023-06-29T03:32:01.607Z</updated>
    
    <content type="html"><![CDATA[<p>CSS3的3d-Transform，Canvas，SVG，WebGL等等技术的出现和发展，正将网页的3D化慢慢变得简单友好，但是3D建模毕竟有其很高的专业性，所以如果拥有一个内心强大，接口简洁的库就能使我们得心应手许多。Three.js便是备受推崇的一个，尽管API的变动，简陋的文档会让我们的上手比较困难。</p><p>下面我提供一个入门Demo，及一个用Three.js展示通用的3D模型格式的Demo。（注意：确保你使用的浏览器支持了Canvas，及WebGL。拥有一个先进的浏览器，将为你带来更好的上网体验。Test）</p><p>下面是入门Demo，加了注释。详细入门教程可以到这里Getting Started with Three.js</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;立方体&lt;/title&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot; src=&quot;/blog/resource/threejs/three.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;style&gt;body&#123;overflow:hidden;&#125;&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">/* 场景 */</span><br><span class="line">var WIDTH = document.documentElement.offsetWidth || 800,</span><br><span class="line">HEIGHT = document.documentElement.clientHeight || 600;</span><br><span class="line">var scene = new THREE.Scene();</span><br><span class="line">/* 摄像头 */</span><br><span class="line">var VIEW_ANGLE = 75,</span><br><span class="line">ASPECT = WIDTH / HEIGHT,</span><br><span class="line">NEAR = 0.1,</span><br><span class="line">FAR = 10000;</span><br><span class="line">varcamera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR); /* 摄像机视角，视口长宽比，近切面，远切面 */</span><br><span class="line">camera.position.set(0, 0, 1000); //放置位置</span><br><span class="line">scene.add(camera);</span><br><span class="line">/* 显示对象 */</span><br><span class="line">var geometry = new THREE.CubeGeometry( 200, 200, 200 ), //几何属性。代码位于&quot;\src\extras\geometries&quot;</span><br><span class="line">material = new THREE.MeshLambertMaterial( &#123; color: 0xcccccc&#125; ); //材质属性 &quot;\src\materials&quot;</span><br><span class="line">var cube = new THREE.Mesh(geometry, material);</span><br><span class="line">cube.rotation.set(10,20,10); //放置角度</span><br><span class="line">scene.add(cube);</span><br><span class="line">/* 灯光 */</span><br><span class="line">var light = new THREE.DirectionalLight(0xFFFFFF); //直线光,&quot;\src\lights&quot;</span><br><span class="line">light.position.set(0, 0, 100).normalize();</span><br><span class="line">scene.add(light);</span><br><span class="line">/* 渲染器 */</span><br><span class="line">varrenderer = new THREE.CanvasRenderer(); //有Canvas，WebGL，SVG三种模式</span><br><span class="line">renderer.setSize(WIDTH , HEIGHT);</span><br><span class="line">document.body.appendChild(renderer.domElement);</span><br><span class="line">/* 动画 */</span><br><span class="line">(function anime()&#123;</span><br><span class="line">cube.rotation.x += 0.01; //改变立方体角度</span><br><span class="line">renderer.render(scene, camera); //开始渲染</span><br><span class="line">return requestAnimationFrame(anime);</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>考虑到Opera还不支持WebGL，上面使用了Canvas模式渲染。但WebGL的渲染模式要比Canvas快的要多的多。</p><p>下面是一个展示机器人MGA-411 Mangusa模型的Demo。<br>Three.js可以调用以Json格式存储模型信息的js文件来创建模型。模型你可以自己在3D软件上建模完成，或在网上下载。至于模型格式，你可以通过three.js提供的插件在Blender这款开源3D制作软件中将一些3D模型格式，如3ds，obj等，转换成符合three.js标准的js格式。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;MGA-411 Mangusa&lt;/title&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot; src=&quot;/blog/resource/threejs/three.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;style&gt;body&#123;overflow:hidden;background:#000&#125;&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;Loading&quot; style=&quot;color:#fff&quot;&gt;Loading...&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">/* 场景 */</span><br><span class="line">var WIDTH = document.documentElement.offsetWidth || 800,</span><br><span class="line">HEIGHT = document.documentElement.clientHeight || 600;</span><br><span class="line">var scene = new THREE.Scene();</span><br><span class="line">/* 摄像头 */</span><br><span class="line">var VIEW_ANGLE = 75,</span><br><span class="line">ASPECT = WIDTH / HEIGHT,</span><br><span class="line">NEAR = 0.1,</span><br><span class="line">FAR = 10000;</span><br><span class="line">varcamera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);</span><br><span class="line">camera.position.set(0, 0, 1000);</span><br><span class="line">scene.add(camera);</span><br><span class="line">/* 渲染器 */</span><br><span class="line">varrenderer = new THREE.WebGLRenderer();</span><br><span class="line">renderer.setSize(WIDTH , HEIGHT);</span><br><span class="line">document.body.appendChild(renderer.domElement);</span><br><span class="line">/* 灯光 */</span><br><span class="line">var light = new THREE.DirectionalLight(0xFFFFFF);</span><br><span class="line">light.position.set(0, 0, 99).normalize();</span><br><span class="line">scene.add(light);</span><br><span class="line">/* 显示对象 */</span><br><span class="line">var material = new THREE.MeshLambertMaterial(&#123; color: 0xcccccc, wireframe: true &#125;),</span><br><span class="line">obj;</span><br><span class="line">var loader = new THREE.JSONLoader(true);</span><br><span class="line">    loader.load(&quot;/blog/resource/threejs/model/MGA.js&quot;, function ( geometry ) &#123;</span><br><span class="line">var loading = document.getElementById(&quot;Loading&quot;);</span><br><span class="line">loading.parentNode.removeChild(loading);</span><br><span class="line">obj = new THREE.Mesh(geometry, material);</span><br><span class="line">obj.position.set(0,1,990);</span><br><span class="line">scene.add(obj);</span><br><span class="line">var start = new Date().getTime(),delta;</span><br><span class="line">(function anime()&#123;</span><br><span class="line">delta = new Date().getTime() - start;</span><br><span class="line">obj.rotation.y =   delta / 1000;</span><br><span class="line">renderer.render(scene, camera);</span><br><span class="line">return requestAnimationFrame(anime);</span><br><span class="line">&#125;)();</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;CSS3的3d-Transform，Canvas，SVG，WebGL等等技术的出现和发展，正将网页的3D化慢慢变得简单友好，但是3D建模毕竟有其很高的专业性，所以如果拥有一个内心强大，接口简洁的库就能使我们得心应手许多。Three.js便是备受推崇的一个，尽管API的变动，</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CSS3——体验Firefox10的3D Transform</title>
    <link href="https://www.cssass.com/2012/02/01/CSS3%E2%80%94%E2%80%94%E4%BD%93%E9%AA%8CFirefox10%E7%9A%843D%20Transform/"/>
    <id>https://www.cssass.com/2012/02/01/CSS3%E2%80%94%E2%80%94%E4%BD%93%E9%AA%8CFirefox10%E7%9A%843D%20Transform/</id>
    <published>2012-02-01T02:31:30.000Z</published>
    <updated>2023-06-29T02:47:43.786Z</updated>
    
    <content type="html"><![CDATA[<p>之前写了一篇CSS3的崛起——体验webkit的3D-Effect。<br>随着firefox10正式版发布，firefox也支持3D Transform了，所以补充一篇，将上篇中的代码移植过来，支持firefox。</p><p>这里先穿插介绍下firefox10的新特性，firefox10除了支持3D Transform，还提供了Fullscreen API，令人兴奋吧。另外firefox10成为Mozila首个“长期支持版本”(Extended Support Release，简称“ESR”)，这种当然是市场考虑啦，至于是什么用意和市场反响我们就不探讨了。</p><p>下面是演示demo，只支持firefox10。 chrome浏览器的用户可以参考上一篇。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;firefox10&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body &#123; background-color:#deddcd;&#125;</span><br><span class="line">#movieposters &#123; list-style:none; margin:100px;&#125;</span><br><span class="line">#movieposters li &#123;float:left;</span><br><span class="line">-moz-perspective: 500px;</span><br><span class="line">&#125;</span><br><span class="line">/* 图片3d变换效果 */</span><br><span class="line">#movieposters li img &#123; border:10px solid #fcfafa;-moz-box-shadow:0 3px 10px #888;</span><br><span class="line">-moz-transform: rotateY(30deg);</span><br><span class="line">-moz-transition-property: -moz-transform;</span><br><span class="line">-moz-transition-duration: 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li:hover img &#123;-moz-transform: rotateY(0deg); &#125;</span><br><span class="line">/* 文字框3d变换效果 */</span><br><span class="line">.movieinfo &#123;border:10px solid #fcfafa; padding:0 10px; width:120px; height:100px; background-color:#deddcd; margin:-125px 0 0 55px; position:absolute;-moz-box-shadow:0 10px 20px #888;</span><br><span class="line">-moz-transform: translateZ(30px) rotateY(30deg);</span><br><span class="line">-moz-transition-property: -moz-transform, box-shadow, margin;</span><br><span class="line">-moz-transition-duration: 0.5s; &#125;</span><br><span class="line">#movieposters li:hover .movieinfo &#123;-moz-box-shadow:0 5px 10px #888; margin:-105px 0 0 30px;</span><br><span class="line">-moz-transform: rotateY(0deg); &#125;</span><br><span class="line">.movieinfo h3 &#123;color:#7a3f3a;font-family:Georgia; text-align:center; &#125;</span><br><span class="line">.movieinfo p &#123;padding:10px 0;&#125;</span><br><span class="line">.movieinfo a &#123; display:block; background:#7a3f3a; padding:3px 0; color:#eee; text-decoration:none; text-align:center; margin:0 auto;-moz-border-radius:5px; &#125;</span><br><span class="line">.movieinfo a:hover, .movieinfo a:focus &#123; background-color:#6a191f; color:#fff; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul id=&quot;movieposters&quot;&gt;</span><br><span class="line">&lt;li&gt;</span><br><span class="line">&lt;img src=&#x27;http://www.cssass.com/blog/resource/avatar/avatar_m.jpg&#x27; width=&#x27;200&#x27; /&gt;</span><br><span class="line">&lt;div class=&quot;movieinfo&quot;&gt;</span><br><span class="line">&lt;h3&gt;Avatar 2&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;You like a baby&lt;/p&gt;</span><br><span class="line">&lt;a href=&quot;http://www.cssass.com&quot; title=&quot;I see you&quot;&gt;More info&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;li&gt;</span><br><span class="line">&lt;img src=&#x27;http://www.cssass.com/blog/resource/avatar/avatar_m.jpg&#x27; width=&#x27;200&#x27; /&gt;</span><br><span class="line">&lt;div class=&quot;movieinfo&quot;&gt;</span><br><span class="line">&lt;h3&gt;Avatar 2&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;You like a baby&lt;/p&gt;</span><br><span class="line">&lt;a href=&quot;http://www.cssass.com&quot; title=&quot;I see you&quot;&gt;More info&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;li&gt;</span><br><span class="line">&lt;img src=&#x27;http://www.cssass.com/blog/resource/avatar/avatar_m.jpg&#x27; width=&#x27;200&#x27; /&gt;</span><br><span class="line">&lt;div class=&quot;movieinfo&quot;&gt;</span><br><span class="line">&lt;h3&gt;Avatar 2&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;You like a baby&lt;/p&gt;</span><br><span class="line">&lt;a href=&quot;http://www.cssass.com&quot; title=&quot;I see you&quot;&gt;More info&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>去除一些效果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;firefox10&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;list-style:none; &#125;</span><br><span class="line">body &#123; background:#deddcd;margin:100px;&#125;</span><br><span class="line">#movieposters li &#123;float:left;</span><br><span class="line">-moz-perspective: 500px;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li img &#123;</span><br><span class="line">-moz-transform: rotateY(30deg);</span><br><span class="line">-moz-transition-property: -moz-transform;</span><br><span class="line">-moz-transition-duration: 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li:hover img &#123;</span><br><span class="line">-moz-transform: rotateY(0deg);</span><br><span class="line">&#125;</span><br><span class="line">.movieinfo &#123;</span><br><span class="line">position:absolute; width:120px; height:100px; background:#fff; margin:-125px 0 0 55px;</span><br><span class="line">-moz-transform: translateZ(30px) rotateY(30deg);</span><br><span class="line">-moz-transition-property: -moz-transform, margin;</span><br><span class="line">-moz-transition-duration: 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li:hover .movieinfo &#123;</span><br><span class="line">margin:-105px 0 0 40px;</span><br><span class="line">-moz-transform: rotateY(0deg);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul id=&quot;movieposters&quot;&gt;</span><br><span class="line">&lt;li&gt;</span><br><span class="line">&lt;img src=&#x27;http://www.cssass.com/blog/resource/avatar/avatar_m.jpg&#x27; width=&#x27;200&#x27; /&gt;</span><br><span class="line">&lt;div class=&quot;movieinfo&quot;&gt;</span><br><span class="line">(未设置transform-style，默认为plat)</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>使用preserve-3d，实现全方位3D</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;firefox10&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;list-style:none; &#125;</span><br><span class="line">body &#123; background:#deddcd;margin:100px;&#125;</span><br><span class="line">#movieposters&#123;</span><br><span class="line">-moz-perspective: 1000px;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li &#123;float:left;</span><br><span class="line">-moz-animation: spin 10s infinite linear;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li.first&#123;</span><br><span class="line">-moz-transform-style: preserve-3d;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li.second&#123;</span><br><span class="line">-moz-transform-style: plat;</span><br><span class="line">&#125;</span><br><span class="line"> @-moz-keyframes spin &#123;</span><br><span class="line">      from &#123; -moz-transform: rotateY(0); &#125;</span><br><span class="line">      to   &#123; -moz-transform: rotateY(360deg); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">#movieposters li img &#123;</span><br><span class="line">-moz-transform: rotateY(30deg);</span><br><span class="line">-moz-transition-property: -moz-transform;</span><br><span class="line">-moz-transition-duration: 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li:hover img &#123;</span><br><span class="line">-moz-transform: rotateY(0deg);</span><br><span class="line">&#125;</span><br><span class="line">.movieinfo &#123;</span><br><span class="line">position:absolute; width:120px; height:100px; background:#fff; margin:-125px 0 0 55px;</span><br><span class="line">-moz-transform: translateZ(30px) rotateY(30deg);</span><br><span class="line">-moz-transition-property: -moz-transform, margin;</span><br><span class="line">-moz-transition-duration: 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">#movieposters li:hover .movieinfo &#123;</span><br><span class="line">margin:-105px 0 0 40px;</span><br><span class="line">-moz-transform: rotateY(0deg);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul id=&quot;movieposters&quot;&gt;</span><br><span class="line">&lt;li class=&#x27;first&#x27;&gt;</span><br><span class="line">&lt;img src=&#x27;http://www.cssass.com/blog/resource/avatar/avatar_m.jpg&#x27; width=&#x27;200&#x27; /&gt;</span><br><span class="line">&lt;div class=&quot;movieinfo&quot;&gt;</span><br><span class="line">Avatar 2 (preserve-3d)</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;li class=&#x27;second&#x27;&gt;</span><br><span class="line">&lt;img src=&#x27;http://www.cssass.com/blog/resource/avatar/avatar_m.jpg&#x27; width=&#x27;200&#x27; /&gt;</span><br><span class="line">&lt;div class=&quot;movieinfo&quot;&gt;</span><br><span class="line">Avatar 2 (plat)</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>最后说明一下firefox和webkit间使用的一点差别：<br>火狐10下的3D Transforms在设置perspective属性值时必须带单位px，webkit可以省略；<br>另外，webkit在用transition-property设置transform这个值时，可以不用前缀，而firefox需要写上-moz-transform;</p><p>现在综合Webkit和Firefox，写一个效果，顺便也兼用下另两个属性：transition 和 animation</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;link href=&#x27;http://fonts.googleapis.com/css?family=Ultra&amp;v2&#x27; rel=&#x27;stylesheet&#x27; type=&#x27;text/css&#x27;&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body&#123;background:#333;&#125;</span><br><span class="line">h1&#123;font:normal 90px/1.5 &#x27;Ultra&#x27;,&#x27;Curlz MT&#x27;,&#x27;Bauhaus 93&#x27;,&#x27;Blackoak Std&#x27;,Courier,Arial;color:#7e9409;position:absolute;top:85px;left:10px;width:300px;</span><br><span class="line">/* animation */</span><br><span class="line">-moz-animation: 1s slidein;</span><br><span class="line">-webkit-animation: 1s slidein;</span><br><span class="line">/* 3d-transform */</span><br><span class="line">-webkit-perspective: 600;</span><br><span class="line">-moz-perspective: 600px;</span><br><span class="line">&#125;</span><br><span class="line">@-moz-keyframes slidein &#123;</span><br><span class="line">from &#123;top:1550px;&#125;</span><br><span class="line">85% &#123;top:5px;&#125;</span><br><span class="line">to &#123;top:85px;&#125;</span><br><span class="line">&#125;</span><br><span class="line">@-webkit-keyframes slidein &#123;</span><br><span class="line">from &#123;top:1550px;&#125;</span><br><span class="line">85% &#123;top:5px;&#125;</span><br><span class="line">to &#123;top:85px;&#125;</span><br><span class="line">&#125;</span><br><span class="line">.myLogo,.myLogo a&#123;</span><br><span class="line">/*  transition */</span><br><span class="line">-moz-transition: all 2s ease-in-out 0s;</span><br><span class="line">-webkit-transition:all 2s ease-in-out 0;</span><br><span class="line">transition:all 2s ease-in-out 0;</span><br><span class="line">&#125;</span><br><span class="line">.myLogo&#123;position:relative;display:inline-block;zoom:1;top:0;left:0;text-shadow:-2px -1px 1px #7e9409;opacity: 0.8;filter:alpha(opacity=50);</span><br><span class="line">-webkit-transform: rotateY(30deg);</span><br><span class="line">-moz-transform: rotateY(30deg);</span><br><span class="line">transform: rotateY(30deg);</span><br><span class="line">&#125;</span><br><span class="line">h1:hover .myLogo &#123;</span><br><span class="line"> /* 3d-transform */</span><br><span class="line"> -webkit-transform: rotateY(0);</span><br><span class="line">-moz-transform: rotateY(0);</span><br><span class="line">transform: rotateY(0);</span><br><span class="line">text-shadow:0;</span><br><span class="line">&#125;</span><br><span class="line">.myLogo a&#123;position:absolute;top:1px;left:5px;color:#B7D902;text-shadow:-1px -1px 1px #fff;text-decoration: none;&#125;</span><br><span class="line">h1:hover .myLogo a&#123;left: 2px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;h1&gt;</span><br><span class="line">&lt;span class=&quot;myLogo&quot;&gt;</span><br><span class="line">CSSASS</span><br><span class="line">&lt;a href=&quot;http://www.cssass.com/blog/&quot;&gt;CSSASS&lt;/a&gt;</span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前写了一篇CSS3的崛起——体验webkit的3D-Effect。&lt;br&gt;随着firefox10正式版发布，firefox也支持3D Transform了，所以补充一篇，将上篇中的代码移植过来，支持firefox。&lt;/p&gt;
&lt;p&gt;这里先穿插介绍下firefox10的新特性</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>canvas的像素级操作——4.关注性能</title>
    <link href="https://www.cssass.com/2012/01/17/canvas%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BA%A7%E6%93%8D%E4%BD%9C%E2%80%94%E2%80%944-%E5%85%B3%E6%B3%A8%E6%80%A7%E8%83%BD/"/>
    <id>https://www.cssass.com/2012/01/17/canvas%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BA%A7%E6%93%8D%E4%BD%9C%E2%80%94%E2%80%944-%E5%85%B3%E6%B3%A8%E6%80%A7%E8%83%BD/</id>
    <published>2012-01-17T02:29:03.000Z</published>
    <updated>2023-06-29T02:36:47.427Z</updated>
    
    <content type="html"><![CDATA[<p>我们开篇就提过，canvas的像素级操作相对来说是很低效的。</p><p>我们试着写一个图片切割效果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;效率相关&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;board&quot; width=&quot;100&quot; height=&quot;110&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function splinter(ctx,imgPixels)&#123;</span><br><span class="line">var round = 0; //统计循环次数</span><br><span class="line">for(var y = 0; y &lt; imgPixels.height; y++)&#123;</span><br><span class="line">for(var x = 0; x &lt; imgPixels.width; x++)&#123;</span><br><span class="line">/* 虽然只调用了putImageData一个方法，但是操作的data非常多 */</span><br><span class="line">ctx.putImageData(imgPixels, x, y, x, y, 1 ,1); //后四个参数控制显示区域</span><br><span class="line">round ++ ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return round;</span><br><span class="line">&#125;</span><br><span class="line">function demo(img)&#123;</span><br><span class="line">var w = img.width,</span><br><span class="line">h = img.height;</span><br><span class="line">var temp = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">temp.width = w;</span><br><span class="line">temp.height = h;</span><br><span class="line">var tempCtx = temp.getContext(&#x27;2d&#x27;);</span><br><span class="line">tempCtx.drawImage(img, 0, 0, w, h);</span><br><span class="line">var ctx = document.getElementById(&#x27;board&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">var imgPixels = tempCtx.getImageData(0, 0, w, h);</span><br><span class="line">return splinter(ctx,imgPixels);</span><br><span class="line">&#125;</span><br><span class="line">(function()&#123;</span><br><span class="line">var img = new Image();</span><br><span class="line">img.src = &quot;/blog/resource/avatar/avatar_s.jpg&quot;;</span><br><span class="line">img.width = 50;</span><br><span class="line">img.height = 55;</span><br><span class="line">img.onload = function()&#123;</span><br><span class="line">var d = new Date();</span><br><span class="line">var func = demo(img);</span><br><span class="line">alert(&quot;耗时：&quot; + (new Date() - d) + &quot;(ms)，\n共执行了&quot; + func + &quot;次的putImageData&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>对于这个效果，因为我们并不需要操作图像的rgba数据，而只是把图像进行分割，所以利用putImageData的后四个可见区参数进行了设置就行了。<br>但是，这样做的性能却非常不理想。因为我们操作的ImageData数据实在太多了，循环执行了2750遍，相当于我们对整幅图像进行了2750次的像素级复制，而其实在可见区之外的ImageData数据并不是我们所需要的。</p><p>那么，我们在对源图getImageData的时候，可以只获取我们需要的ImageData。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;效率相关&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;board&quot; width=&quot;100&quot; height=&quot;110&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function splinter(ctx,tempCtx, w, h)&#123;</span><br><span class="line">var newData = [];</span><br><span class="line">var round = 0; //统计循环次数</span><br><span class="line">for(var y = 0; y &lt; h; y++)&#123;</span><br><span class="line">newData[y] = [];</span><br><span class="line">for(var x = 0; x &lt; w; x++)&#123;</span><br><span class="line">newData[y][x] = tempCtx.getImageData(x, y, 1, 1); //分开获取所需要的ImageData</span><br><span class="line">ctx.putImageData(newData[y][x], x*2, y*2);</span><br><span class="line">round ++ ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return round;</span><br><span class="line">&#125;</span><br><span class="line">function demo(img)&#123;</span><br><span class="line">var w = img.width,</span><br><span class="line">h = img.height;</span><br><span class="line">var temp = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">temp.width = w;</span><br><span class="line">temp.height = h;</span><br><span class="line">var tempCtx = temp.getContext(&#x27;2d&#x27;);</span><br><span class="line">tempCtx.drawImage(img, 0, 0, w, h);</span><br><span class="line">var ctx =  document.getElementById(&#x27;board&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">return round = splinter(ctx,tempCtx, w, h);</span><br><span class="line">&#125;</span><br><span class="line">(function()&#123;</span><br><span class="line">var img = new Image();</span><br><span class="line">img.src = &quot;/blog/resource/avatar/avatar_s.jpg&quot;;</span><br><span class="line">img.width = 50;</span><br><span class="line">img.height = 55;</span><br><span class="line">img.onload = function()&#123;</span><br><span class="line">var d = new Date();</span><br><span class="line">var func = demo(img);</span><br><span class="line">alert(&quot;耗时：&quot; + (new Date() - d) + &quot;(ms)，\n共执行了&quot; + func + &quot;次的getImageData和putImageData&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>第二种做法虽然在循环的时候多运行了一个方法（共执行2750次的getImageData和putImageData方法），但因为操作的ImageData少了2750倍，所以在效率上比第一种方式高了很多。</p><p>但从流程上来讲，我们只需要在刚开始的时候获取一次源图的ImageData（执行getImageData），对数据进行再排列后，最后再输出一次新的ImageData（执行putImageData）就可以了。<br>根本不需要在循环中反复调用getImageData和putImageData。所以现在的关键点是get和put之间的如何对数据进行重排列。</p><p>ImageData.data可以看做一个矩形矩阵，我们已知，它的序列号（n）与ImageData.width(w),及x轴序列号(x),y轴序列号（y）的关系是：n &#x3D; ((y * w) + x) * 4; （其中的4表示了RGBA四个数据）。我们要的新的输出ImageData，其实是x加倍，y加倍，w加倍的一个新矩阵。那么新矩阵序号与原x,y,w的关系式应该是：t &#x3D; ((y * 2 * w * 2) + x * 2) * 4;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;效率相关&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;board&quot; width=&quot;100&quot; height=&quot;110&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function splinter(ctx,imgPixels)&#123;</span><br><span class="line">var round = 0; //统计循环次数</span><br><span class="line">var n = 0,</span><br><span class="line">w = imgPixels.width,</span><br><span class="line">h = imgPixels.height,</span><br><span class="line">newdata = ctx.createImageData(w*2, h*2);</span><br><span class="line">for(var y = 0; y &lt; h; y++)&#123;</span><br><span class="line">for(var x = 0; x &lt; w; x++)&#123;</span><br><span class="line">n = ((y * w) + x) * 4; /* data序号n与x,y,w的关系 */</span><br><span class="line">t = ((y * 2 * w * 2) + x * 2) * 4; /* 分割后，y,x,w都变大了一倍 */</span><br><span class="line">newdata.data[t] =  imgPixels.data[n];</span><br><span class="line">newdata.data[t + 1] =  imgPixels.data[n + 1];</span><br><span class="line">newdata.data[t + 2] =  imgPixels.data[n + 2];</span><br><span class="line">newdata.data[t + 3] =  imgPixels.data[n + 3];</span><br><span class="line">round ++ ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ctx.putImageData(newdata, 0, 0);</span><br><span class="line">return round;</span><br><span class="line">&#125;</span><br><span class="line">function demo(img)&#123;</span><br><span class="line">var w = img.width,</span><br><span class="line">h = img.height;</span><br><span class="line">var temp = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">temp.width = w;</span><br><span class="line">temp.height = h;</span><br><span class="line">var tempCtx = temp.getContext(&#x27;2d&#x27;);</span><br><span class="line">tempCtx.drawImage(img, 0, 0, w, h);</span><br><span class="line">var ctx = document.getElementById(&#x27;board&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">var imgPixels = tempCtx.getImageData(0, 0, w, h);</span><br><span class="line">return splinter(ctx,imgPixels);</span><br><span class="line">&#125;</span><br><span class="line">(function()&#123;</span><br><span class="line">var img = new Image();</span><br><span class="line">img.src = &quot;/blog/resource/avatar/avatar_s.jpg&quot;;</span><br><span class="line">img.width = 50;</span><br><span class="line">img.height = 55;</span><br><span class="line">img.onload = function()&#123;</span><br><span class="line">var d = new Date();</span><br><span class="line">var func = demo(img);</span><br><span class="line">alert(&quot;耗时：&quot; + (new Date() - d) + &quot;(ms)，\n共循环了&quot; + func + &quot;次,循环内不执行getImageData和putImageData方法&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>第三种方法相对于第二种方法的效率提高了十几倍。第三种方法的关键点是找出新旧矩阵之间的关系，对于我们这一例来说还比较容易，复杂一点的，算法可就没这么简单了。</p><p>——————————————<br>重要补充：</p><p>我们先总结下三种方法：第一种：效率低差，但理解起来最简单。第三种，算法复杂，但效率最高。第二种，折中。<br>然而，如果使用的是webkit，opera浏览器，我们会发现第一种方法的效率比之第三种方法居然差不了多少！<br>可以看出webkit,opera对putImageData做过优化。对于putImageData(imgdata, x, y, x, y, 1 ,1)方法，webkit,opera只对（x,y,1,1）这个1平方px区域内的数据进行了put操作，区域外的数据并没有进行操作，这样在效率上会有很大的提高。<br>可惜的是firefox(9)就没有做过优化。要加油啊，Mozila！<br>最新测试了下ie9，结果显示第一种方法的效率的确很低，而第二种方法比第一种方法的效率还要低一倍。看来ie9果然也没用对putImageData进行优化，而且ie9下的getImageData也没用像其他浏览器下那么优化。对于getImageData(x,y,1,1)的获取，它操作的整个图像的像素数据的，而不是那个1平方px内的数据。</p><p>目前来说，考虑到各个浏览器原生方法的效率问题，第三种方法是最优的，即不要反复调用getImageData和putmageData，因为某些浏览器下一旦调用就是操作全部imageData的，而不会看你的参数。不过在未来，各个浏览器肯定会对原生方法进行优化的，在考虑第一种方法的时候就不用有所顾忌了！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;我们开篇就提过，canvas的像素级操作相对来说是很低效的。&lt;/p&gt;
&lt;p&gt;我们试着写一个图片切割效果。&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cla</summary>
      
    
    
    
    
    <category term="canvas" scheme="https://www.cssass.com/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>canvas的像素级操作——3.使用卷积矩阵</title>
    <link href="https://www.cssass.com/2012/01/12/canvas%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BA%A7%E6%93%8D%E4%BD%9C%E2%80%94%E2%80%943-%E4%BD%BF%E7%94%A8%E5%8D%B7%E7%A7%AF%E7%9F%A9%E9%98%B5/"/>
    <id>https://www.cssass.com/2012/01/12/canvas%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BA%A7%E6%93%8D%E4%BD%9C%E2%80%94%E2%80%943-%E4%BD%BF%E7%94%A8%E5%8D%B7%E7%A7%AF%E7%9F%A9%E9%98%B5/</id>
    <published>2012-01-12T02:25:48.000Z</published>
    <updated>2023-06-29T02:27:24.134Z</updated>
    
    <content type="html"><![CDATA[<p>利用卷积矩阵(Convolution Matrix)操作像素，我们可以很方便的得到诸如模糊、边缘检测、锐化、浮雕和斜角这样的效果。</p><p>常用的矩阵类型是 3 x 3 矩阵，另外还有5 x 5的矩阵。</p><p>工作原理：<a href="http://flex4jiaocheng.com/blog/280">http://flex4jiaocheng.com/blog/280</a></p><p>点阵图中的每一个像素被称为“初步像素”，用与卷积矩阵同样面积的“初步像素”从左到右从上到下与卷积矩阵中相应位置的值相乘，再将得到的9个或25个中间值相加，就得到了“初步像素”矩阵中央的一个值的结果值再与Divisor（因子）相除，与Offset（偏移量）相加，最后得到终值。如下图所示：</p><p>应用卷积矩阵实现特效:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;利用卷积矩阵实现特效&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas1&quot; width=&quot;200&quot; height=&quot;200&quot; title=&quot;浮雕效果&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas2&quot; width=&quot;200&quot; height=&quot;200&quot; title=&quot;边缘检测&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas3&quot; width=&quot;200&quot; height=&quot;200&quot; title=&quot;锐化&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas4&quot; width=&quot;200&quot; height=&quot;200&quot; title=&quot;基本模糊&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas5&quot; width=&quot;200&quot; height=&quot;200&quot; &gt;&lt;/canvas&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function convolution(imgPixels, matrix, divisor, offset)&#123;</span><br><span class="line">/* 卷积矩阵应用函数 */</span><br><span class="line">    var w = imgPixels.width,</span><br><span class="line">h = imgPixels.height,</span><br><span class="line">d = imgPixels.data;</span><br><span class="line">var canvas = document.createElement(&#x27;canvas&#x27;),</span><br><span class="line">ctx = canvas.getContext(&#x27;2d&#x27;),</span><br><span class="line">newImgPixels = ctx.createImageData(w,h);</span><br><span class="line">for (var y = 1; y &lt; h-1; y++) &#123;</span><br><span class="line">for (var x = 1; x &lt; w-1; x++) &#123;</span><br><span class="line">for (var c = 0; c &lt; 3; c++) &#123;</span><br><span class="line">/* RGB通道 */</span><br><span class="line">var i = (y*w + x)*4 + c;</span><br><span class="line">newImgPixels.data[i]=(matrix[0]*d[i-(w+1)*4] + matrix[1]*d[i-w*4] + matrix[2]*d[i-(w-1)*4]</span><br><span class="line">+ matrix[3]*d[i-4]       + matrix[4]*d[i]     + matrix[5]*d[i+4]</span><br><span class="line">+ matrix[6]*d[i+(w-1)*4] + matrix[7]*d[i+w*4] + matrix[8]*d[i+(w+1)*4])</span><br><span class="line">/ divisor + offset;</span><br><span class="line">&#125;</span><br><span class="line">newImgPixels.data[(y*w + x)*4 + 3] = 255;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    return newImgPixels;</span><br><span class="line">&#125;</span><br><span class="line">(function()&#123;</span><br><span class="line">/* demo */</span><br><span class="line">var imgObj = new Image();</span><br><span class="line">imgObj.src = &#x27;/blog/resource/avatar/avatar_s.jpg&#x27;;</span><br><span class="line">var embossing = &#123;</span><br><span class="line">/* 浮雕效果 */</span><br><span class="line">matrix : [-2, -1, 0,</span><br><span class="line">  -1,  1, 1,</span><br><span class="line">   0,  1, 2],</span><br><span class="line">divisor: 1,</span><br><span class="line">offset : 0</span><br><span class="line">&#125;,</span><br><span class="line">edge = &#123;</span><br><span class="line">/* 边缘检测 */</span><br><span class="line">matrix : [0, -1, 0,</span><br><span class="line"> -1,  4, -1,</span><br><span class="line">  0, -1, 0],</span><br><span class="line">divisor: 1,</span><br><span class="line">offset : 0</span><br><span class="line">&#125;,</span><br><span class="line">sharpening = &#123;</span><br><span class="line">/* 锐化 */</span><br><span class="line">matrix : [ 0, -1, 0,</span><br><span class="line">  -1,  5, -1,</span><br><span class="line">  0,  -1, 0],</span><br><span class="line">divisor: 1,</span><br><span class="line">offset : 0</span><br><span class="line">&#125;,</span><br><span class="line">blur = &#123;</span><br><span class="line">/* 基本模糊 */</span><br><span class="line">matrix : [0, 1, 0,</span><br><span class="line">  1, 1, 1,</span><br><span class="line">  0, 1, 0],</span><br><span class="line">divisor: 5,</span><br><span class="line">offset : 0</span><br><span class="line">&#125;,</span><br><span class="line">oneboys = &#123;</span><br><span class="line">/* 胡诌的一个矩阵 */</span><br><span class="line">matrix : [ 0, 1, 4,</span><br><span class="line">  -1,  5, -1,</span><br><span class="line">  3,  -1, 2],</span><br><span class="line">divisor: 5,</span><br><span class="line">offset : 0</span><br><span class="line">&#125;;</span><br><span class="line">function process(obj,effect)&#123;</span><br><span class="line">var context = document.getElementById(obj).getContext(&#x27;2d&#x27;);</span><br><span class="line">context.drawImage(imgObj, 0, 0);</span><br><span class="line">var imgPixels = context.getImageData(0, 0, imgObj.width, imgObj.height);</span><br><span class="line">imgPixels = convolution(imgPixels, effect.matrix, effect.divisor, effect.offset)</span><br><span class="line">context.putImageData(imgPixels, 0, 0, 0, 0, imgPixels.width, imgPixels.height);</span><br><span class="line">&#125;</span><br><span class="line">var canvas = document.getElementsByTagName(&#x27;canvas&#x27;);</span><br><span class="line">for(var i = 0, l = canvas.length; i &lt; l; i++ )&#123;</span><br><span class="line">var loadObj = new Load(canvas[i]);</span><br><span class="line">(function(obj)&#123;</span><br><span class="line">obj.loading();</span><br><span class="line">imgObj.addEventListener(&#x27;load&#x27;,obj.loaded,false);</span><br><span class="line">&#125;)(loadObj);</span><br><span class="line">&#125;;</span><br><span class="line">imgObj.addEventListener(&#x27;load&#x27;,function()&#123;</span><br><span class="line">process(&#x27;canvas1&#x27;,embossing);</span><br><span class="line">process(&#x27;canvas2&#x27;,edge);</span><br><span class="line">process(&#x27;canvas3&#x27;,sharpening);</span><br><span class="line">process(&#x27;canvas4&#x27;,blur);</span><br><span class="line">process(&#x27;canvas5&#x27;,oneboys);</span><br><span class="line">&#125;,false);</span><br><span class="line">&#125;)()</span><br><span class="line">/* 以下与示例代码无关 */</span><br><span class="line">function Load(canvas)&#123;</span><br><span class="line">/* canvas Loading 效果 */</span><br><span class="line">var backCtx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">backWidth = canvas.width;</span><br><span class="line">backHeight = canvas.height;</span><br><span class="line">var drawIntervalID,</span><br><span class="line">spokes = 7;</span><br><span class="line">vardrawPad = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">drawPad.width = 30;</span><br><span class="line">drawPad.height = 30;</span><br><span class="line">vardrawCtx = drawPad.getContext(&#x27;2d&#x27;);</span><br><span class="line">drawCtx.translate(drawPad.width/2, drawPad.height/2);</span><br><span class="line">drawCtx.lineWidth = 5;</span><br><span class="line">drawCtx.lineCap = &quot;round&quot;;</span><br><span class="line">drawCtx.strokeStyle = &quot;rgba(0,0,0,0.1)&quot;;</span><br><span class="line">drawCtx.fillStyle = &quot;#fff&quot;;</span><br><span class="line">var draw = function()&#123;</span><br><span class="line">drawCtx.fillRect(0,0, drawPad.width ,drawPad.height);</span><br><span class="line">drawCtx.rotate(Math.PI*2/spokes);</span><br><span class="line">for (var i=0; i&lt;spokes; i++) &#123;</span><br><span class="line">drawCtx.rotate(Math.PI*2/spokes);</span><br><span class="line">drawCtx.beginPath();</span><br><span class="line">drawCtx.moveTo(0,8);</span><br><span class="line">drawCtx.lineTo(0,10);</span><br><span class="line">drawCtx.stroke();</span><br><span class="line">&#125;</span><br><span class="line">backCtx.drawImage(drawPad,(backWidth - drawPad.width)/2, (backHeight - drawPad.height)/2);</span><br><span class="line">&#125;</span><br><span class="line">this.loading = function()&#123;</span><br><span class="line"> drawIntervalID = setInterval(draw,200);</span><br><span class="line">&#125;</span><br><span class="line">this.loaded = function()&#123;</span><br><span class="line">clearInterval(drawIntervalID);</span><br><span class="line">backCtx.clearRect((backWidth - drawPad.width)/2, (backHeight - drawPad.height)/2, drawPad.width ,drawPad.height);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>上面demo中卷积的实现函数来自于在HTML 5 的 Canvas 中应用卷积矩阵对图像处理</p><p>推荐一篇有趣的文章：卷积的物理意义</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;利用卷积矩阵(Convolution Matrix)操作像素，我们可以很方便的得到诸如模糊、边缘检测、锐化、浮雕和斜角这样的效果。&lt;/p&gt;
&lt;p&gt;常用的矩阵类型是 3 x 3 矩阵，另外还有5 x 5的矩阵。&lt;/p&gt;
&lt;p&gt;工作原理：&lt;a href=&quot;http://flex</summary>
      
    
    
    
    
    <category term="canvas" scheme="https://www.cssass.com/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>canvas的像素级操作——1.引子</title>
    <link href="https://www.cssass.com/2012/01/06/canvas%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BA%A7%E6%93%8D%E4%BD%9C%E2%80%94%E2%80%941-%E5%BC%95%E5%AD%90/"/>
    <id>https://www.cssass.com/2012/01/06/canvas%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BA%A7%E6%93%8D%E4%BD%9C%E2%80%94%E2%80%941-%E5%BC%95%E5%AD%90/</id>
    <published>2012-01-06T02:16:32.000Z</published>
    <updated>2023-06-29T02:26:20.936Z</updated>
    
    <content type="html"><![CDATA[<p>本文是对《MDC的canvas经典教程辑和个人学习笔记》的补遗，也是canvas像素级操作系列文章的一个引子。</p><p>既然是引子，那就不能开门见山的介绍了，我们先讲讲如何复制canvas.<br>已知一个image对象，我们将其绘制进canvas的方法是什么？drawImage。（当然使用createPattern模板填充也是一个方法）。<br>那已知一个canvas对象，我们将其绘制进另一个canvas的方法呢？<br>答案还是drawImage，drawImage算是一个很辽阔的方法了，不仅可以绘image，也可以绘canvas对象，甚至还可以绘video的帧。</p><p>并且他拥有大量参数：(Image [, vXSrc] [, vYSrc] [, vWSrc] [, vHSrc], vXDest, vYDest [, vWDest] [, vHDest])，这个读者可以先不管，往下看。</p><p>那么，除了drawImage这个方法，还有没有其他方法呢——有，putImageData方法隆重登场。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;canvas绘制与复制及像素级复制&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;原图：imgObj&lt;br /&gt;</span><br><span class="line">&lt;img id=&quot;imgObj&quot; src=&quot;/blog/resource/avatar/avatar_s.jpg&quot; width=&quot;200&quot; /&gt;</span><br><span class="line">&lt;p&gt;canvas中绘制的图：MyCanvas&lt;br /&gt;</span><br><span class="line">&lt;canvas id=&quot;MyCanvas&quot; width=&quot;200&quot; height=&quot;220&quot; &gt; &lt;/canvas&gt;</span><br><span class="line">&lt;p&gt;从MyCanvas复制过来的图：YourCanvas&lt;br /&gt;</span><br><span class="line">&lt;canvas id=&quot;YourCanvas&quot; width=&quot;200&quot; height=&quot;220&quot;&gt; &lt;/canvas&gt;</span><br><span class="line">&lt;p&gt;从MyCanvas的ImageData复制来的图：GodCanvas （注意，这里只是为了引出canvas的像素级操作，通常像素级操作是很低效的）&lt;br /&gt;</span><br><span class="line">&lt;canvas id=&quot;GodCanvas&quot; width=&quot;200&quot; height=&quot;220&quot;&gt; &lt;/canvas&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function draw()&#123;</span><br><span class="line">/* 在canvas中绘制image */</span><br><span class="line">var canvas1 = document.getElementById(&quot;MyCanvas&quot;);</span><br><span class="line">var ctx1 = canvas1.getContext(&quot;2d&quot;);</span><br><span class="line">ctx1.drawImage(imgObj,0,0);</span><br><span class="line">&#125;</span><br><span class="line">function clone()&#123;</span><br><span class="line">/* 在canvas2中绘制canvas1 ——普通复制 */</span><br><span class="line">var origin = document.getElementById(&quot;MyCanvas&quot;);</span><br><span class="line">var canvas2 = document.getElementById(&quot;YourCanvas&quot;);</span><br><span class="line">var ctx2 = canvas2.getContext(&quot;2d&quot;);</span><br><span class="line">ctx2.drawImage(origin,0,0); //drawImage不仅可以绘image，也可以绘canvas对象，甚至还可以绘video的帧</span><br><span class="line">&#125;</span><br><span class="line">function cloneData(canvasObj)&#123;</span><br><span class="line">/* 获取canvas1中的ImageData，在canvas3中输出 ——像素级复制 */</span><br><span class="line">var origin = document.getElementById(&quot;MyCanvas&quot;);</span><br><span class="line">var canvas3 = document.getElementById(&quot;GodCanvas&quot;);</span><br><span class="line">var ctx3 = canvas3.getContext(&quot;2d&quot;);</span><br><span class="line">var canvasCtx = origin.getContext(&quot;2d&quot;);</span><br><span class="line">var imagePix = canvasCtx.getImageData(0,0,origin.width,origin.height); // 获取canvas1绘图环境下的参数范围内的imageData。</span><br><span class="line">ctx3.putImageData(imagePix,0,0);    //putImageData输出图像</span><br><span class="line">&#125;</span><br><span class="line">/* 以下与示例代码无关 */</span><br><span class="line">function Load(canvas)&#123;</span><br><span class="line">/* canvas Loading 效果 */</span><br><span class="line">var backCtx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">backWidth = canvas.width;</span><br><span class="line">backHeight = canvas.height;</span><br><span class="line">var drawIntervalID,</span><br><span class="line">spokes = 7;</span><br><span class="line">vardrawPad = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">drawPad.width = 30;</span><br><span class="line">drawPad.height = 30;</span><br><span class="line">vardrawCtx = drawPad.getContext(&#x27;2d&#x27;);</span><br><span class="line">drawCtx.translate(drawPad.width/2, drawPad.height/2);</span><br><span class="line">drawCtx.lineWidth = 5;</span><br><span class="line">drawCtx.lineCap = &quot;round&quot;;</span><br><span class="line">drawCtx.strokeStyle = &quot;rgba(0,0,0,0.1)&quot;;</span><br><span class="line">drawCtx.fillStyle = &quot;#fff&quot;;</span><br><span class="line">var draw = function()&#123;</span><br><span class="line">drawCtx.fillRect(0,0, drawPad.width ,drawPad.height);</span><br><span class="line">drawCtx.rotate(Math.PI*2/spokes);</span><br><span class="line">for (var i=0; i&lt;spokes; i++) &#123;</span><br><span class="line">drawCtx.rotate(Math.PI*2/spokes);</span><br><span class="line">drawCtx.beginPath();</span><br><span class="line">drawCtx.moveTo(0,8);</span><br><span class="line">drawCtx.lineTo(0,10);</span><br><span class="line">drawCtx.stroke();</span><br><span class="line">&#125;</span><br><span class="line">backCtx.drawImage(drawPad,(backWidth - drawPad.width)/2, (backHeight - drawPad.height)/2);</span><br><span class="line">&#125;</span><br><span class="line">this.loading = function()&#123;</span><br><span class="line"> drawIntervalID = setInterval(draw,200);</span><br><span class="line">&#125;</span><br><span class="line">this.loaded = function()&#123;</span><br><span class="line">clearInterval(drawIntervalID);</span><br><span class="line">backCtx.clearRect((backWidth - drawPad.width)/2, (backHeight - drawPad.height)/2, drawPad.width ,drawPad.height);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">var imgObj = document.getElementById(&quot;imgObj&quot;);</span><br><span class="line">var canvas = document.getElementsByTagName(&#x27;canvas&#x27;);</span><br><span class="line">for(var i = 0, l = canvas.length; i &lt; l; i++ )&#123;</span><br><span class="line">var loadObj = new Load(canvas[i]);</span><br><span class="line">(function(obj)&#123;</span><br><span class="line">obj.loading();</span><br><span class="line">imgObj.addEventListener(&#x27;load&#x27;,obj.loaded,false);</span><br><span class="line">&#125;)(loadObj);</span><br><span class="line">&#125;</span><br><span class="line">imgObj.addEventListener(&#x27;load&#x27;,function()&#123;</span><br><span class="line">draw();</span><br><span class="line">clone();</span><br><span class="line">cloneData();</span><br><span class="line">&#125;,false);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>上面的cloneData方法就是通过将源canvas中像素数据ImageData，输出(putImageData)到新的canvas中，达到复制作用。</p><p>不过，我们在获取和输出ImageData的过程中，并没有对ImageData做过任何处理，而这个ImageData数据是包含{width,height,CanvasPixelArray},其中CanvasPixelArray包含了图像(canvas也可看做图像)的每一个像素的RGBA数据，可见中间的操作空间是很大的，以后我们会做重点讨论。</p><p>插注：CanvasPixelArray——在最新标准中已引入一个Uint8ClampedArray的Typed Array来替代 ，在各浏览器实现之后，将使得对ImageData的操作更快速更便捷。参考例子：<a href="http://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/">http://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/</a></p><p>下面介绍一下像素操作的三个方法：</p><p>createImageData();<br>getImageData();<br>putImageData();</p><p>createImageData的参数是(w,h)可以新建一个W*H尺寸的新的ImageData【firefox3.5开始支持】，不过也可以使用参数(anotherImageData)来创建【firefox5开始支持】。</p><p>getImageData的参数（x,y,w,h）表示起点x,y,尺寸w,h。可以获取canvas.context中在参数范围内的ImageData。</p><p>putImageData的参数使用要着重要介绍下（和drawImage的参数可以触类旁通）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;putImageData的参数&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">canvas&#123;border:1px solid #ccc;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas1&quot; width=&quot;300&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas2&quot; width=&quot;300&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">(function draw()&#123;</span><br><span class="line">var canvas0 = document.createElement(&quot;canvas&quot;),</span><br><span class="line">ctx = canvas0.getContext(&quot;2d&quot;);</span><br><span class="line">var canvas1 = document.getElementById(&quot;canvas1&quot;),</span><br><span class="line">ctx1 = canvas1.getContext(&quot;2d&quot;);</span><br><span class="line">var canvas2 = document.getElementById(&quot;canvas2&quot;),</span><br><span class="line">ctx2 = canvas2.getContext(&quot;2d&quot;);</span><br><span class="line">var img = new Image();</span><br><span class="line">img.src=&quot;/blog/resource/avatar/avatar_s.jpg&quot;;</span><br><span class="line">img.onload=function()&#123;</span><br><span class="line">canvas0.width = img.width;</span><br><span class="line">canvas0.height = img.height;</span><br><span class="line">ctx.drawImage(img,0,0);</span><br><span class="line">var imagePix = ctx.getImageData(0,0,canvas0.width,canvas0.height);</span><br><span class="line">/* putImageData参数(ImageData, dx, dy [, DirtyX] [, DirtyX] [, DirtyWidth] [, DirtyHeight]) */</span><br><span class="line">ctx1.putImageData(imagePix,30,30);  //imageData（包含了width,height,还有一个CanvasPixelArray）；dx, dy表示绘图起始位置</span><br><span class="line">ctx2.putImageData(imagePix,0,0,100,100,50,50); //后面四个可选参数表示可见区范围。缺省为：0,0,ImageData.width,ImageData.height</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>putImageData参数有(ImageData, dx, dy [, DirtyX] [, DirtyX] [, DirtyWidth] [, DirtyHeight])</p><p>imageData：包含了图像的width,height,还有一个CanvasPixelArray，前面已经提了。<br>dx, dy：表示绘图起始位置。相对于canvas区域左上角。<br>后面四个可选参数：表示可见区范围。相对于起绘点，即上面的参数dx,dy表示的点。缺省为0,0,ImageData.width,ImageData.height。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文是对《MDC的canvas经典教程辑和个人学习笔记》的补遗，也是canvas像素级操作系列文章的一个引子。&lt;/p&gt;
&lt;p&gt;既然是引子，那就不能开门见山的介绍了，我们先讲讲如何复制canvas.&lt;br&gt;已知一个image对象，我们将其绘制进canvas的方法是什么？dra</summary>
      
    
    
    
    
    <category term="canvas" scheme="https://www.cssass.com/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>如何获取元素的尺寸和位置——两个冷门方法</title>
    <link href="https://www.cssass.com/2012/01/04/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E7%9A%84%E5%B0%BA%E5%AF%B8%E5%92%8C%E4%BD%8D%E7%BD%AE%E2%80%94%E2%80%94%E4%B8%A4%E4%B8%AA%E5%86%B7%E9%97%A8%E6%96%B9%E6%B3%95/"/>
    <id>https://www.cssass.com/2012/01/04/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E7%9A%84%E5%B0%BA%E5%AF%B8%E5%92%8C%E4%BD%8D%E7%BD%AE%E2%80%94%E2%80%94%E4%B8%A4%E4%B8%AA%E5%86%B7%E9%97%A8%E6%96%B9%E6%B3%95/</id>
    <published>2012-01-04T02:13:56.000Z</published>
    <updated>2023-06-29T03:04:57.430Z</updated>
    
    <content type="html"><![CDATA[<p>获取元素的尺寸，似乎offsetWidth&#x2F;Height就可以了，还需要什么方法吗？<br>的确，一般情况下，获取元素尺寸，用offsetWidth&#x2F;Height就搞定了，但如果这个元素是display:none的呢？<br>试验一下就知道，none元素的尺寸是0。</p><p>所以需要我们下面的这个方法来获取。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;获取display:none元素的size&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body&#123;color:#ccc;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;box&quot; style=&quot;width:100px;height:100px;padding:20px;border:10px solid #ccc;display:none;&quot;&gt;asdd&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function $id(o)&#123;</span><br><span class="line">return document.getElementById(o);</span><br><span class="line">&#125;</span><br><span class="line">var getSize = function(elem)&#123;</span><br><span class="line">if(elem.offsetWidth !== 0)&#123;</span><br><span class="line">/* 元素不是display:none的情况，这个时候是能得到尺寸的 */</span><br><span class="line">return &#123;&#x27;width&#x27;:elem.offsetWidth,</span><br><span class="line">&#x27;height&#x27;:elem.offsetHeight</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">var old = &#123;&#125;;</span><br><span class="line">/* 将display:none元素设成visibility:hidden */</span><br><span class="line">var options = &#123; position: &quot;absolute&quot;, visibility: &quot;hidden&quot;, display:&quot;block&quot; &#125;</span><br><span class="line">for ( var name in options ) &#123;</span><br><span class="line">old[ name ] = elem.style[ name ];</span><br><span class="line">elem.style[ name ] = options[ name ];</span><br><span class="line">&#125;</span><br><span class="line">var temp = &#123;&#x27;width&#x27;:elem.offsetWidth,</span><br><span class="line">&#x27;height&#x27;:elem.offsetHeight&#125;;</span><br><span class="line">for ( var name in options ) &#123;</span><br><span class="line">elem.style[ name ] = old[ name ];</span><br><span class="line">&#125;</span><br><span class="line">return temp;</span><br><span class="line">&#125;;</span><br><span class="line">alert(getSize($id(&quot;box&quot;)).height)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>第二个，获取元素的位置。<br>或许你经常使用offsetLeft&#x2F;Top来获取位置，不过offsetLeft&#x2F;Top是相对 offsetParent的位置（在ie6，7下是相对直接父级的),并且在firefox下还有些小bug</p><p>下面这个方法提供获取元素相对于窗口（页面可视区）的距离。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;元素相对窗口左上角的值（ie下没有width，height值）&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">#box&#123;position:absolute;left:200px;width:100px;height:200px;border:5px solid #ccc;background:#eee;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;box&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var box = document.getElementById(&quot;box&quot;);</span><br><span class="line">var pos = box.getBoundingClientRect();</span><br><span class="line">box.innerHTML = &quot;top:&quot;+pos.top +</span><br><span class="line">&quot;&lt;br /&gt;left:&quot;+pos.left +</span><br><span class="line">&quot;&lt;br /&gt;bottom:&quot;+pos.bottom +</span><br><span class="line">&quot;&lt;br /&gt;right:&quot;+pos.right +</span><br><span class="line">&quot;&lt;br /&gt;width:&quot;+pos.width +</span><br><span class="line">&quot;&lt;br /&gt;height:&quot;+pos.height</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>这个方法是由ie提出的，不过在其他浏览器吸收之后，还加了width，height两个值。</p><p>重复一下，这个方法是相对于页面窗口的，至于相对于整个页面文档的距离，那只需加上scrollTop这些值就行了，不做赘述。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;获取元素的尺寸，似乎offsetWidth&amp;#x2F;Height就可以了，还需要什么方法吗？&lt;br&gt;的确，一般情况下，获取元素尺寸，用offsetWidth&amp;#x2F;Height就搞定了，但如果这个元素是display:none的呢？&lt;br&gt;试验一下就知道，none元素</summary>
      
    
    
    
    
    <category term="DOM" scheme="https://www.cssass.com/tags/DOM/"/>
    
  </entry>
  
  <entry>
    <title>mouseenter/mouseleave事件和delegate方法的实现</title>
    <link href="https://www.cssass.com/2011/12/18/mouseenter-mouseleave%E4%BA%8B%E4%BB%B6%E5%92%8Cdelegate%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>https://www.cssass.com/2011/12/18/mouseenter-mouseleave%E4%BA%8B%E4%BB%B6%E5%92%8Cdelegate%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0/</id>
    <published>2011-12-18T03:20:54.000Z</published>
    <updated>2023-06-29T03:24:38.847Z</updated>
    
    <content type="html"><![CDATA[<p>众所周知，事件onmouseover和onmouseout有一个极其不好的问题，就是在绑定元素内部的子元素上滑动会反复触发事件，及执行绑定的方法。</p><p>而ie在很早的时候有提供了另一对事件：mouseenter和mouseleaver。顾名思义，就是只有当mouse滑进滑出绑定元素的时候，才会触发。</p><p>但是，这本来只是ie的私有属性，虽然已属于DOM3 Event草案当中，其他浏览器的支持率并不是很高，目前看来，Opera11.10已提供支持，而Firefox到10.0会提供支持，Webkit的暂无消息。<br>所以，如果想要用，我们得自己动手。</p><p>先搞一个通用的事件绑定函数：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var addEvent = function( target,type,fn ) &#123;</span><br><span class="line">    if(target.addEventListener)</span><br><span class="line">    &#123;</span><br><span class="line">        target.addEventListener(type,fn,false);</span><br><span class="line">    &#125;</span><br><span class="line">    else if(target.attachEvent)</span><br><span class="line">    &#123;</span><br><span class="line">        target.attachEvent(&quot;on&quot; + type,fn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var removeEvent = function(target,type,fn ) &#123;</span><br><span class="line">    if(target.addEventListener)</span><br><span class="line">    &#123;</span><br><span class="line">        target.removeEventListener(type,fn,false);</span><br><span class="line">    &#125;</span><br><span class="line">    else if(target.attachEvent)</span><br><span class="line">    &#123;</span><br><span class="line">        target.detachEvent(&quot;on&quot; + type,fn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><br>我们的mouseenter&#x2F;leave是通过mouseover&#x2F;out来实现的，只需屏蔽mouseover&#x2F;out在元素内部触发时的事件传播即可。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;实现mouseenter、mouseleave事件&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.outer&#123;padding:50px;background:#aaa;&#125;</span><br><span class="line">.inner&#123;height:100px;background:#eee;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;outer&quot; class=&quot;outer&quot;&gt;</span><br><span class="line">只有移进移出外框的时候才执行方法。对内框操作不执行。click点击解除绑定。</span><br><span class="line">&lt;div id=&quot;inner&quot; class=&quot;inner&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var $id=function(o)&#123;return document.getElementById(o) || o;&#125;</span><br><span class="line">var events = &#123;&#125;</span><br><span class="line">events._mouseFn =&#123;&#125;; //保存“onmouseenter”和“onmouseleave”所绑定的方法</span><br><span class="line">events._mouseHandle = function(fn)&#123;</span><br><span class="line">/* 转换方法，符合条件时才会执行 */</span><br><span class="line">var func = function(event)&#123;</span><br><span class="line">var target = event.target;</span><br><span class="line">var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点</span><br><span class="line">while( parent &amp;&amp; parent != this )&#123;</span><br><span class="line">try&#123; parent = parent.parentNode; &#125;</span><br><span class="line">catch(e)&#123;break;&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */</span><br><span class="line">( parent != this ) &amp;&amp; (fn.call(target,event));</span><br><span class="line">&#125;;</span><br><span class="line">return func;</span><br><span class="line">&#125;</span><br><span class="line">events.addEvent = function( obj,type,fn ) &#123;</span><br><span class="line">if(obj.addEventListener)</span><br><span class="line">    &#123;</span><br><span class="line">if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">//for opera11，firefox10。他们也支持“onmouseenter”和“onmouseleave”，可以直接绑定</span><br><span class="line">obj.addEventListener(type,fn,false);</span><br><span class="line">return ;</span><br><span class="line">&#125;</span><br><span class="line">if(type==&quot;mouseenter&quot; || type==&quot;mouseleave&quot; )&#123;</span><br><span class="line">var eType = (type==&quot;mouseenter&quot;) ? &quot;mouseover&quot; : &quot;mouseout&quot;;</span><br><span class="line">var fnNew = events._mouseHandle(fn);</span><br><span class="line">obj.addEventListener(eType,fnNew,false);</span><br><span class="line"> /* 将方法存入events._mouseFn，以便以后remove */</span><br><span class="line">if(!events._mouseFn[obj]) events._mouseFn[obj] = &#123;&#125;;</span><br><span class="line">if(!events._mouseFn[obj][eType]) events._mouseFn[obj][eType] = &#123;&#125;;</span><br><span class="line">events._mouseFn[obj][eType][fn] = fnNew;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">obj.addEventListener(type,fn,false);</span><br><span class="line">&#125;</span><br><span class="line">    &#125;else if(obj.attachEvent)</span><br><span class="line">    &#123;</span><br><span class="line">// for ie</span><br><span class="line">        obj.attachEvent(&quot;on&quot; + type,fn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">events.removeEvent = function(obj,type,fn ) &#123;</span><br><span class="line">    if(obj.addEventListener)</span><br><span class="line">    &#123;</span><br><span class="line">if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">obj.removeEventListener(type,fn,false);</span><br><span class="line">return ;</span><br><span class="line">&#125;</span><br><span class="line">if(type==&quot;mouseenter&quot; || type==&quot;mouseleave&quot; )&#123;</span><br><span class="line">var eType = (type==&quot;mouseenter&quot;) ? &quot;mouseover&quot; : &quot;mouseout&quot;;</span><br><span class="line">if(!events._mouseFn[obj][eType][fn]) return;</span><br><span class="line">obj.removeEventListener(eType,events._mouseFn[obj][eType][fn],false);</span><br><span class="line">events._mouseFn[obj][eType][fn] = null;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">obj.removeEventListener(type,fn,false);</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else if(obj.attachEvent)</span><br><span class="line">    &#123;</span><br><span class="line">        obj.detachEvent(&quot;on&quot; + type,fn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">(function()&#123;</span><br><span class="line">/* 这里是演示demo 绑定解除事件 */</span><br><span class="line">var outer = $id(&quot;outer&quot;),</span><br><span class="line">inner = $id(&quot;inner&quot;);</span><br><span class="line">events.addEvent(outer,&quot;mouseenter&quot;,add);</span><br><span class="line">events.addEvent(outer,&quot;mouseleave&quot;,add);</span><br><span class="line">events.addEvent(outer,&quot;click&quot;,remove);</span><br><span class="line">function add()&#123;</span><br><span class="line">var e = arguments[0] || window.event;</span><br><span class="line">var target = e.srcElement || e.target;</span><br><span class="line">inner.innerHTML = target.id + &#x27; &#x27; + e.type;</span><br><span class="line">&#125;</span><br><span class="line">function remove()&#123;</span><br><span class="line">events.removeEvent(outer,&quot;mouseenter&quot;,add);</span><br><span class="line">events.removeEvent(outer,&quot;mouseleave&quot;,add)</span><br><span class="line">inner.innerHTML = &quot;click&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><br>为了解除绑定，我们设计了一个events._mouseFn来保存绑定的方法，在解除操作时读取对应的方法进行解绑。因为事件可以绑定多个方法，我们需要保存对应的方法，以便之后对应解除。<br>当然如果这里如果按面向对象的思路实现，就可以各自保存，而不需要保持在同一个events._mouseFn对象下。但每绑定一个事件，都需实例化一个对象，显得很多余，所以不采用面向对象的模式。</p><p>接下来是文章的第二部分，我们来实现下jquery中提供的delegate方法。<br>（delegate是live方法的扩展版。delegate是基于live的，live是基于bind的。在jquery1.7中又被封装进了on方法。1.7中的on方法是一个很辽阔的方法。其实封装的越厉害，效率就越差了，这也是为什么我们选择自己做简单封装的原因，而不是使用jquery已封装好的）。<br>这个方法可以将想要绑定在子级元素上的事件方法，委托绑定在其父级上，用事件传播机制来触发执行。<br>这么做的好处有：<br>1：如果子级有n个并列元素需要绑定，绑子级需要绑n次，而将其绑定在父级上则只需绑定一次，这是很高效的。<br>2：如果子级元素有动态增加的话，新增元素是没有绑定过任何事件方法的。而如果之前选择的是绑定其父级，就不会有这个问题。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;delegate委托绑定事件方法的实现&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.outer&#123;padding:50px;background:#aaa;zoom:1;&#125;</span><br><span class="line">.inner&#123;display:block;height:50px;margin:5px;background:#eee;border:1px solid #ccc;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;outer&quot; class=&quot;outer&quot;&gt;</span><br><span class="line">&lt;div id=&quot;message&quot;&gt;点击下面框体&lt;/div&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;1:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;2:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;3:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;4:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;5:&lt;/span&gt;</span><br><span class="line">&lt;div id=&quot;unbind&quot;&gt;点击解除绑定&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">//一些通用方法</span><br><span class="line">var $id=function(o)&#123;return document.getElementById(o) || o;&#125;</span><br><span class="line">var isDOMs = function(target)&#123;</span><br><span class="line">return target.length &gt;= 0 &amp;&amp; target !== window &amp;&amp; !target.tagName;  //!target.tagName排除FORM,SELECT等元素</span><br><span class="line">&#125;;</span><br><span class="line">var hasClass = function(target,className)&#123;</span><br><span class="line">if(!target || !className) return false;</span><br><span class="line">if(target[0]) target = target[0];</span><br><span class="line">var pattern = new RegExp(&quot;(^|\\s)&quot;+className+&quot;(\\s|$)&quot;);</span><br><span class="line">return pattern.test(target.className);</span><br><span class="line">&#125;</span><br><span class="line">//正式开始</span><br><span class="line">window.events = &#123;&#125;</span><br><span class="line">events._deleFn = &#123;&#125;; //保存delegate所绑定的方法</span><br><span class="line">events._mouseFn =&#123;&#125;; //保存“onmouseenter”和“onmouseleave”所绑定的方法</span><br><span class="line">events._ieFunc = &#123;&#125;; //由于保存在ie下绑定的方法</span><br><span class="line">events._mouseHandle = function(fn)&#123;</span><br><span class="line">/* 实现mouseenter/leave 的转换方法，符合条件时才会执行 */</span><br><span class="line">var func = function(event)&#123;</span><br><span class="line">var target = event.target;</span><br><span class="line">var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点</span><br><span class="line">while( parent &amp;&amp; parent != this )&#123;</span><br><span class="line">try&#123; parent = parent.parentNode; &#125;</span><br><span class="line">catch(e)&#123;break;&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */</span><br><span class="line">( parent != this ) &amp;&amp; (fn.call(target,event));</span><br><span class="line">&#125;;</span><br><span class="line">return func;</span><br><span class="line">&#125;</span><br><span class="line">events._delegateHandle = function(obj,selector,fn)&#123;</span><br><span class="line">/* 实现delegate 的转换方法，符合条件时才会执行 */</span><br><span class="line">var func = function(event)&#123;</span><br><span class="line">var event = event || window.event;</span><br><span class="line">var target = event.srcElement || event.target;</span><br><span class="line">var parent = target;</span><br><span class="line">function contain(item,elmName)&#123;</span><br><span class="line">if(elmName.split(&#x27;#&#x27;)[1])&#123; //by id</span><br><span class="line">if(item.id &amp;&amp; item.id === elmName.split(&#x27;#&#x27;)[1]) return true;</span><br><span class="line">&#125;</span><br><span class="line">if(elmName.split(&#x27;.&#x27;)[1])&#123; //by class</span><br><span class="line">if(hasClass(item, elmName.split(&#x27;.&#x27;)[1])) return true;</span><br><span class="line">&#125;</span><br><span class="line">if(item.tagName == elmName.toUpperCase())  return true; //by tagname</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br><span class="line">while(parent)&#123;</span><br><span class="line">/* 如果触发的元素，属于(selector)元素的子级。 */</span><br><span class="line">if(obj == parent) return false; //触发元素是自己</span><br><span class="line">if(contain(parent,selector))&#123;</span><br><span class="line">fn.call(obj,event);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">parent = parent.parentNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">return func;</span><br><span class="line">&#125;;</span><br><span class="line">events.addEvent = function(target,type,fn)&#123;</span><br><span class="line">if (!target) return false;</span><br><span class="line">var add = function(obj)&#123;</span><br><span class="line">if(obj.addEventListener)&#123;</span><br><span class="line">obj.addEventListener(type,fn,false);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">// for ie</span><br><span class="line">if(!events._ieFunc[obj]) events._ieFunc[obj] = &#123;&#125;;</span><br><span class="line">if(!events._ieFunc[obj][type]) events._ieFunc[obj][type] = &#123;&#125;;</span><br><span class="line">events._ieFunc[obj][type][fn] = function()&#123;</span><br><span class="line">fn.apply(obj,arguments);</span><br><span class="line">&#125;;</span><br><span class="line">obj.attachEvent(&quot;on&quot; + type,events._ieFunc[obj][type][fn]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isDOMs(target)) &#123;</span><br><span class="line">for(var i=0, l = target.length; i &lt; l; i++)&#123;</span><br><span class="line">add(target[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">add(target);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">events.removeEvent = function(target,type,fn) &#123;</span><br><span class="line">if (!target) return false;</span><br><span class="line">    var remove = function(obj)&#123;</span><br><span class="line">    if(obj.addEventListener)&#123;</span><br><span class="line">if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">obj.removeEventListener(type,fn,false);</span><br><span class="line">return ;</span><br><span class="line">&#125;</span><br><span class="line">obj.removeEventListener(type,fn,false);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">//for ie</span><br><span class="line">if(!events._ieFunc[obj] ||!events._ieFunc[obj][type] || !events._ieFunc[obj][type][fn]) return;</span><br><span class="line">obj.detachEvent(&quot;on&quot; + type, events._ieFunc[obj][type][fn],false);</span><br><span class="line">events._ieFunc[obj][type][fn]=&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isDOMs(target)) &#123;</span><br><span class="line">for(var i=0, l = target.length; i &lt; l; i++)&#123;</span><br><span class="line">remove(target[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">remove(target);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">events.delegate = function(obj,selector,type,fn)&#123;</span><br><span class="line">if (!obj || !selector) return false;</span><br><span class="line">var fnNew = events._delegateHandle(obj,selector,fn);</span><br><span class="line">events.addEvent(obj,type,fnNew);</span><br><span class="line">/* 将绑定的方法存入events._deleFn，以便之后解绑操作 */</span><br><span class="line">if(!events._deleFn[selector]) events._deleFn[selector] = &#123;&#125;;</span><br><span class="line">if(!events._deleFn[selector][type]) events._deleFn[selector][type] = &#123;&#125;;</span><br><span class="line">events._deleFn[selector][type][fn] = fnNew;</span><br><span class="line">&#125;;</span><br><span class="line">events.undelegate = function(obj,selector,type,fn)&#123;</span><br><span class="line">if (!obj || !selector || !events._deleFn[selector]) return false;</span><br><span class="line">var fnNew = events._deleFn[selector][type][fn];</span><br><span class="line">if(!fnNew) return;</span><br><span class="line">events.removeEvent(obj,type,fnNew);</span><br><span class="line">events._deleFn[selector][type][fn] = null;</span><br><span class="line">&#125;;</span><br><span class="line">(function()&#123;</span><br><span class="line">/* 这里是演示demo*/</span><br><span class="line">var outer = $id(&quot;outer&quot;),</span><br><span class="line">msg = $id(&quot;message&quot;);</span><br><span class="line">var add = function()&#123;</span><br><span class="line">var e = arguments[0] || window.event;</span><br><span class="line">var target = e.srcElement || e.target;</span><br><span class="line">msg.innerHTML =  target.innerHTML + &#x27; &#x27; + e.type;</span><br><span class="line">&#125;</span><br><span class="line">function color()&#123;</span><br><span class="line">msg.style.color = &quot;#c00&quot;</span><br><span class="line">&#125;</span><br><span class="line">function remove()&#123;</span><br><span class="line">events.undelegate(outer,&quot;.inner&quot;,&quot;click&quot;,color);</span><br><span class="line">events.undelegate(outer,&quot;#unbind&quot;,&quot;click&quot;,remove);</span><br><span class="line">msg.style.color = &quot;#000&quot;</span><br><span class="line">msg.innerHTML = &quot;已解除绑定color方法.add方法仍在&quot;;</span><br><span class="line">&#125;</span><br><span class="line">events.delegate(outer,&quot;.inner&quot;,&quot;click&quot;,add);</span><br><span class="line">events.delegate(outer,&quot;.inner&quot;,&quot;click&quot;,color);</span><br><span class="line">events.delegate(outer,&quot;#unbind&quot;,&quot;click&quot;,remove);</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><br>这里的实现思路是这样的：如果触发事件的元素，是你想要绑定的元素的子级（当然他肯定已是委托实际绑定元素的子级），就执行绑定的事件方法，否则方法就不执行，看上去就像方法没绑定过一样。<br>同实现onmouseenter一样，我们也设计了一个events._deleFn来用于后面的解绑方法undelegate的实现。<br>另外针对ie，我们还解决了两个问题：</p><ol><li>绑定方法内的this指向问题。我们用.apply执行绑定方法来解决。</li><li>使用apply调用绑定方法，就必须考虑如何解绑方法。原理和_mouseFn还有_deleFn一样。</li></ol><p>在使用delegate时，我们同样遇到了mouseover&#x2F;out的问题。<br>我们的解决方案是：不罗嗦，直接将mouseover&#x2F;out处理成mouseenter&#x2F;leave<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;delegate委托绑定事件方法的实现&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.outer&#123;padding:50px;background:#aaa;zoom:1;&#125;</span><br><span class="line">.inner&#123;display:block;height:50px;background:#eee;border:1px solid #ccc;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;outer&quot; class=&quot;outer&quot;&gt;</span><br><span class="line">&lt;div id=&quot;message&quot;&gt;划过下面框体&lt;/div&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;1:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;2:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;3:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;4:&lt;/span&gt;</span><br><span class="line">&lt;span class=&quot;inner&quot;&gt;5:&lt;/span&gt;</span><br><span class="line">&lt;div id=&quot;unbind&quot;&gt;点击解除绑定&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var $id=function(o)&#123;return document.getElementById(o) || o;&#125;</span><br><span class="line">var isDOMs = function(target)&#123;</span><br><span class="line">return target.length &gt;= 0 &amp;&amp; target !== window &amp;&amp; !target.tagName;  //!target.tagName排除FORM,SELECT等元素</span><br><span class="line">&#125;;</span><br><span class="line">window.events = &#123;&#125;</span><br><span class="line">events._deleFn = &#123;&#125;; //保存delegate所绑定的方法</span><br><span class="line">events._mouseFn =&#123;&#125;; //保存“onmouseenter”和“onmouseleave”所绑定的方法</span><br><span class="line">events._ieFunc = &#123;&#125;; //由于保存在ie下绑定的方法</span><br><span class="line">events._mouseHandle = function(fn)&#123;</span><br><span class="line">/* 实现mouseenter/leave 的转换方法，符合条件时才会执行 */</span><br><span class="line">var func = function(event)&#123;</span><br><span class="line">var target = event.target;</span><br><span class="line">var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点</span><br><span class="line">while( parent &amp;&amp; parent != this )&#123;</span><br><span class="line">try&#123; parent = parent.parentNode; &#125;</span><br><span class="line">catch(e)&#123;break;&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */</span><br><span class="line">( parent != this ) &amp;&amp; (fn.call(target,event));</span><br><span class="line">&#125;;</span><br><span class="line">return func;</span><br><span class="line">&#125;</span><br><span class="line">events._delegateHandle = function(obj,selector,fn)&#123;</span><br><span class="line">/* 实现delegate 的转换方法，符合条件时才会执行 */</span><br><span class="line">var func = function(event)&#123;</span><br><span class="line">var event = event || window.event;</span><br><span class="line">var target = event.srcElement || event.target;</span><br><span class="line">var parent = target;</span><br><span class="line">function contain(item,elmName)&#123;</span><br><span class="line">if(elmName.split(&#x27;#&#x27;)[1])&#123; //by id</span><br><span class="line">if(item.id &amp;&amp; item.id === elmName.split(&#x27;#&#x27;)[1]) return true;</span><br><span class="line">&#125;</span><br><span class="line">if(elmName.split(&#x27;.&#x27;)[1])&#123; //by class</span><br><span class="line">if(hasClass(item, elmName.split(&#x27;.&#x27;)[1])) return true;</span><br><span class="line">&#125;</span><br><span class="line">if(item.tagName == elmName.toUpperCase())  return true; //by tagname</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br><span class="line">while(parent)&#123;</span><br><span class="line">/* 如果触发的元素，属于(selector)元素的子级。 */</span><br><span class="line">if(obj == parent) return false; //触发元素是自己</span><br><span class="line">if(contain(parent,selector))&#123;</span><br><span class="line">if(event.type == &#x27;mouseover&#x27; || event.type == &#x27;mouseout&#x27;)&#123;</span><br><span class="line">/*</span><br><span class="line">* 将mouseover/out直接处理成mouseenter/leave: 事件相关元素不属于绑定元素的子级，才绑定方法</span><br><span class="line">*/</span><br><span class="line">//事件相关元素。ie下使用toElement和fromElement，其他用relatedTarget。</span><br><span class="line">var related = event.relatedTarget || ((event.type == &#x27;mouseout&#x27;) ? event.toElement : event.fromElement);</span><br><span class="line">if(contain(target,selector) || contain(related,selector)) &#123;</span><br><span class="line">/* 如果，触发元素或相关元素属于绑定元素(selector)。执行方法 */</span><br><span class="line">fn.call(obj,event);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">while( related &amp;&amp; !contain(related,selector))&#123;</span><br><span class="line">  related = related.parentNode;</span><br><span class="line">&#125;</span><br><span class="line">/* 事件相关元素，不属于绑定元素(selector)的子级，执行方法  */</span><br><span class="line">!contain(related,selector) &amp;&amp; (fn.call(obj,event));</span><br><span class="line">&#125;else&#123;</span><br><span class="line">fn.call(obj,event);</span><br><span class="line">&#125;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">parent = parent.parentNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">return func;</span><br><span class="line">&#125;;</span><br><span class="line">events.addEvent = function(target,type,fn)&#123;</span><br><span class="line">if (!target) return false;</span><br><span class="line">var add = function(obj)&#123;</span><br><span class="line">if(obj.addEventListener)&#123;</span><br><span class="line">if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">//for opera11，firefox10。他们也支持“onmouseenter”和“onmouseleave”，可以直接绑定</span><br><span class="line">obj.addEventListener(type,fn,false);</span><br><span class="line">return ;</span><br><span class="line">&#125;</span><br><span class="line">if(type==&quot;mouseenter&quot; || type==&quot;mouseleave&quot; )&#123;</span><br><span class="line">var eType = (type==&quot;mouseenter&quot;) ? &quot;mouseover&quot; : &quot;mouseout&quot;;</span><br><span class="line">var fnNew = events._mouseHandle(fn);</span><br><span class="line">obj.addEventListener(eType,fnNew,false);</span><br><span class="line"> /* 将方法存入events._mouseFn，以便以后remove */</span><br><span class="line">if(!events._mouseFn[obj]) events._mouseFn[obj] = &#123;&#125;;</span><br><span class="line">if(!events._mouseFn[obj][eType]) events._mouseFn[obj][eType] = &#123;&#125;;</span><br><span class="line">events._mouseFn[obj][eType][fn] = fnNew;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">obj.addEventListener(type,fn,false);</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">// for ie</span><br><span class="line">if(!events._ieFunc[obj]) events._ieFunc[obj] = &#123;&#125;;</span><br><span class="line">if(!events._ieFunc[obj][type]) events._ieFunc[obj][type] = &#123;&#125;;</span><br><span class="line">events._ieFunc[obj][type][fn] = function()&#123;</span><br><span class="line">fn.apply(obj,arguments);</span><br><span class="line">&#125;;</span><br><span class="line">obj.attachEvent(&quot;on&quot; + type,events._ieFunc[obj][type][fn]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isDOMs(target)) &#123;</span><br><span class="line">for(var i=0, l = target.length; i &lt; l; i++)&#123;</span><br><span class="line">add(target[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">add(target);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">events.removeEvent = function(target,type,fn) &#123;</span><br><span class="line">if (!target) return false;</span><br><span class="line">    var remove = function(obj)&#123;</span><br><span class="line">    if(obj.addEventListener)&#123;</span><br><span class="line">if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">obj.removeEventListener(type,fn,false);</span><br><span class="line">return ;</span><br><span class="line">&#125;</span><br><span class="line">if(type==&quot;mouseenter&quot; || type==&quot;mouseleave&quot; )&#123;</span><br><span class="line">var eType = (type==&quot;mouseenter&quot;) ? &quot;mouseover&quot; : &quot;mouseout&quot;;</span><br><span class="line">if(!events._mouseFn[obj][eType][fn]) return;</span><br><span class="line">obj.removeEventListener(eType,events._mouseFn[obj][eType][fn],false);</span><br><span class="line">events._mouseFn[obj][eType][fn]=&#123;&#125;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">obj.removeEventListener(type,fn,false);</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">//for ie</span><br><span class="line">if(!events._ieFunc[obj] ||!events._ieFunc[obj][type] || !events._ieFunc[obj][type][fn]) return;</span><br><span class="line">obj.detachEvent(&quot;on&quot; + type, events._ieFunc[obj][type][fn],false);</span><br><span class="line">events._ieFunc[obj][type][fn]=&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isDOMs(target)) &#123;</span><br><span class="line">for(var i=0, l = target.length; i &lt; l; i++)&#123;</span><br><span class="line">remove(target[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">remove(target);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">events.delegate = function(obj,selector,type,fn)&#123;</span><br><span class="line">if (!obj || !selector) return false;</span><br><span class="line">var fnNew = events._delegateHandle(obj,selector,fn);</span><br><span class="line">events.addEvent(obj,type,fnNew);</span><br><span class="line">/* 将绑定的方法存入events._deleFn，以便之后解绑操作 */</span><br><span class="line">if(!events._deleFn[selector]) events._deleFn[selector] = &#123;&#125;;</span><br><span class="line">if(!events._deleFn[selector][type]) events._deleFn[selector][type] = &#123;&#125;;</span><br><span class="line">events._deleFn[selector][type][fn] = fnNew;</span><br><span class="line">&#125;;</span><br><span class="line">events.undelegate = function(obj,selector,type,fn)&#123;</span><br><span class="line">if (!obj || !selector || !events._deleFn[selector]) return false;</span><br><span class="line">var fnNew = events._deleFn[selector][type][fn];</span><br><span class="line">if(!fnNew) return;</span><br><span class="line">events.removeEvent(obj,type,fnNew);</span><br><span class="line">events._deleFn[selector][type][fn] = null;</span><br><span class="line">&#125;;</span><br><span class="line">(function()&#123;</span><br><span class="line">/* 这里是演示demo*/</span><br><span class="line">var outer = $id(&quot;outer&quot;),</span><br><span class="line">msg = $id(&quot;message&quot;);</span><br><span class="line">events.delegate(outer,&#x27;span&#x27;,&quot;mouseover&quot;,add);</span><br><span class="line">events.delegate(outer,&#x27;span&#x27;,&quot;mouseout&quot;,add);</span><br><span class="line">events.delegate(outer,&#x27;#unbind&#x27;,&quot;click&quot;,remove);</span><br><span class="line">function add()&#123;</span><br><span class="line">var e = arguments[0] || window.event;</span><br><span class="line">var target = e.srcElement || e.target;</span><br><span class="line">msg.innerHTML =  target.innerHTML + &#x27; &#x27; + e.type;</span><br><span class="line">&#125;</span><br><span class="line">function remove()&#123;</span><br><span class="line">events.undelegate(outer,&#x27;span&#x27;,&quot;mouseover&quot;,add);</span><br><span class="line">events.undelegate(outer,&#x27;span&#x27;,&quot;mouseout&quot;,add);</span><br><span class="line">events.undelegate(outer,&#x27;#unbind&#x27;,&quot;click&quot;,remove);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><br>最后，整理一下，封装一个支持mouseenter 和 mouseleave事件，delegate方法 及其他们的解除绑定的方法的 功能函数库。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">window.events = &#123;&#125;</span><br><span class="line">events._deleFn = &#123;&#125;; //保存delegate所绑定的方法   </span><br><span class="line">events._mouseFn =&#123;&#125;; //保存“onmouseenter”和“onmouseleave”所绑定的方法</span><br><span class="line">events._ieFunc = &#123;&#125;; //由于保存在ie下绑定的方法</span><br><span class="line"> </span><br><span class="line">events._mouseHandle = function(fn)&#123;</span><br><span class="line">    /* 实现mouseenter/leave 的转换方法，符合条件时才会执行 */</span><br><span class="line">    var func = function(event)&#123;</span><br><span class="line">        var target = event.target;</span><br><span class="line">        var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点</span><br><span class="line">        while( parent &amp;&amp; parent != this )&#123; </span><br><span class="line">            try&#123; parent = parent.parentNode; &#125;</span><br><span class="line">            catch(e)&#123;break;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */</span><br><span class="line">        ( parent != this ) &amp;&amp; (fn.call(target,event));</span><br><span class="line">    &#125;;</span><br><span class="line">    return func;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">events._delegateHandle = function(obj,selector,fn)&#123;</span><br><span class="line">    /* 实现delegate 的转换方法，符合条件时才会执行 */</span><br><span class="line">    var func = function(event)&#123;</span><br><span class="line">        var event = event || window.event;</span><br><span class="line">        var target = event.srcElement || event.target;</span><br><span class="line">        var parent = target;</span><br><span class="line">        function contain(item,elmName)&#123;</span><br><span class="line">            if(elmName.split(&#x27;#&#x27;)[1])&#123; //by id</span><br><span class="line">                if(item.id &amp;&amp; item.id === elmName.split(&#x27;#&#x27;)[1]) return true;</span><br><span class="line">            &#125; </span><br><span class="line">            if(elmName.split(&#x27;.&#x27;)[1])&#123; //by class</span><br><span class="line">                if(hasClass(item, elmName.split(&#x27;.&#x27;)[1])) return true;</span><br><span class="line">            &#125;</span><br><span class="line">            if(item.tagName == elmName.toUpperCase())  return true; //by tagname</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        while(parent)&#123;</span><br><span class="line">            /* 如果触发的元素，属于(selector)元素的子级。 */</span><br><span class="line">            if(obj == parent) return false; //触发元素是自己</span><br><span class="line">            if(contain(parent,selector))&#123;</span><br><span class="line">                if(event.type == &#x27;mouseover&#x27; || event.type == &#x27;mouseout&#x27;)&#123;</span><br><span class="line">                    /*</span><br><span class="line">                    * 将mouseover/out直接处理成mouseenter/leave: 事件相关元素不属于绑定元素的子级，才绑定方法</span><br><span class="line">                    */</span><br><span class="line">                    //事件相关元素。ie下使用toElement和fromElement，其他用relatedTarget。</span><br><span class="line">                    var related = event.relatedTarget || ((event.type == &#x27;mouseout&#x27;) ? event.toElement : event.fromElement);</span><br><span class="line">                    if(contain(target,selector) || contain(related,selector)) &#123;</span><br><span class="line">                        /* 如果，触发元素或相关元素属于绑定元素(selector)。执行方法 */</span><br><span class="line">                        fn.call(obj,event);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    while( related &amp;&amp; !contain(related,selector))&#123; </span><br><span class="line">                          related = related.parentNode;</span><br><span class="line">                    &#125;</span><br><span class="line">                    /* 事件相关元素，不属于绑定元素(selector)的子级，执行方法  */</span><br><span class="line">                    !contain(related,selector) &amp;&amp; (fn.call(obj,event));</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    fn.call(obj,event);</span><br><span class="line">                &#125;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            parent = parent.parentNode;   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    return func;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">events.addEvent = function(target,type,fn)&#123;</span><br><span class="line">    if (!target) return false;</span><br><span class="line">    var add = function(obj)&#123;</span><br><span class="line">        if(obj.addEventListener)&#123;   </span><br><span class="line">            if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">                //for opera11，firefox10。他们也支持“onmouseenter”和“onmouseleave”，可以直接绑定</span><br><span class="line">                obj.addEventListener(type,fn,false); </span><br><span class="line">                return ;</span><br><span class="line">            &#125;</span><br><span class="line">            if(type==&quot;mouseenter&quot; || type==&quot;mouseleave&quot; )&#123; </span><br><span class="line">                var eType = (type==&quot;mouseenter&quot;) ? &quot;mouseover&quot; : &quot;mouseout&quot;;</span><br><span class="line">                var fnNew = events._mouseHandle(fn);</span><br><span class="line">                obj.addEventListener(eType,fnNew,false);</span><br><span class="line">                 /* 将方法存入events._mouseFn，以便以后remove */</span><br><span class="line">                if(!events._mouseFn[obj]) events._mouseFn[obj] = &#123;&#125;;</span><br><span class="line">                if(!events._mouseFn[obj][eType]) events._mouseFn[obj][eType] = &#123;&#125;;</span><br><span class="line">                    events._mouseFn[obj][eType][fn] = fnNew;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                obj.addEventListener(type,fn,false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            // for ie</span><br><span class="line">            if(!events._ieFunc[obj]) events._ieFunc[obj] = &#123;&#125;;</span><br><span class="line">            if(!events._ieFunc[obj][type]) events._ieFunc[obj][type] = &#123;&#125;;</span><br><span class="line">            events._ieFunc[obj][type][fn] = function()&#123;</span><br><span class="line">                fn.apply(obj,arguments);</span><br><span class="line">            &#125;;</span><br><span class="line">            obj.attachEvent(&quot;on&quot; + type,events._ieFunc[obj][type][fn]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isDOMs(target)) &#123;</span><br><span class="line">        for(var i=0, l = target.length; i &lt; l; i++)&#123;</span><br><span class="line">            add(target[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        add(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">events.removeEvent = function(target,type,fn) &#123;</span><br><span class="line">    if (!target) return false;</span><br><span class="line">    var remove = function(obj)&#123;</span><br><span class="line">        if(obj.addEventListener)&#123;   </span><br><span class="line">            if(obj.onmouseenter !== undefined)&#123;</span><br><span class="line">                obj.removeEventListener(type,fn,false); </span><br><span class="line">                return ;</span><br><span class="line">            &#125;</span><br><span class="line">            if(type==&quot;mouseenter&quot; || type==&quot;mouseleave&quot; )&#123; </span><br><span class="line">                var eType = (type==&quot;mouseenter&quot;) ? &quot;mouseover&quot; : &quot;mouseout&quot;;</span><br><span class="line">                if(!events._mouseFn[obj][eType][fn]) return;</span><br><span class="line">                obj.removeEventListener(eType,events._mouseFn[obj][eType][fn],false);</span><br><span class="line">                events._mouseFn[obj][eType][fn]=&#123;&#125;;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                obj.removeEventListener(type,fn,false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            //for ie</span><br><span class="line">            if(!events._ieFunc[obj] ||!events._ieFunc[obj][type] || !events._ieFunc[obj][type][fn]) return;</span><br><span class="line">            obj.detachEvent(&quot;on&quot; + type, events._ieFunc[obj][type][fn],false);</span><br><span class="line">            events._ieFunc[obj][type][fn]=&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isDOMs(target)) &#123;</span><br><span class="line">        for(var i=0, l = target.length; i &lt; l; i++)&#123;</span><br><span class="line">            remove(target[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        remove(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">events.delegate = function(obj,selector,type,fn)&#123;</span><br><span class="line">    if (!obj || !selector) return false;</span><br><span class="line">    var fnNew = events._delegateHandle(obj,selector,fn);</span><br><span class="line">    events.addEvent(obj,type,fnNew);</span><br><span class="line">    /* 将绑定的方法存入events._deleFn，以便之后解绑操作 */</span><br><span class="line">    if(!events._deleFn[selector]) events._deleFn[selector] = &#123;&#125;;</span><br><span class="line">    if(!events._deleFn[selector][type]) events._deleFn[selector][type] = &#123;&#125;;</span><br><span class="line">    events._deleFn[selector][type][fn] = fnNew;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">events.undelegate = function(obj,selector,type,fn)&#123;</span><br><span class="line">    if (!obj || !selector || !events._deleFn[selector]) return false;</span><br><span class="line">    var fnNew = events._deleFn[selector][type][fn];</span><br><span class="line">    if(!fnNew) return;</span><br><span class="line">    events.removeEvent(obj,type,fnNew);</span><br><span class="line">    events._deleFn[selector][type][fn] = null;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;众所周知，事件onmouseover和onmouseout有一个极其不好的问题，就是在绑定元素内部的子元素上滑动会反复触发事件，及执行绑定的方法。&lt;/p&gt;
&lt;p&gt;而ie在很早的时候有提供了另一对事件：mouseenter和mouseleaver。顾名思义，就是只有当mous</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>瀑布流布局及扩展——格子块的智能堆砌</title>
    <link href="https://www.cssass.com/2011/10/12/%E7%80%91%E5%B8%83%E6%B5%81%E5%B8%83%E5%B1%80%E5%8F%8A%E6%89%A9%E5%B1%95%E2%80%94%E2%80%94%E6%A0%BC%E5%AD%90%E5%9D%97%E7%9A%84%E6%99%BA%E8%83%BD%E5%A0%86%E7%A0%8C/"/>
    <id>https://www.cssass.com/2011/10/12/%E7%80%91%E5%B8%83%E6%B5%81%E5%B8%83%E5%B1%80%E5%8F%8A%E6%89%A9%E5%B1%95%E2%80%94%E2%80%94%E6%A0%BC%E5%AD%90%E5%9D%97%E7%9A%84%E6%99%BA%E8%83%BD%E5%A0%86%E7%A0%8C/</id>
    <published>2011-10-12T03:16:33.000Z</published>
    <updated>2023-06-29T05:24:06.812Z</updated>
    
    <content type="html"><![CDATA[<p>图片分享网站Pinterest（beta），在不久前获得了2700$的投资，估值已超2亿元（据说现该公司团队有8人）。该网站的一大特色就是每一张分享的图片被拟作“Pin”被钉在页面上面，每一Pin依尺寸智能排列，同时滚动页面时异步加载新Pin，极具效果。这种创新模式被在国内也被广泛copy，其中最有前途的当属Mark之，以”Mark”代”Pin”,也算有些想法。</p><p>以下是利用豆瓣API数据做的效果：完整效果<br>部分代码：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;等宽格子堆砌&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">#wrap&#123;position:relative;zoom:1;margin:0px auto;&#125;</span><br><span class="line">#wrap li&#123;width:250px;float:left;list-style:none;&#125;</span><br><span class="line">.boxCont&#123;position:relative;margin:15px;border:1px solid #ccc;background:#eee;</span><br><span class="line">background: -webkit-gradient(linear, 0% 20%, 0% 92%, from(#fff), to(#f3f3f3), color-stop(.1,#fff));</span><br><span class="line">background: -webkit-linear-gradient(0 0 270deg, #f3f3f3, #f3f3f3 10%, #fff);</span><br><span class="line">background: -moz-linear-gradient(0 0 270deg, #f3f3f3, #f3f3f3 10%, #fff);</span><br><span class="line">background: -o-linear-gradient(0 0 270deg, #f3f3f3, #f3f3f3 10%, #fff);</span><br><span class="line">-webkit-border-radius: 60px / 5px;</span><br><span class="line">-moz-border-radius: 60px / 5px;</span><br><span class="line">border-radius:60px / 5px;</span><br><span class="line">-webkit-box-shadow: 0px 0px 35px rgba(0, 0, 0, 0.1) inset;</span><br><span class="line">-moz-box-shadow: 0px 0px 35px rgba(0, 0, 0, 0.1) inset;</span><br><span class="line">box-shadow: 0px 0px 35px rgba(0, 0, 0, 0.1) inset;</span><br><span class="line">&#125;</span><br><span class="line">.boxCont:before&#123;</span><br><span class="line">content: &#x27;&#x27;;</span><br><span class="line">width: 50px;</span><br><span class="line">height: 50px;</span><br><span class="line">top:0; right:0;</span><br><span class="line">position:absolute;</span><br><span class="line">display: inline-block;</span><br><span class="line">z-index:-1;</span><br><span class="line">-webkit-box-shadow: 10px -10px 8px rgba(0, 0, 0, 0.2);</span><br><span class="line">-moz-box-shadow: 10px -10px 8px rgba(0, 0, 0, 0.2);</span><br><span class="line">box-shadow: 10px -10px 8px rgba(0, 0, 0, 0.2);</span><br><span class="line">-webkit-transform: rotate(2deg) translate(-14px,20px) skew(-20deg);</span><br><span class="line">-moz-transform: rotate(2deg) translate(-14px,20px) skew(-20deg);</span><br><span class="line">-o-transform: rotate(2deg) translate(-14px,20px) skew(-20deg);</span><br><span class="line">transform: rotate(2deg) translate(-14px,20px) skew(-20deg);</span><br><span class="line">&#125;</span><br><span class="line">.boxCont:after&#123;</span><br><span class="line">content: &#x27;&#x27;;</span><br><span class="line">width: 100px;</span><br><span class="line">height: 100px;</span><br><span class="line">top:0; left:0;</span><br><span class="line">position:absolute;</span><br><span class="line">z-index:-1;</span><br><span class="line">display: inline-block;</span><br><span class="line">-webkit-box-shadow: -10px -10px 10px rgba(0, 0, 0, 0.2);</span><br><span class="line">-moz-box-shadow: -10px -10px 10px rgba(0, 0, 0, 0.2);</span><br><span class="line">box-shadow: -10px -10px 10px rgba(0, 0, 0, 0.2);</span><br><span class="line">-webkit-transform: rotate(2deg) translate(20px,25px) skew(20deg);</span><br><span class="line">-moz-transform: rotate(2deg) translate(20px,25px) skew(20deg);</span><br><span class="line">-o-transform: rotate(2deg) translate(20px,25px) skew(20deg);</span><br><span class="line">transform: rotate(2deg) translate(20px,25px) skew(20deg);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul id=&quot;wrap&quot;&gt;&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var $id = function(o)&#123; return document.getElementById(o) || o&#125;;</span><br><span class="line">function sort(el)&#123;</span><br><span class="line">var h = [];</span><br><span class="line">var box = el.getElementsByTagName(&quot;li&quot;);</span><br><span class="line">var minH = box[0].offsetHeight,</span><br><span class="line">boxW = box[0].offsetWidth,</span><br><span class="line">boxH,</span><br><span class="line">n = document.documentElement.offsetWidth / boxW | 0;  //计算页面能排下多少Pin</span><br><span class="line">el.style.width = n * boxW + &quot;px&quot;;</span><br><span class="line">for(var i = 0; i &lt; box.length; i++) &#123;</span><br><span class="line">boxh = box[i].offsetHeight; //获取每个Pin的高度</span><br><span class="line">if(i &lt; n) &#123; //第一行Pin以浮动排列，不需绝对定位</span><br><span class="line">h[i] = boxh;</span><br><span class="line">box[i].style.position = &#x27;&#x27;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">minH =  Math.min.apply(&#123;&#125;,h); //取得各列累计高度最低的一列</span><br><span class="line">minKey = getarraykey(h, minH);</span><br><span class="line">h[minKey] += boxh ; //加上新高度后更新高度值</span><br><span class="line">box[i].style.position = &#x27;absolute&#x27;;</span><br><span class="line">box[i].style.top = minH + &#x27;px&#x27;;</span><br><span class="line">box[i].style.left = (minKey * boxW) + &#x27;px&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">/* 返回数组中某一值的对应项数 */</span><br><span class="line">function getarraykey(s, v) &#123;</span><br><span class="line">for(k in s) &#123;</span><br><span class="line">if(s[k] == v) &#123;</span><br><span class="line">return k;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">/* 随机创建Pin */</span><br><span class="line">var pin = &#x27;&#x27;;</span><br><span class="line">for(i = 0; i &lt; 30; i++) &#123;</span><br><span class="line">height = Math.floor(Math.random()*200 + 200);</span><br><span class="line">pin += &#x27;&lt;li&gt;&lt;div class=&quot;boxCont&quot; style=&quot;height:&#x27; + height + &#x27;px;&quot;&gt;&lt;/div&gt;&lt;/li&gt;&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">$id(&quot;wrap&quot;).innerHTML = pin;</span><br><span class="line">window.onload = window.onresize = function() &#123;</span><br><span class="line">sort($id(&quot;wrap&quot;));</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></p><p>这种布局中虽然每个Pin的高度不尽相同，但是他们的宽度都是一样的。<br>那么假如，很邪恶的提出一个要求，宽度也不尽相同，只是说宽高都按比例成倍增加，那还怎么排列呢？<br>呵呵，如下：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;宽高尺寸不同的格子堆砌&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body&#123;background:#F6F7F8;&#125;</span><br><span class="line">.myWidget&#123;position:relative;overflow:hidden;zoom:1;margin:0 auto;&#125;</span><br><span class="line">.MBox&#123;float:left;&#125;</span><br><span class="line">.widgetBox&#123;position:relative;overflow:hidden;zoom:1;width:186px;height:166px;margin:6px;border:1px solid #E1E1E3;</span><br><span class="line">border-radius:10px;</span><br><span class="line">-moz-border-radius:10px;</span><br><span class="line">-webkit-border-radius:10px;</span><br><span class="line">box-shadow:2px 3px 5px #d3d3d3;</span><br><span class="line">-moz-box-shadow:2px 3px 5px #d3d3d3;</span><br><span class="line">-webkit-box-shadow:2px 3px 5px #d3d3d3;</span><br><span class="line">filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#fefefe, endColorstr=#e0e0e2);</span><br><span class="line">background: linear-gradient(top, #fefefe, #f6f6f6 ,#f3f3f3,#f2f2f2,#e0e0e2);</span><br><span class="line">background: -moz-linear-gradient(top, #fefefe, #f6f6f6 ,#f3f3f3,#f2f2f2,#e0e0e2);</span><br><span class="line">background: -webkit-gradient(linear, 0 0, 0 100% , from(#fefefe),to(#e0e0e2));</span><br><span class="line">background: -webkit-linear-gradient(0 0, #fefefe, #f6f6f6 ,#f3f3f3,#f2f2f2,#e0e0e2);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var $id = function(o)&#123; return document.getElementById(o) || o ;&#125;;</span><br><span class="line">var getElementsByClassName = function(className,parent,tag) &#123;</span><br><span class="line">parent = parent || document;</span><br><span class="line">    if(parent.getElementsByClassName)&#123;</span><br><span class="line">        return  parent.getElementsByClassName(className)</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        tag = tag || &#x27;*&#x27;;</span><br><span class="line">        var returnElements = []</span><br><span class="line">        var els =  parent.getElementsByTagName(tag);</span><br><span class="line">        className = className.replace(/\-/g, &quot;\\-&quot;);</span><br><span class="line">        var pattern = new RegExp(&quot;(^|\\s)&quot;+className+&quot;(\\s|$)&quot;);</span><br><span class="line">var i = 0;</span><br><span class="line">        while(i &lt; els.length)&#123;</span><br><span class="line">            if (pattern.test(els[i].className) ) &#123;</span><br><span class="line">                returnElements.push(els[i]);</span><br><span class="line">            &#125;</span><br><span class="line">i++;</span><br><span class="line">        &#125;</span><br><span class="line">        return returnElements;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">/* 格子排序 */</span><br><span class="line">var box=&#123;&#125;;</span><br><span class="line">box.gen=&#123;w:200,h:180&#125;;</span><br><span class="line">box.init=function(el)&#123;</span><br><span class="line">box.size=[]; //格子,[1,2]表示1X2的大格子</span><br><span class="line">box.obj=&#123;&#125;;</span><br><span class="line">box.oArray=[];</span><br><span class="line">box.maxY=-1;</span><br><span class="line">box.mbox = getElementsByClassName(&quot;MBox&quot;,el,&#x27;div&#x27;);</span><br><span class="line">box.row = document.documentElement.offsetWidth / box.gen.w &gt;&gt; 0;  //每行标准格数</span><br><span class="line">el.style.width = box.row * box.gen.w + &quot;px&quot;;</span><br><span class="line">var i = 0 , nx, ny;</span><br><span class="line">while( i &lt; this.mbox.length)&#123;</span><br><span class="line">if( getElementsByClassName(&quot;bigBox&quot;,this.mbox[i],&#x27;div&#x27;).length &gt; 0 )&#123;</span><br><span class="line">nx=Math.ceil(this.mbox[i].offsetWidth / this.gen.w);</span><br><span class="line">nx=(nx &gt; this.row) ? this.row : nx; //大小超出限制</span><br><span class="line">ny=Math.ceil(this.mbox[i].offsetHeight / this.gen.h);</span><br><span class="line">this.size.push([nx,ny]);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">this.size.push(1);</span><br><span class="line">&#125;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">box.sort(el);</span><br><span class="line">&#125;;</span><br><span class="line">box.setIfr=function(el)&#123;  //大格子初始化</span><br><span class="line"> var ifr = getElementsByClassName(&quot;bigBox&quot;,el,&#x27;div&#x27;);;</span><br><span class="line">   if(ifr.length==0) return false;</span><br><span class="line">var i = 0, nx, ny, theifr;</span><br><span class="line">while(i &lt; ifr.length)&#123;</span><br><span class="line">theifr =  getElementsByClassName(&quot;innerBox&quot;,ifr[i],&#x27;div&#x27;);</span><br><span class="line">nx=Math.ceil(theifr[0].offsetWidth / this.gen.w); //bigBox横向占的块数</span><br><span class="line">ny=Math.ceil(theifr[0].offsetHeight / this.gen.h);</span><br><span class="line">ifr[i].style.width = nx*this.gen.w-14 + &#x27;px&#x27; ;</span><br><span class="line">ifr[i].style.height = ny*this.gen.h-14 + &#x27;px&#x27; ;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">box.sort=function(el)&#123;</span><br><span class="line">var y=0, x=0, temp=&#123;x:Infinity, y:Infinity&#125;, flag=Infinity, name;</span><br><span class="line">for(var n=0; n &lt; this.size.length ; n++)&#123;</span><br><span class="line">if(flag == 0)&#123;</span><br><span class="line">x=temp.x;</span><br><span class="line">y=temp.y;</span><br><span class="line">&#125;</span><br><span class="line">flag=flag-1;</span><br><span class="line">if(x&gt;box.row-1)&#123; //换行</span><br><span class="line">x=0;</span><br><span class="line">y++;</span><br><span class="line">&#125;</span><br><span class="line">name=x+&#x27;_&#x27;+y;  //对象属性名（反映占领的格子）</span><br><span class="line">if(this.hasN(name)) &#123;  //判断属性名是否存在</span><br><span class="line">n--;</span><br><span class="line">x++;</span><br><span class="line">if(flag&lt;Infinity) flag=flag+1;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(!this.size[n].length)&#123;  //普通格子</span><br><span class="line">this.obj[name]=[x,y];  //项值（反映坐标值）</span><br><span class="line">x++;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;  //大格子</span><br><span class="line">if(this.over(x,y,n)) &#123;</span><br><span class="line">if(temp.y &gt; y)&#123;</span><br><span class="line">temp.y = y;</span><br><span class="line">temp.x = x;</span><br><span class="line">&#125;</span><br><span class="line">if(temp.y &lt; Infinity)&#123;</span><br><span class="line">flag=1;</span><br><span class="line">&#125;</span><br><span class="line">n--;</span><br><span class="line">x++;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">this.obj[name]=[x,y];</span><br><span class="line">this.apply(x,y,n);</span><br><span class="line">x+=this.size[n][0];</span><br><span class="line">&#125;</span><br><span class="line">if(flag==-1) &#123;</span><br><span class="line">flag = Infinity;</span><br><span class="line">temp.y = Infinity;</span><br><span class="line">temp.x = Infinity;</span><br><span class="line">&#125;</span><br><span class="line">var h=this.size[n][1]-1 || 0;</span><br><span class="line">box.maxY=(box.maxY &gt; y+h)? box.maxY : y+h;</span><br><span class="line">&#125;</span><br><span class="line">for(var i in this.obj)&#123;</span><br><span class="line">if(this.obj[i]===0 || !this.obj.hasOwnProperty(i)) continue;</span><br><span class="line">this.oArray.push(this.obj[i]);</span><br><span class="line">&#125;</span><br><span class="line">box.put(el);</span><br><span class="line">&#125;;</span><br><span class="line">box.hasN=function(n)&#123;</span><br><span class="line">return n in this.obj;</span><br><span class="line">&#125;;</span><br><span class="line">box.over=function(x,y,n)&#123;  //判断是否会重叠</span><br><span class="line">var name;</span><br><span class="line">if(x+this.size[n][0] &gt; this.row) return true; //超出显示范围</span><br><span class="line">for(var k=1; k&lt;this.size[n][1];k++)&#123;</span><br><span class="line">name=x+&#x27;_&#x27;+(y-0+k);</span><br><span class="line">if(this.hasN(name)) &#123;return true;&#125;  //左侧一列有无重叠</span><br><span class="line">&#125;</span><br><span class="line">for(k=1; k&lt;this.size[n][0];k++)&#123;</span><br><span class="line">name=(x-0+k)+&#x27;_&#x27;+y;</span><br><span class="line">if(this.hasN(name)) &#123;return true;&#125;  //上侧一行有无重叠</span><br><span class="line">&#125;</span><br><span class="line">return false;</span><br><span class="line">&#125;;</span><br><span class="line">box.apply=function(x,y,n)&#123;  //大格子中多占的位置</span><br><span class="line">var posX=x, //大格子左上角位置</span><br><span class="line">posY=y;</span><br><span class="line">for(var t=0; t&lt;this.size[n][0]; t++) &#123;</span><br><span class="line">for(var k=0; k&lt;this.size[n][1]; k++)&#123;</span><br><span class="line">name=(posX+t)+&#x27;_&#x27;+(posY+k);</span><br><span class="line">if(t==0 &amp;&amp; k==0) &#123; continue; &#125;</span><br><span class="line">this.obj[name]=0;   //多占的格子无坐标值</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">box.put=function(el)&#123;</span><br><span class="line">var x,y;</span><br><span class="line">for(var i =0;i&lt; this.oArray.length; i++)&#123;</span><br><span class="line">x=box.gen.w*this.oArray[i][0];</span><br><span class="line">y=box.gen.h*this.oArray[i][1];</span><br><span class="line">box.mbox[i].style.cssText = &quot;position:absolute;left:&quot;+ x +&quot;px;top:&quot; + y + &quot;px;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">el.style.height= box.gen.h*(box.maxY+1) +&#x27;px&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;myWidget&quot; class=&quot;myWidget&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var myWidget = $id(&quot;myWidget&quot;);</span><br><span class="line">//创建随机内容</span><br><span class="line">var content = &#x27;&#x27;;</span><br><span class="line">for(i = 0; i &lt; 30; i++) &#123;</span><br><span class="line">if(!(Math.random()*3 &gt;&gt; 0))&#123;</span><br><span class="line">height = Math.floor(Math.random()*300 + 100);</span><br><span class="line">width = Math.floor(Math.random()*200 + 100);</span><br><span class="line">content += &#x27;&lt;div class=&quot;MBox&quot;&gt;&lt;div class=&quot;widgetBox bigBox&quot;&gt;&lt;div style=&quot;width:&#x27; + width +&#x27;px;height:&#x27; + height +&#x27;px;margin:0 auto;&quot; class=&quot;innerBox&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">content += &#x27;&lt;div class=&quot;MBox&quot;&gt;&lt;div class=&quot;widgetBox&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">myWidget.innerHTML = content;</span><br><span class="line">window.onload = function()&#123;</span><br><span class="line">box.setIfr(myWidget);</span><br><span class="line">box.init(myWidget);</span><br><span class="line">&#125;;</span><br><span class="line">window.onresize = function()&#123;</span><br><span class="line">box.init(myWidget);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>现在这种布局已经不能叫瀑布流了，我们称之为格子块，格子块通过算法智能堆砌。</p><p>支持一下拖动交换：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;宽高尺寸不同的格子堆砌(可拖动换位)&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body&#123;background:#F6F7F8;&#125;</span><br><span class="line">.myWidget&#123;position:relative;overflow:hidden;zoom:1;margin:0 auto;&#125;</span><br><span class="line">.MBox&#123;float:left;&#125;</span><br><span class="line">.widgetBox&#123;position:relative;overflow:hidden;zoom:1;width:186px;height:166px;margin:6px;border:1px solid #E1E1E3;cursor:move;</span><br><span class="line">border-radius:10px;</span><br><span class="line">-moz-border-radius:10px;</span><br><span class="line">-webkit-border-radius:10px;</span><br><span class="line">box-shadow:2px 3px 5px #d3d3d3;</span><br><span class="line">-moz-box-shadow:2px 3px 5px #d3d3d3;</span><br><span class="line">-webkit-box-shadow:2px 3px 5px #d3d3d3;</span><br><span class="line">filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#fefefe, endColorstr=#e0e0e2);</span><br><span class="line">background: linear-gradient(top, #fefefe, #f6f6f6 ,#f3f3f3,#f2f2f2,#e0e0e2);</span><br><span class="line">background: -moz-linear-gradient(top, #fefefe, #f6f6f6 ,#f3f3f3,#f2f2f2,#e0e0e2);</span><br><span class="line">background: -webkit-gradient(linear, 0 0, 0 100% , from(#fefefe),to(#e0e0e2));</span><br><span class="line">background: -webkit-linear-gradient(0 0, #fefefe, #f6f6f6 ,#f3f3f3,#f2f2f2,#e0e0e2);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var $id = function(o)&#123; return document.getElementById(o) || o ;&#125;;</span><br><span class="line">var getElementsByClassName = function(className,parent,tag) &#123;</span><br><span class="line">parent = parent || document;</span><br><span class="line">    if(parent.getElementsByClassName)&#123;</span><br><span class="line">        return  parent.getElementsByClassName(className)</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        tag = tag || &#x27;*&#x27;;</span><br><span class="line">        var returnElements = []</span><br><span class="line">        var els =  parent.getElementsByTagName(tag);</span><br><span class="line">        className = className.replace(/\-/g, &quot;\\-&quot;);</span><br><span class="line">        var pattern = new RegExp(&quot;(^|\\s)&quot;+className+&quot;(\\s|$)&quot;);</span><br><span class="line">var i = 0;</span><br><span class="line">        while(i &lt; els.length)&#123;</span><br><span class="line">            if (pattern.test(els[i].className) ) &#123;</span><br><span class="line">                returnElements.push(els[i]);</span><br><span class="line">            &#125;</span><br><span class="line">i++;</span><br><span class="line">        &#125;</span><br><span class="line">        return returnElements;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var Util = new Object();</span><br><span class="line">Util.getOffset = function (el, isLeft) &#123;</span><br><span class="line">    var retValue = 0;</span><br><span class="line">   // while (el != null) &#123;</span><br><span class="line">        retValue += el[&quot;offset&quot; + (isLeft ? &quot;Left&quot; : &quot;Top&quot;)];</span><br><span class="line">     //   el = el.offsetParent;</span><br><span class="line">    //&#125;</span><br><span class="line">    return retValue;</span><br><span class="line">&#125;;</span><br><span class="line">Util.bindFunction = function (el, fucName) &#123;</span><br><span class="line">    return function () &#123;</span><br><span class="line">        return el[fucName].apply(el, arguments);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">Util.re_calcOff = function (el) &#123;</span><br><span class="line">    for (var i = 0; i &lt; Util.dragArray.length; i++) &#123;</span><br><span class="line">        var ele = Util.dragArray[i];</span><br><span class="line">        ele.elm.pagePosLeft = Util.getOffset(ele.elm, true);</span><br><span class="line">        ele.elm.pagePosTop = Util.getOffset(ele.elm, false);</span><br><span class="line">    &#125;</span><br><span class="line">    var nextSib = el.elm.nextSibling;</span><br><span class="line">    while (nextSib) &#123;</span><br><span class="line">        nextSib.pagePosTop -= el.elm.offsetHeight;</span><br><span class="line">        nextSib = nextSib.nextSibling;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Util.hide = function () &#123;</span><br><span class="line">    Util.rootElement.style.display = &quot;none&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">Util.show = function () &#123;</span><br><span class="line">    Util.rootElement.style.display = &quot;&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">ghostElement = null;</span><br><span class="line">found = null;</span><br><span class="line">getGhostElement = function () &#123;</span><br><span class="line">    if (!ghostElement) &#123;</span><br><span class="line">        ghostElement = document.createElement(&quot;DIV&quot;);</span><br><span class="line">        ghostElement.className = &quot;MBox ghostBox&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return ghostElement;</span><br><span class="line">&#125;;</span><br><span class="line">function draggable(el) &#123;</span><br><span class="line">    this._dragStart = start_Drag;</span><br><span class="line">    this._drag = when_Drag;</span><br><span class="line">    this._dragEnd = end_Drag;</span><br><span class="line">    this._afterDrag = after_Drag;</span><br><span class="line">    this.isDragging = false;</span><br><span class="line">    this.elm = el;</span><br><span class="line">this.hasIFrame = this.elm.getElementsByTagName(&quot;IFRAME&quot;).length &gt; 0;</span><br><span class="line">        Drag.init(el, this.elm);</span><br><span class="line">        this.elm.onDragStart = Util.bindFunction(this, &quot;_dragStart&quot;);</span><br><span class="line">        this.elm.onDrag = Util.bindFunction(this, &quot;_drag&quot;);</span><br><span class="line">        this.elm.onDragEnd = Util.bindFunction(this, &quot;_dragEnd&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">function start_Drag() &#123;</span><br><span class="line">Util.re_calcOff(this);</span><br><span class="line">    this.origNextSibling = this.elm.nextSibling;</span><br><span class="line">    var _ghostElement = getGhostElement();</span><br><span class="line">    var offH = this.elm.offsetHeight;</span><br><span class="line">    var offW = this.elm.offsetWidth;</span><br><span class="line">    var offLeft = Util.getOffset(this.elm, true);</span><br><span class="line">    var offTop = Util.getOffset(this.elm, false);</span><br><span class="line">   // Util.hide();</span><br><span class="line">   //this.elm.parentNode.getElementsByTagName(&#x27;iframe&#x27;)[0].style.visibility = &#x27;hidden&#x27;;</span><br><span class="line">    this.elm.style.width = offW + &quot;px&quot;;</span><br><span class="line">    _ghostElement.style.height = offH + &quot;px&quot;;</span><br><span class="line">    _ghostElement.style.width = offW + &quot;px&quot;;</span><br><span class="line">    this.elm.parentNode.insertBefore(_ghostElement, this.elm.nextSibling);</span><br><span class="line">    this.elm.style.position = &quot;absolute&quot;;</span><br><span class="line">    this.elm.style.zIndex = 100;</span><br><span class="line">    this.elm.style.left = offLeft + &quot;px&quot;;</span><br><span class="line">    this.elm.style.top = offTop + &quot;px&quot;;</span><br><span class="line">    //Util.show();</span><br><span class="line">    this.isDragging = false;</span><br><span class="line">    return false;</span><br><span class="line">&#125;;</span><br><span class="line">function when_Drag(clientX, clientY) &#123;</span><br><span class="line">    if (!this.isDragging) &#123;</span><br><span class="line">        this.elm.style.filter = &quot;alpha(opacity=70)&quot;;</span><br><span class="line">        this.elm.style.opacity = 0.7;</span><br><span class="line">        this.isDragging = true;</span><br><span class="line">    &#125;</span><br><span class="line">    found = null;</span><br><span class="line">    var max_distance = 100000000;</span><br><span class="line">    for (var i = 0; i &lt; Util.dragArray.length; i++) &#123;</span><br><span class="line">        var ele = Util.dragArray[i];</span><br><span class="line">        var distance = Math.sqrt(Math.pow(clientX - ele.elm.pagePosLeft, 2) + Math.pow(clientY -  ele.elm.offsetTop, 2));</span><br><span class="line">        if (ele == this) &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if (isNaN(distance)) &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if (distance &lt; max_distance) &#123;</span><br><span class="line">            max_distance = distance;</span><br><span class="line">            found = ele;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    var _ghostElement = getGhostElement();</span><br><span class="line">    if (found != null) &#123;</span><br><span class="line">    if(this.elm.pagePosLeft &lt; clientX)&#123;</span><br><span class="line">    found.elm.parentNode.insertBefore(_ghostElement, found.elm.nextSibling);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">    found.elm.parentNode.insertBefore(_ghostElement, found.elm);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">function end_Drag() &#123;</span><br><span class="line">//this.elm.parentNode.getElementsByTagName(&#x27;iframe&#x27;)[0].style.visibility = &#x27;visible&#x27;;</span><br><span class="line">if (this._afterDrag()) &#123;</span><br><span class="line">&#125;</span><br><span class="line">return true;</span><br><span class="line">&#125;;</span><br><span class="line">function after_Drag() &#123;</span><br><span class="line">    var returnValue = false;</span><br><span class="line">   // Util.hide();</span><br><span class="line">    this.elm.style.position = &quot;&quot;;</span><br><span class="line">    this.elm.style.width = &quot;&quot;;</span><br><span class="line">    this.elm.style.zIndex = &quot;&quot;;</span><br><span class="line">    this.elm.style.filter = &quot;&quot;;</span><br><span class="line">    this.elm.style.opacity = &quot;&quot;;</span><br><span class="line">    var ele = getGhostElement();</span><br><span class="line">    if (ele.nextSibling != this.origNextSibling) &#123;</span><br><span class="line">    ele.parentNode.insertBefore(found.elm, this.elm);</span><br><span class="line">    ele.parentNode.insertBefore(this.elm, ele.nextSibling);</span><br><span class="line">        returnValue = true;</span><br><span class="line">    &#125;</span><br><span class="line">    ele.parentNode.removeChild(ele);</span><br><span class="line">    //Util.show();</span><br><span class="line">   box.init(Util.rootElement);</span><br><span class="line">   return returnValue;</span><br><span class="line">&#125;;</span><br><span class="line">var Drag = &#123;</span><br><span class="line">obj:null,</span><br><span class="line">init:function (elementHeader, element) &#123;</span><br><span class="line">    elementHeader.onmousedown = Drag.start;</span><br><span class="line">        elementHeader.obj = element;</span><br><span class="line">    if (isNaN(parseInt(element.style.left))) &#123;</span><br><span class="line">element.style.left = &quot;0px&quot;;</span><br><span class="line">&#125;</span><br><span class="line">if (isNaN(parseInt(element.style.top))) &#123;</span><br><span class="line">element.style.top = &quot;0px&quot;;</span><br><span class="line">&#125;</span><br><span class="line">element.onDragStart = new Function();</span><br><span class="line">element.onDragEnd = new Function();</span><br><span class="line">element.onDrag = new Function();</span><br><span class="line">&#125;,</span><br><span class="line">start:function (event) &#123;</span><br><span class="line">    var element = Drag.obj = this.obj;</span><br><span class="line">    event = Drag.fixE(event);</span><br><span class="line">    if (event.which != 1) &#123;</span><br><span class="line">    return true;</span><br><span class="line">    &#125;</span><br><span class="line">    element.onDragStart();</span><br><span class="line">    element.lastMouseX = event.clientX;</span><br><span class="line">element.lastMouseY = event.clientY;</span><br><span class="line">    document.onmouseup = Drag.end;</span><br><span class="line">document.onmousemove = Drag.drag;</span><br><span class="line">return false;</span><br><span class="line">&#125;,</span><br><span class="line">drag:function (event) &#123;</span><br><span class="line">event = Drag.fixE(event);</span><br><span class="line">    if (event.which == 0) &#123;</span><br><span class="line">    return Drag.end();</span><br><span class="line">    &#125;</span><br><span class="line">    var element = Drag.obj;</span><br><span class="line">    var _clientX = event.clientY;</span><br><span class="line">var _clientY = event.clientX;</span><br><span class="line">    if (element.lastMouseX == _clientY &amp;&amp; element.lastMouseY == _clientX) &#123;</span><br><span class="line">return false;</span><br><span class="line">&#125;;</span><br><span class="line">if(_clientX + document.documentElement.scrollTop + document.body.scrollTop &lt; 0 ||  _clientX &gt; document.documentElement.offsetHeight)&#123;</span><br><span class="line">return false;</span><br><span class="line">&#125;;</span><br><span class="line">var sTo=0;</span><br><span class="line">if( _clientX &lt; 0 )&#123;</span><br><span class="line">sTo=_clientX;</span><br><span class="line">&#125;;</span><br><span class="line">if((_clientX - document.documentElement.clientHeight) &gt; 0)&#123;</span><br><span class="line">    sTo=_clientX - document.documentElement.clientHeight;</span><br><span class="line">&#125;;</span><br><span class="line">window.scrollBy(0,sTo);</span><br><span class="line">    var _lastX = parseInt(element.style.top);</span><br><span class="line">var _lastY = parseInt(element.style.left);</span><br><span class="line">    var newX, newY;</span><br><span class="line">    newX = _lastY + _clientY - element.lastMouseX;</span><br><span class="line">newY = _lastX + _clientX - element.lastMouseY;</span><br><span class="line">    element.style.left = newX  + &quot;px&quot;;</span><br><span class="line">element.style.top = newY + sTo + &quot;px&quot;;</span><br><span class="line">    element.lastMouseX = _clientY;</span><br><span class="line">element.lastMouseY = _clientX;</span><br><span class="line">    element.onDrag(newX, newY);</span><br><span class="line">return false;</span><br><span class="line">&#125;,</span><br><span class="line">end:function (event) &#123;</span><br><span class="line">event = Drag.fixE(event);</span><br><span class="line">    document.onmousemove = null;</span><br><span class="line">document.onmouseup = null;</span><br><span class="line">    var _onDragEndFuc = Drag.obj.onDragEnd();</span><br><span class="line">    Drag.obj = null;</span><br><span class="line">    return _onDragEndFuc;</span><br><span class="line">&#125;,</span><br><span class="line">fixE:function (ig_) &#123;</span><br><span class="line">    if (typeof ig_ == &quot;undefined&quot;) &#123;</span><br><span class="line">        ig_ = window.event;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof ig_.layerX == &quot;undefined&quot;) &#123;</span><br><span class="line">        ig_.layerX = ig_.offsetX;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof ig_.layerY == &quot;undefined&quot;) &#123;</span><br><span class="line">        ig_.layerY = ig_.offsetY;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof ig_.which == &quot;undefined&quot;) &#123;</span><br><span class="line">        ig_.which = ig_.button;</span><br><span class="line">    &#125;</span><br><span class="line">    return ig_;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var initDrag = function (el) &#123;</span><br><span class="line">Util.rootElement = el;</span><br><span class="line">    Util.elem = Util.rootElement.children;</span><br><span class="line">    Util.dragArray = new Array();</span><br><span class="line">    var counter = 0;</span><br><span class="line">    for (var i = 0; i &lt; Util.elem.length; i++) &#123;</span><br><span class="line">    var elem = Util.elem[i];</span><br><span class="line">Util.dragArray[counter] = new draggable(elem);</span><br><span class="line">counter++;</span><br><span class="line">    &#125;;</span><br><span class="line">box.setIfr(Util.rootElement);</span><br><span class="line">box.init(Util.rootElement);</span><br><span class="line">&#125;;</span><br><span class="line">/* 格子排序 */</span><br><span class="line">var box=&#123;&#125;;</span><br><span class="line">box.gen=&#123;w:200,h:180&#125;;</span><br><span class="line">box.init=function(el)&#123;</span><br><span class="line">box.size=[]; //格子,[1,2]表示1X2的大格子</span><br><span class="line">box.obj=&#123;&#125;;</span><br><span class="line">box.oArray=[];</span><br><span class="line">box.maxY=-1;</span><br><span class="line">box.mbox = getElementsByClassName(&quot;MBox&quot;,el,&#x27;div&#x27;);</span><br><span class="line">box.row = document.documentElement.offsetWidth / box.gen.w &gt;&gt; 0;  //每行标准格数</span><br><span class="line">el.style.width = box.row * box.gen.w + &quot;px&quot;;</span><br><span class="line">var i = 0 , nx, ny;</span><br><span class="line">while( i &lt; this.mbox.length)&#123;</span><br><span class="line">if( getElementsByClassName(&quot;bigBox&quot;,this.mbox[i],&#x27;div&#x27;).length &gt; 0 )&#123;</span><br><span class="line">nx=Math.ceil(this.mbox[i].offsetWidth / this.gen.w);</span><br><span class="line">nx=(nx &gt; this.row) ? this.row : nx; //大小超出限制</span><br><span class="line">ny=Math.ceil(this.mbox[i].offsetHeight / this.gen.h);</span><br><span class="line">this.size.push([nx,ny]);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">this.size.push(1);</span><br><span class="line">&#125;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">box.sort(el);</span><br><span class="line">&#125;;</span><br><span class="line">box.setIfr=function(el)&#123;  //大格子初始化</span><br><span class="line"> var ifr = getElementsByClassName(&quot;bigBox&quot;,el,&#x27;div&#x27;);;</span><br><span class="line">   if(ifr.length==0) return false;</span><br><span class="line">var i = 0, nx, ny, theifr;</span><br><span class="line">while(i &lt; ifr.length)&#123;</span><br><span class="line">theifr =  getElementsByClassName(&quot;innerBox&quot;,ifr[i],&#x27;div&#x27;);</span><br><span class="line">nx=Math.ceil(theifr[0].offsetWidth / this.gen.w); //bigBox横向占的块数</span><br><span class="line">ny=Math.ceil(theifr[0].offsetHeight / this.gen.h);</span><br><span class="line">ifr[i].style.width = nx*this.gen.w-14 + &#x27;px&#x27; ;</span><br><span class="line">ifr[i].style.height = ny*this.gen.h-14 + &#x27;px&#x27; ;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">box.sort=function(el)&#123;</span><br><span class="line">var y=0, x=0, temp=&#123;x:Infinity, y:Infinity&#125;, flag=Infinity, name;</span><br><span class="line">for(var n=0; n &lt; this.size.length ; n++)&#123;</span><br><span class="line">if(flag == 0)&#123;</span><br><span class="line">x=temp.x;</span><br><span class="line">y=temp.y;</span><br><span class="line">&#125;</span><br><span class="line">flag=flag-1;</span><br><span class="line">if(x &gt; box.row-1)&#123; //换行</span><br><span class="line">x=0;</span><br><span class="line">y++;</span><br><span class="line">&#125;</span><br><span class="line">name=x+&#x27;_&#x27;+y;  //对象属性名（反映占领的格子）</span><br><span class="line">if(this.hasN(name)) &#123;  //判断属性名是否存在</span><br><span class="line">n--;</span><br><span class="line">x++;</span><br><span class="line">if(flag&lt;Infinity) flag=flag+1;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(!this.size[n].length)&#123;  //普通格子</span><br><span class="line">this.obj[name]=[x,y];  //（反映坐标值）</span><br><span class="line">x++;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;  //大格子</span><br><span class="line">if(this.over(x,y,n)) &#123;</span><br><span class="line">if(temp.y &gt; y)&#123;</span><br><span class="line">temp.y = y;</span><br><span class="line">temp.x = x;</span><br><span class="line">&#125;</span><br><span class="line">if(temp.y &lt; Infinity)&#123;</span><br><span class="line">flag=1;</span><br><span class="line">&#125;</span><br><span class="line">n--;</span><br><span class="line">x++;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">this.obj[name]=[x,y];</span><br><span class="line">this.apply(x,y,n);</span><br><span class="line">x+=this.size[n][0];</span><br><span class="line">&#125;</span><br><span class="line">if(flag==-1) &#123;</span><br><span class="line">flag = Infinity;</span><br><span class="line">temp.y = Infinity;</span><br><span class="line">temp.x = Infinity;</span><br><span class="line">&#125;</span><br><span class="line">var h=this.size[n][1]-1 || 0;</span><br><span class="line">box.maxY=(box.maxY &gt; y+h)? box.maxY : y+h;</span><br><span class="line">&#125;</span><br><span class="line">for(var i in this.obj)&#123;</span><br><span class="line">if(this.obj[i]===0 || !this.obj.hasOwnProperty(i)) continue;</span><br><span class="line">this.oArray.push(this.obj[i]);</span><br><span class="line">&#125;</span><br><span class="line">box.put(el);</span><br><span class="line">&#125;;</span><br><span class="line">box.hasN=function(n)&#123;</span><br><span class="line">return n in this.obj;</span><br><span class="line">&#125;;</span><br><span class="line">box.over=function(x,y,n)&#123;  //判断是否会重叠</span><br><span class="line">var name;</span><br><span class="line">if(x+this.size[n][0] &gt; this.row) return true; //超出显示范围</span><br><span class="line">for(var k=1; k&lt;this.size[n][1];k++)&#123;</span><br><span class="line">name=x+&#x27;_&#x27;+(y-0+k);</span><br><span class="line">if(this.hasN(name)) &#123;return true;&#125;  //左侧一列有无重叠</span><br><span class="line">&#125;</span><br><span class="line">for(k=1; k&lt;this.size[n][0];k++)&#123;</span><br><span class="line">name=(x-0+k)+&#x27;_&#x27;+y;</span><br><span class="line">if(this.hasN(name)) &#123;return true;&#125;  //上侧一行有无重叠</span><br><span class="line">&#125;</span><br><span class="line">return false;</span><br><span class="line">&#125;;</span><br><span class="line">box.apply=function(x,y,n)&#123;  //大格子中多占的位置</span><br><span class="line">var posX=x, //大格子左上角位置</span><br><span class="line">posY=y;</span><br><span class="line">for(var t=0; t&lt;this.size[n][0]; t++) &#123;</span><br><span class="line">for(var k=0; k&lt;this.size[n][1]; k++)&#123;</span><br><span class="line">name=(posX+t)+&#x27;_&#x27;+(posY+k);</span><br><span class="line">if(t==0 &amp;&amp; k==0) &#123; continue; &#125;</span><br><span class="line">this.obj[name]=0;   //多占的格子无坐标值</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">box.put=function(el)&#123;</span><br><span class="line">var x,y;</span><br><span class="line">for(var i =0;i&lt; this.oArray.length; i++)&#123;</span><br><span class="line">x=box.gen.w*this.oArray[i][0];</span><br><span class="line">y=box.gen.h*this.oArray[i][1];</span><br><span class="line">box.mbox[i].style.cssText = &quot;position:absolute;left:&quot;+ x +&quot;px;top:&quot; + y + &quot;px;&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">el.style.height= box.gen.h*(box.maxY+1) +&#x27;px&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;myWidget&quot; class=&quot;myWidget&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var myWidget = $id(&quot;myWidget&quot;);</span><br><span class="line">//创建随机内容</span><br><span class="line">var content = &#x27;&#x27;;</span><br><span class="line">for(i = 0; i &lt; 20; i++) &#123;</span><br><span class="line">if(!(Math.random()*5 &gt;&gt; 0))&#123;</span><br><span class="line">height = Math.floor(Math.random()*200 + 100);</span><br><span class="line">width = Math.floor(Math.random()*200 + 100);</span><br><span class="line">content += &#x27;&lt;div class=&quot;MBox&quot;&gt;&lt;div class=&quot;widgetBox bigBox&quot;&gt;&lt;div style=&quot;width:&#x27; + width +&#x27;px;height:&#x27; + height +&#x27;px;margin:0 auto;&quot; class=&quot;innerBox&quot;&gt;&#x27;+ i +&#x27;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">content += &#x27;&lt;div class=&quot;MBox&quot;&gt;&lt;div class=&quot;widgetBox&quot;&gt;&#x27;+ i +&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">myWidget.innerHTML = content;</span><br><span class="line">//绑定拖动元素</span><br><span class="line">initDrag(myWidget);</span><br><span class="line">window.onresize = function()&#123;box.init(myWidget)&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;图片分享网站Pinterest（beta），在不久前获得了2700$的投资，估值已超2亿元（据说现该公司团队有8人）。该网站的一大特色就是每一张分享的图片被拟作“Pin”被钉在页面上面，每一Pin依尺寸智能排列，同时滚动页面时异步加载新Pin，极具效果。这种创新模式被在国内</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>写了一个JS特效：打字效果（有彩蛋）</title>
    <link href="https://www.cssass.com/2011/07/28/%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AAJS%E7%89%B9%E6%95%88%EF%BC%9A%E6%89%93%E5%AD%97%E6%95%88%E6%9E%9C%EF%BC%88%E6%9C%89%E5%BD%A9%E8%9B%8B%EF%BC%89/"/>
    <id>https://www.cssass.com/2011/07/28/%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AAJS%E7%89%B9%E6%95%88%EF%BC%9A%E6%89%93%E5%AD%97%E6%95%88%E6%9E%9C%EF%BC%88%E6%9C%89%E5%BD%A9%E8%9B%8B%EF%BC%89/</id>
    <published>2011-07-28T03:13:55.000Z</published>
    <updated>2023-06-29T03:14:53.544Z</updated>
    
    <content type="html"><![CDATA[ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;Typing...&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body</span><br><span class="line">&#123;font-family:&#x27;MS Gothic&#x27;;line-height: 1.8;font-size: 15px;color: #444;padding:10px;&#125;</span><br><span class="line">#avatar&#123;position:relative;width:800px;word-wrap:break-word;margin:0 auto;&#125;</span><br><span class="line">b&#123;font-weight:normal;display:none;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;avatar&quot;&gt;</span><br><span class="line">&lt;p&gt;我们都一样&lt;/p&gt;</span><br><span class="line">&lt;p&gt;推开窗看见星星,依然守在夜空中。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;心中不免多了些,暖暖的感动。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;一闪一闪的光,努力把黑夜点亮，气氛如此安详。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;你在我的生命中,是那最闪亮的星。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;一直在无声夜空,守护着我们的梦。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;这世界那么大,我的爱只想要你懂。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;陪伴我孤寂旅程。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;你知道我的梦,你知道我的痛。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;你知道我们感受都相同。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;就算有再大的风,也挡不住勇敢的冲动。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;努力的往前飞,再累也无所谓。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;黑夜过后的光芒有多美。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;分享你我的力量,就能把对方的路照亮。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;我想我们都一样,渴望梦想的光芒。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;这一路喜悦彷徨,不要轻易说失望。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;回到最初时光,当时的你多么坚强。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;那鼓励让我难忘。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;你知道我的梦,你知道我的痛。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;你知道我们感受都相同。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;就算有再大的风,也挡不住勇敢的冲动。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;努力的往前飞,再累也无所谓。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;黑夜过后的光芒有多美。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;分享你我的力量,就能把对方的路照亮。&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;span id=&quot;cursor&quot;&gt;|&lt;/span&gt;</span><br><span class="line">&lt;embed name=&quot;我们都一样&quot; pluginspage=&quot;http://www.microsoft.com/Windows/MediaPlayer&quot; src=&quot;http://www.cssass.com/blog/resource/bgsound/bgsound.mp3&quot;</span><br><span class="line">width=&quot;1&quot; height=&quot;1&quot; type=&quot;application/x-mplayer2&quot; autostart=&quot;1&quot;  loop=&quot;1&quot; volume=&quot;50&quot;&gt;&lt;/embed&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var $id=function(o)&#123;return document.getElementById(o) || o&#125;;</span><br><span class="line">var g=$id(&#x27;avatar&#x27;);</span><br><span class="line">var cursor=$id(&quot;cursor&quot;);</span><br><span class="line">var init=function ()</span><br><span class="line">&#123;</span><br><span class="line">var n=0, l=g.innerHTML, s=&#x27;&#x27;;</span><br><span class="line">while (n&lt;l.length)</span><br><span class="line">&#123;</span><br><span class="line">var r=l.charAt(n);</span><br><span class="line">if (r==&#x27; &#x27;) &#123; s+=r; n++&#125;</span><br><span class="line">if (r==&#x27;&lt;&#x27;) while (l.charAt(n-1)!=&#x27;&gt;&#x27;) s+=l.charAt(n++);</span><br><span class="line">s+=&#x27;&lt;b&gt;&#x27;+l.charAt(n++)+&#x27;&lt;/b&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">g.innerHTML=s;</span><br><span class="line">&#125;;</span><br><span class="line">var Wt=&#123;&#125;;</span><br><span class="line">Wt.n = 0,</span><br><span class="line">Wt.i = 0;</span><br><span class="line">Wt.p = g.getElementsByTagName(&quot;p&quot;);</span><br><span class="line">Wt.loop=function()&#123;</span><br><span class="line">if( Wt.n &gt;= Wt.p.length ) &#123;</span><br><span class="line">window.scrollTo(0,0);</span><br><span class="line">pos();</span><br><span class="line">anim();</span><br><span class="line">cursor.innerHTML=&#x27;&#x27;;</span><br><span class="line">g.onclick=anim;</span><br><span class="line">return false;</span><br><span class="line">&#125;;</span><br><span class="line">Wt.p[Wt.n].appendChild(cursor);</span><br><span class="line">var _loop=function()&#123;</span><br><span class="line">var m = Wt.p[Wt.n].getElementsByTagName(&quot;b&quot;);</span><br><span class="line">if(Wt.i &lt; m.length )&#123;</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">m[Wt.i].style.display=&#x27;inline&#x27;;</span><br><span class="line">Wt.i++;</span><br><span class="line">_loop();</span><br><span class="line">&#125;,300);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">Wt.i=0;</span><br><span class="line">Wt.n++;</span><br><span class="line">Wt.loop();</span><br><span class="line">&#125;,300);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">_loop();</span><br><span class="line">&#125;;</span><br><span class="line">var glint=setInterval(function()&#123;</span><br><span class="line">cursor.style.display = (cursor.style.display==&quot;none&quot;) ? &quot;inline&quot; : &quot;none&quot;;</span><br><span class="line">&#125;,500);</span><br><span class="line">var xo=[], yo=[], xd=[], yd=[], e=[], an=-1, dir=-1 , t=0;</span><br><span class="line">var d=&#x27;6=.6&gt;&amp;5&amp;84OF4(@4*?3*J3-53*&gt;3-B3*13G%44&amp;5),6.D6377E%8.B;.0;3J?$+&gt;E&lt;B))B;@EG*F%-I0&gt;I6AM&amp;&gt;M,=Q),PJ;T:DT@5X1$X60[NO[T,_8B_=8b16b)3eC)e!?i,Gh3!l&gt;&lt;kD,o*Go!!r0)r%&gt;u54t92w=+v@=y+HxGF6H86248D+8-G6H/8G-7-889C8677&lt;&gt;8748E?8D79C1;0C86+:6&amp;;/0;&gt;$=)?&lt;#$=*#&lt;H%=*;=!(=*G:5(=++=!?=+7&lt;&lt;HA9;&lt;HD?3*=GDAF3&gt;C5A9#&gt;E$A9/A03A:!B!@A:8@1?B+AA/1BE&amp;B-)BO2A/OA83A/GA8BE&gt;/E0DB.FF.#CE%F-3E&gt;8F,OE&gt;EF,CF#&lt;F,7E?)F-?E?3F,+F0AHB-H*(F+GE@6J:GG.&gt;J;-I65J&lt;!J2#J&lt;-J2%J01J2/J&lt;9J=GJ=*J39J;@J2GJ;4J2;I65O.&lt;K0@LCBL9$O.BL.!O/;M,/NJ7N@@O#4NA#O0+NA/P,HO&amp;HO07O&amp;&lt;P!ANA&gt;Q,$Q.=S&gt;)RC=S=ES4,S&gt;6RDCS&gt;ARD)S?%S(HT!OT22S?1U/&amp;T=1V!*X%#T@&amp;X%/V!*X%;X5(X%HWCCX&amp;+WC8X&amp;7X(JX30WC,ZE4W8,ZE@WE$ZF$ZH%[P1[R0[P=[R&lt;[]3[RJ[]@[S/]%.[S:_,8[SF_ED]@4_,OaBD_-3^27_::a6&lt;`7@`9/a*?c$(`:#`6D`FFcH;`!&gt;c&lt;3e,Bc&lt;JdH:e7@e-:fB.e!4h$$fC(h1(i/)h1%i#!h/Hh2-h/&gt;h2;i:,mJ9jDCm%0kB$l@Ol39l(2n-@p*7o+Ar%#p)7r%,q3!u63s!&gt;t85z6)v@*sGCr$;pO0n.Ak62h=GdGGd:Oc$4a);_.1]@)[,!Z.AW6&amp;W)DT$&lt;RO3P.BO&gt;#MB8L8AK!HHO)H5JF;3E=:CC&amp;C)D@$F?@&amp;&lt;GG;J)9C#9)A6=.6&gt;&amp;5&amp;84OF4(@4*?3*J3-53*&gt;3-B3*13G%44&amp;5),6.D6377E%8.B;.0;3J?$+&gt;E&lt;B))B;@EG*F%-I0&gt;I6AM&amp;&gt;M,=Q),PJ;T:DT@5X1$X60[NO[T,_8B_=8b16b)3eC)e!?i,Gh3!l&gt;&lt;kD,o*Go!!r0)r%&gt;u54t92w=+v@=y+HxGF6=.6&gt;&amp;5&amp;84OF4(@4*?3*J3-53*&gt;3-B3*13G%44&amp;5),6.D6377E%8.B;.0;3J?$+&gt;E&lt;B))B;@EG*F%-I0&gt;I6AM&amp;&gt;M,=Q),PJ;T:DT@5X1$X60[NO[T,_8B_=8b16b)3eC)e!?i,Gh3!l&gt;&lt;kD,o*Go!!r0)r%&gt;u54t92w=+v@=y+HxGF&#x27;;</span><br><span class="line">function pos()&#123;</span><br><span class="line">e=g.getElementsByTagName(&#x27;b&#x27;);</span><br><span class="line">for (n=0; n&lt;e.length; n++)</span><br><span class="line">&#123;</span><br><span class="line">xo[n]=e[n].offsetLeft;</span><br><span class="line">yo[n]=e[n].offsetTop;</span><br><span class="line">var p=d.charCodeAt(n*3)*1600+d.charCodeAt(n*3+1)*40+d.charCodeAt(n*3+2)-78768;</span><br><span class="line">yd[n]=p%500;</span><br><span class="line">xd[n]=(p-yd[n])/500;</span><br><span class="line">&#125;</span><br><span class="line">for (n=0; n&lt;e.length; n++)</span><br><span class="line">&#123;</span><br><span class="line">e[n].style.position=&#x27;absolute&#x27;;</span><br><span class="line">e[n].style.left=xo[n]+&#x27;px&#x27;;</span><br><span class="line">e[n].style.top=yo[n]+&#x27;px&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">function ani()</span><br><span class="line">&#123;t=e.length;</span><br><span class="line">for (var n=0; n&lt;t; n++)</span><br><span class="line">&#123;</span><br><span class="line">if ((an-n&lt;=30)&amp;&amp;(an-n&gt;=0))</span><br><span class="line">&#123;</span><br><span class="line">var b=(Math.cos((((an-n)*Math.PI)/30))+1)/2;</span><br><span class="line">var a=1-b;</span><br><span class="line">e[n].style.left=((yd[n]+111)*a+xo[n]*b)+&#x27;px&#x27;;</span><br><span class="line">e[n].style.top=((xd[n]+74)*a+yo[n]*b)+&#x27;px&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">an+=dir;</span><br><span class="line">if ((an-t&lt;=30)&amp;&amp;(an&gt;=0))</span><br><span class="line">&#123;</span><br><span class="line">window.setTimeout(&quot;ani()&quot;, 20);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">function anim()</span><br><span class="line">&#123;</span><br><span class="line">dir*=-1;</span><br><span class="line">if ((an&lt;0)||(an-t&gt;30)) ani();</span><br><span class="line">&#125;;</span><br><span class="line">init();</span><br><span class="line">Wt.loop();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html"> &lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span </summary>
      
    
    
    
    
    <category term="JS" scheme="https://www.cssass.com/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>Google电吉他扩展版——支持曲谱识别</title>
    <link href="https://www.cssass.com/2011/06/19/Google%E7%94%B5%E5%90%89%E4%BB%96%E6%89%A9%E5%B1%95%E7%89%88%E2%80%94%E2%80%94%E6%94%AF%E6%8C%81%E6%9B%B2%E8%B0%B1%E8%AF%86%E5%88%AB/"/>
    <id>https://www.cssass.com/2011/06/19/Google%E7%94%B5%E5%90%89%E4%BB%96%E6%89%A9%E5%B1%95%E7%89%88%E2%80%94%E2%80%94%E6%94%AF%E6%8C%81%E6%9B%B2%E8%B0%B1%E8%AF%86%E5%88%AB/</id>
    <published>2011-06-19T03:08:24.000Z</published>
    <updated>2023-06-29T03:09:58.359Z</updated>
    
    <content type="html"><![CDATA[<p>在6月9号Google 放出的纪念电吉他之父莱斯·保罗 96 周年诞辰的电吉他Doodle代码上，扩展了这个可播放曲谱的版本。<br>做这个扩展版的初衷是为了方便不是很熟悉键盘的童鞋。<br>童鞋们可以从网上复制曲谱进来自动播放（如果读者能自己谱曲，那真的就太棒了）。<br>曲谱中的空格及所有非法字符都表示停顿，间隔越大表示停顿越长，也可以调整曲子的整体节奏快慢。<br>同时可以开启自带的录音功能，录制之后会生产网址，可以拿来同朋友分享(由于国内网络环境的问题，网址生产可能会有限滞后)。<br>代码方面删除了不相干的部分，并做了格式整理，但由于原代码是经过压缩的，所以阅读起来还是会很费力的，很多地方处理的挺复杂，能力有限也不便做代码分析。<br>以下就是全部的代码（24k的code，1张图片，1个声音的flash文件）：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;meta charset=&#x27;utf-8&#x27; /&gt;</span><br><span class="line">&lt;title&gt;google电吉他扩展版——可播放曲谱&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">#lga&#123;width:500px;margin:0 auto;&#125;</span><br><span class="line">#hplogo:active,#hplogo:focus&#123;outline:none&#125;#hplogo-g&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat 0 0;height:175px;position:relative;width:474px&#125;#hplogo-click&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat -2000px -2000px;cursor:pointer;height:130px;left:0;position:absolute;top:0;width:474px&#125;#hplogo-lcd&#123;height:30px;left:70px;position:absolute;top:129px;width:200px&#125;#hplogo-lcd-icon&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat -580px -162px;cursor:pointer;height:0;position:absolute;width:0&#125;#hplogo-lcd-text&#123;background:transparent;border:0 none;color:#666;cursor:text;font-family:&quot;VT323&quot;,arial,sans-serif;font-size:14px;left:77px;position:absolute;top:134px;text-decoration:none;width:182px&#125;#hplogo-lcd-screen&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat -2000px -2000px;height:20px;left:52px;position:absolute;top:134px;width:214px&#125;#hplogo-on&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat -2000px -2000px;height:37px;left:272px;position:absolute;top:123px;width:62px&#125;#hplogo-led&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat -2000px -2000px;height:21px;left:292px;position:absolute;top:133px;width:21px&#125;.hplogo-str&#123;background:url(http://www.cssass.com/blog/resource/guitar/guitar11-hp-sprite.png) no-repeat -530px -60px;height:20px;position:absolute;width:255px&#125;#hplogot&#123;-webkit-box-shadow:5px 5px 10px #ddd;-moz-box-shadow:5px 5px 10px #ddd;box-shadow:5px 5px 10px #ddd;-webkit-transition:opacity 0.5s ease-out;-moz-transition:opacity 0.5s ease-out;-o-transition:opacity 0.5s ease-out;transition:opacity 0.5s ease-out;-webkit-user-select:none;-moz-user-select:none;user-select:none;background-color:#ffffca;border:1px solid #b5b5b5;cursor:pointer;display:none;font:normal 9pt arial,sans-serif;left:128px;opacity:0;padding:2px 3px;position:absolute;top:16px;white-space:nowrap&#125;</span><br><span class="line">.opern&#123;width:480px;height:40px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body onload=&quot;document.f.q.focus();&quot; &gt;</span><br><span class="line">&lt;div id=xjsc&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=lga&gt;</span><br><span class="line">&lt;div id=hplogo border=0&gt;</span><br><span class="line">&lt;div id=hplogo-g&gt;</span><br><span class="line">&lt;div id=hplogo-click &gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=hplogo-lcd-screen&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=hplogo-lcd-icon&gt;&lt;/div&gt;</span><br><span class="line">&lt;input id=hplogo-lcd-text value=&quot;&quot; autocomplete=off onclick=&quot;this.focus();this.select()&quot; readonly=readonly&gt;</span><br><span class="line">&lt;div id=hplogo-on&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=hplogo-led&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=hplogot&gt;Les Paul&amp;#39;s 96th Birthday&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;form name=f&gt;&lt;textarea class=&#x27;opern&#x27; name=q &gt;3688368 77653 2226235 37753 3688368 00989 00989987 53566&lt;/textarea&gt;&lt;/form&gt;</span><br><span class="line">&lt;button id=&#x27;play&#x27;&gt;Play&lt;/button&gt;</span><br><span class="line">节奏：</span><br><span class="line">&lt;select id=&#x27;speed&#x27;&gt;</span><br><span class="line">&lt;option value=&#x27;5&#x27;&gt;Fast&lt;/option&gt;</span><br><span class="line">&lt;option value=&#x27;7&#x27; selected&gt;Medium&lt;/option&gt;</span><br><span class="line">&lt;option value=&#x27;9&#x27;&gt;Slow&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">(function()&#123;</span><br><span class="line">var g=null,h;</span><br><span class="line">if(!window.google)window.google=&#123;&#125;;</span><br><span class="line">if(!google.doodle)google.doodle=&#123;&#125;;</span><br><span class="line">google.rt=7;</span><br><span class="line">var j,m,o,p,r,s,aa,t,u,ba,v,ca,da,ea=navigator.userAgent.indexOf(&quot;MSIE&quot;)&gt;=0,fa=[[3,&quot;#776a62&quot;,&quot;#2063ff&quot;,2,[[28,23],[103,23]]],[5,&quot;#776a62&quot;,&quot;#f61b33&quot;,2,[[28,38],[103,38]]],[0,&quot;#776a62&quot;,&quot;#ffdd24&quot;,2,[[65,67],[318,67]]],[2,&quot;#776a62&quot;,&quot;#07d238&quot;,2,[[28,81],[281,81]]],[7,&quot;#776a62&quot;,&quot;#2063ff&quot;,1,[[28,96.5],[281,96.5]]],[9,&quot;#776a62&quot;,&quot;#f61b33&quot;,1,[[29,111.5],[104,111.5]]],[1,&quot;#776a62&quot;,&quot;#07d238&quot;,2,[[358,66],[433,66]]],[4,&quot;#776a62&quot;,&quot;#2063ff&quot;,2,[[358,81],[433,81]]],[6,&quot;#776a62&quot;,&quot;#f61b33&quot;,2,[[330,96],[405,96]]],[8,&quot;#776a62&quot;,&quot;#ffdd24&quot;,1,[[358,111.5],[434,111.5]]]],ga=0,ha=0,w=0,x=0,y=!0,z=[],A=g,B=g,</span><br><span class="line">C=function(a)&#123;a&amp;&amp;a.parentNode&amp;&amp;a.parentNode.removeChild(a)&#125;,</span><br><span class="line">D=function(a,b,c)&#123;if(a)&#123;if(!google.doodle.ka)google.doodle.ka=[];google.doodle.ka.push(arguments);</span><br><span class="line">var d=a,e=b,f=c;</span><br><span class="line">d.addEventListener?d.addEventListener(e,f,!1):d.attachEvent(&quot;on&quot;+e,f)&#125;&#125;,</span><br><span class="line">ia=function(a,b,c)&#123;a&amp;&amp;(a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent(&quot;on&quot;+b,c))&#125;,</span><br><span class="line">ja=function()&#123;if(google.doodle.ka)for(var a;a=google.doodle.ka.pop();)ia.apply(g,a)&#125;,</span><br><span class="line">E=function(a)&#123;a?a.stopPropagation&amp;&amp;a.stopPropagation():window.event.cancelBubble=!0;return!1&#125;,</span><br><span class="line">F=function(a)&#123;if(j!==a)&#123;var b=j;j=a;for(a=0;a&lt;z.length;++a)z[a](b)&#125;&#125;,</span><br><span class="line">G=0;z.push(function()&#123;var a=document.getElementById(&quot;hplogo-on&quot;);if(a)j==1?(a.style.backgroundPosition=&quot;-476px -139px&quot;,G=0):j==2?G=1:(a.style.backgroundPosition=&quot;-2000px -2000px&quot;,G=0)&#125;);</span><br><span class="line">var ka=function(a)&#123;j==0||j==5||j==4?F(1):F(4);return E(a)&#125;,</span><br><span class="line">H=g,</span><br><span class="line">ma=function(a)&#123;</span><br><span class="line">C(document.getElementById(&quot;goo-gl-script&quot;));</span><br><span class="line">H&amp;&amp;window.clearTimeout(H);</span><br><span class="line">var b=&quot;http://google-lespaul.appspot.com?callback=google.doodle.url&amp;url=&quot;+encodeURIComponent(a),c=document.createElement(&quot;script&quot;);</span><br><span class="line">c.src=b;</span><br><span class="line">c.id=&quot;goo-gl-script&quot;;</span><br><span class="line">H=window.setTimeout(function()&#123;la(a)&#125;,2E3);</span><br><span class="line">(document.getElementById(&quot;xjsc&quot;)||document.body).appendChild(c)</span><br><span class="line">&#125;,</span><br><span class="line">na=function(a)&#123;a&amp;&amp;a.status==&quot;OK&quot;&amp;&amp;!a.error&amp;&amp;a.id&amp;&amp;la(a.id)&#125;,</span><br><span class="line">la=function(a)&#123;</span><br><span class="line">if(j==0||j==4)&#123;window.clearTimeout(H);var b=document.getElementById(&quot;hplogo-lcd-text&quot;);if(b)b.value=a,b.select()&#125;</span><br><span class="line">&#125;,</span><br><span class="line">I=[[0,0,0,0,0,0],[-540,-162,9,9,59,139],[-551,-162,9,6,62,139],[-559,-162,11,17,55,138]],</span><br><span class="line">J=function(a)&#123;</span><br><span class="line">var b=document.getElementById(&quot;hplogo-lcd-screen&quot;);</span><br><span class="line">if(b)b.style.backgroundPosition=&quot;-678px -139px&quot;;</span><br><span class="line">if(b=document.getElementById(&quot;hplogo-lcd-icon&quot;))</span><br><span class="line">b.style.backgroundPosition=I[a][0]+&quot;px &quot;+I[a][1]+&quot;px&quot;,b.style.height=I[a][2]+&quot;px&quot;,b.style.width=I[a][3]+&quot;px&quot;,b.style.left=I[a][4]+&quot;px&quot;,b.style.top=I[a][5]+&quot;px&quot;</span><br><span class="line">&#125;;</span><br><span class="line">z.push(function(a)&#123;</span><br><span class="line">var b=document.getElementById(&quot;hplogo-lcd-text&quot;);</span><br><span class="line">if(j==5)&#123;if(J(1),b.value==&quot;&quot;)b.value=&quot;Playing...&quot;&#125;</span><br><span class="line">else if(A&amp;&amp;(j==0||j==4))&#123;if(J(2),K(),b.value==&quot;Playing...&quot;)b.value=&quot;&quot;&#125;</span><br><span class="line">else if(j==1)J(3),b.value=&quot;Recording&quot;;</span><br><span class="line">if(j!=2&amp;&amp;(a==1||a==2)&amp;&amp;A)A.stop(),K(),J(A.u.length==0?0:2),b.value=&quot;&quot;,B=g,(a=A.eb())&amp;&amp;ma(a)</span><br><span class="line">&#125;);</span><br><span class="line">var oa=function(a)&#123;A&amp;&amp;(j==0||j==4)?(F(5),A.play()):j==5&amp;&amp;F(4);return E(a)&#125;;</span><br><span class="line">z.push(function()&#123;j==1&amp;&amp;(A=new L,B=A.ib())&#125;);</span><br><span class="line">var pa=!1,qa=&#123;el:1,iw:1,ja:1,kk:1,ky:1,ko:1,lt:1,lv:1,mk:1,mr:1,ru:1,th:1,ur:1,&quot;zh-CN&quot;:1,&quot;zh-TW&quot;:1&#125;,</span><br><span class="line">ra=function()&#123;</span><br><span class="line">//if(!pa&amp;&amp;!qa[google.kHL])&#123;</span><br><span class="line">//pa=!0;window.WebFontConfig=&#123;google:&#123;families:[&quot;VT323&quot;]&#125;&#125;;</span><br><span class="line">//var a=document.createElement(&quot;script&quot;);</span><br><span class="line">//a.src=(&quot;https:&quot;==document.location.protocol?&quot;https&quot;:&quot;http&quot;)+&quot;://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js&quot;;</span><br><span class="line">//a.type=&quot;text/javascript&quot;;a.async=&quot;true&quot;;(document.getElementById(&quot;xjsc&quot;)||document.body).appendChild(a)</span><br><span class="line">//&#125;</span><br><span class="line">&#125;,</span><br><span class="line">sa=!1,N=g,</span><br><span class="line">ua=function()&#123;O();N=window.setTimeout(function()&#123;ta(!0)&#125;,1E3)&#125;,</span><br><span class="line">O=function()&#123;N&amp;&amp;window.clearTimeout(N);N=g;ta(!1)&#125;,</span><br><span class="line">ta=function(a)&#123;var b=document.getElementById(&quot;hplogot&quot;);if(b)sa?(b.style.display=&quot;block&quot;,b.style.opacity=a?1:0):b.style.display=a?&quot;block&quot;:&quot;none&quot;&#125;,</span><br><span class="line">za=function()&#123;</span><br><span class="line">D(document,&quot;keydown&quot;,va);</span><br><span class="line">D(document,&quot;mousemove&quot;,P);</span><br><span class="line">D(document,&quot;touchmove&quot;,P);</span><br><span class="line">D(document,&quot;touchstart&quot;,wa);</span><br><span class="line">D(window,&quot;resize&quot;,xa);</span><br><span class="line">D(document.getElementById(&quot;play&quot;),&quot;click&quot;,playA);</span><br><span class="line">var a=document.forms.f||document.forms.gs||document.forms.lb;</span><br><span class="line">a&amp;&amp;(D(a.q,&quot;blur&quot;,function()&#123;m=!1&#125;),D(a.q,&quot;focus&quot;,function()&#123;m=!0;j!=5&amp;&amp;F(0)&#125;));</span><br><span class="line">D(document.body,&quot;mouseout&quot;,ya);</span><br><span class="line">if(a=document.getElementById(&quot;hplogo-on&quot;))a.onclick=ka,a.style.cursor=&quot;pointer&quot;;</span><br><span class="line">if(a=document.getElementById(&quot;hplogo-led&quot;))a.onclick=ka,a.style.cursor=&quot;pointer&quot;;</span><br><span class="line">if(a=document.getElementById(&quot;hplogo-lcd-icon&quot;))a.onclick=oa;</span><br><span class="line">if((a=document.getElementById(&quot;hplogo-click&quot;))&amp;&amp;!ea)a.onmousemove=ua,a.onmouseout=O;</span><br><span class="line">if(a=document.getElementById(&quot;speed&quot;))a.onchange=function()&#123;google.rt=this.value&#125;;</span><br><span class="line">&#125;,</span><br><span class="line">wa=function(a)&#123;var b=Aa(a);b[0]&gt;=w&amp;&amp;b[0]&lt;=w+474&amp;&amp;b[1]&gt;=x&amp;&amp;b[1]&lt;=x+175&amp;&amp;a.preventDefault()&#125;,</span><br><span class="line">Aa=function(a)&#123;</span><br><span class="line">a=a||window.event;</span><br><span class="line">return[(a.clientX||a.targetTouches&amp;&amp;a.targetTouches[0].clientX||0)+(document.body.scrollLeft||document.documentElement.scrollLeft),</span><br><span class="line">(a.clientY||a.targetTouches&amp;&amp;a.targetTouches[0].clientY||0)+(document.body.scrollTop||document.documentElement.scrollTop)]</span><br><span class="line">&#125;,</span><br><span class="line">P=function(a)&#123;a=a||window.event;a=Aa(a);ga=a[0];ha=a[1]&#125;,</span><br><span class="line">//Ba=&#123;49:2,50:6,51:3,52:0,53:7,54:1,55:8,56:4,57:9,48:5,81:2,87:6,69:3,82:0,84:7,89:1,85:8,73:4,79:9,80:5,65:2,83:6,68:3,70:0,71:7,72:1,74:8,75:4,76:9,186:5,90:2,88:6,67:3,86:0,66:7,78:1,77:8,188:4,190:9,191:5&#125;,</span><br><span class="line">Ba=&#123;49:2,50:6,51:3,52:0,53:7,54:1,55:8,56:4,57:9,48:5,</span><br><span class="line">81:2,87:6,69:3,82:0,84:7,89:1,85:8,73:4,79:9,80:5,</span><br><span class="line">65:2,83:6,68:3,70:0,71:7,72:1,74:8,75:4,76:9,186:5,</span><br><span class="line">90:2,88:6,67:3,86:0,66:7,78:1,77:8,188:4,190:9,191:5,</span><br><span class="line">&#x27;1&#x27;:2,&#x27;2&#x27;:6,&#x27;3&#x27;:3,&#x27;4&#x27;:0,&#x27;5&#x27;:7,&#x27;6&#x27;:1,&#x27;7&#x27;:8,&#x27;8&#x27;:4,&#x27;9&#x27;:9,&#x27;0&#x27;:5,</span><br><span class="line">&#x27;q&#x27;:2,&#x27;w&#x27;:6,&#x27;e&#x27;:3,&#x27;r&#x27;:0,&#x27;t&#x27;:7,&#x27;y&#x27;:1,&#x27;u&#x27;:8,&#x27;i&#x27;:4,&#x27;o&#x27;:9,&#x27;p&#x27;:5,</span><br><span class="line">&#x27;a&#x27;:2,&#x27;s&#x27;:6,&#x27;d&#x27;:3,&#x27;f&#x27;:0,&#x27;g&#x27;:7,&#x27;h&#x27;:1,&#x27;j&#x27;:8,&#x27;k&#x27;:4,&#x27;l&#x27;:9,&#x27;;&#x27;:5,</span><br><span class="line">&#x27;z&#x27;:2,&#x27;x&#x27;:6,&#x27;c&#x27;:3,&#x27;v&#x27;:0,&#x27;b&#x27;:7,&#x27;n&#x27;:1,&#x27;m&#x27;:8,&#x27;,&#x27;:4,&#x27;.&#x27;:9,&#x27;/&#x27;:5,</span><br><span class="line">&#x27;#&#x27;:&#x27;#&#x27;&#125;,</span><br><span class="line">va=function(a)&#123;var b=a||window.event;return o&amp;&amp;!m&amp;&amp;!b.altKey&amp;&amp;!b.ctrlKey&amp;&amp;!b.metaKey&amp;&amp;(b=Ba[b.keyCode],typeof b==&quot;number&quot;)?(j==0&amp;&amp;F(4),o.V(b),E(a)):!0&#125;,</span><br><span class="line">playA=function()&#123;</span><br><span class="line">var b=document.f.q.value.toLowerCase();</span><br><span class="line">var c=b.replace(/[^0-9a-zA-Z,.;/]/g,&#x27;#&#x27;);</span><br><span class="line">var d=new L;</span><br><span class="line">for(var i=0,c=c.split(&quot;&quot;); i&lt;c.length; i++)&#123;</span><br><span class="line">b=Ba[c[i]].toString();</span><br><span class="line">d.Za(new Y(b,google.rt));</span><br><span class="line">&#125;</span><br><span class="line">d.stop();</span><br><span class="line">google.d=5,d.play();</span><br><span class="line">&#125;,</span><br><span class="line">xa=function()&#123;</span><br><span class="line">y&amp;&amp;p!=g&amp;&amp;(y=!1,window.setTimeout(function()&#123;y=!0;var a=p,b=0;do b+=a.offsetLeft;while(a=a.offsetParent);w=b;a=p;b=0;do b+=a.offsetTop;while(a=a.offsetParent);x=b&#125;,30))</span><br><span class="line">&#125;,</span><br><span class="line">ya=function(a)&#123;</span><br><span class="line">(a=a||window.event)&amp;&amp;!a.toElement&amp;&amp;P(a)</span><br><span class="line">&#125;,</span><br><span class="line">Ca=function(a,b)&#123;</span><br><span class="line">this.i=a;this.Y=b;this.width=474;this.height=175;this.J=[];this.Ja=this.U=!1;this.ha=0;this.ta=this.T();this.ua=this.ia();this.qa=new Q(0,0);this.ra=new Q(0,0);this.Ia=!0;this.La=(new Date).getTime();this.Xa();this.Ka()</span><br><span class="line">&#125;;</span><br><span class="line">h=Ca.prototype;</span><br><span class="line">h.Xa=function()&#123;for(var a=0,b;b=fa[a++];)this.J.push(new Da(b[4][0][0],b[4][0][1],b[4][1][0],b[4][1][1],b[3],b[1],b[2],a,b[0],this.i,this.Y,this))&#125;;</span><br><span class="line">h.T=function()&#123;return ga-w&#125;;</span><br><span class="line">h.ia=function()&#123;return ha-x&#125;;</span><br><span class="line">h.Ha=function(a)&#123;return R(a,this.width)/this.width&#125;;</span><br><span class="line">h.kb=function()&#123;this.bb();this.Ja&amp;&amp;this.ab();this.U&amp;&amp;(this.i&amp;&amp;this.i.clearRect(0,0,this.width,this.height),this.Ka())&#125;;</span><br><span class="line">h.Ka=function()&#123;for(var a=0,b;b=this.J[a++];)b.hb(),b.gb()&#125;;</span><br><span class="line">h.ya=function()&#123;if(this.J)for(var a=0,b;b=this.J[a++];)b.ya()&#125;;</span><br><span class="line">h.Va=function()&#123;for(var a=0,b;b=this.J[a++];)if(b.L||b.O)&#123;this.U=!0;return&#125;this.U=!1&#125;;</span><br><span class="line">h.bb=function()&#123;</span><br><span class="line">var a=(new Date).getTime(),b=(a-this.La)/1E3;</span><br><span class="line">this.La=a;</span><br><span class="line">var a=this.T(),c=this.ia();</span><br><span class="line">this.qa.x=this.ta;this.qa.y=this.ua;this.ra.x=a;this.ra.y=c;var d=a-this.ta,e=c-this.ua,d=Math.sqrt(d*d+e*e);this.Ja=d&gt;0;this.ha=(this.ha*4+R(((b&gt;0?d/b:0)-70)/1430,1))/5;this.ta=a;this.ua=c</span><br><span class="line">&#125;;</span><br><span class="line">h.ab=function()&#123;</span><br><span class="line">if(this.Ia)this.Ia=!1;</span><br><span class="line">else for(var a=0,b;b=this.J[a++];)</span><br><span class="line">&#123;</span><br><span class="line">var c;c=this.qa;</span><br><span class="line">var d=this.ra,e=b.Ra,f=b.Qa,i=d.y-c.y,n=f.y-e.y,k=c.x-d.x,l=e.x-f.x,q=d.x*c.y-c.x*d.y,M=f.x*e.y-e.x*f.y,X=i*l-n*k;</span><br><span class="line">X==0?c=g:(k=(k*M-l*q)/X,i=(n*q-i*M)/X,c=Math.pow(k-d.x,2)+Math.pow(i-d.y,2)&gt;Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2)||Math.pow(k-c.x,2)+Math.pow(i-c.y,2)&gt;Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2)||Math.pow(k-f.x,2)+Math.pow(i-f.y,2)&gt;Math.pow(e.x-f.x,2)+Math.pow(e.y-f.y,2)||Math.pow(k-e.x,2)+Math.pow(i-e.y,2)&gt;Math.pow(e.x-f.x,2)+Math.pow(e.y-f.y,2)?g:new Q(k,i));</span><br><span class="line">c&amp;&amp;!b.L&amp;&amp;(this.ha&lt;0.4?b.Ya(c.x,c.y):b.Ma(c.x,c.y,!1))</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">h.V=function(a)&#123;a&gt;=0&amp;&amp;a&lt;12&amp;&amp;this.J[a].V()&#125;;</span><br><span class="line">var R=function(a,b)&#123;return a&lt;0?0:a&gt;b?b:a&#125;,</span><br><span class="line">Ea=function(a)&#123;for(var b=[],a=a.match(/[0-9a-f]&#123;2&#125;/gi),c=0,d;d=a[c++];)b.push(parseInt(d,16));return b&#125;,</span><br><span class="line">Q=function(a,b)&#123;this.x=a;this.y=b&#125;,</span><br><span class="line">Da=function(a,b,c,d,e,f,i,n,k,l,q,M)&#123;</span><br><span class="line">this.z=a;this.A=b;this.ea=c;this.fa=d;this.Ra=new Q(this.z,this.A);this.Qa=new Q(this.ea,this.fa);this.R=this.ea-this.z;this.S=this.fa-this.A;</span><br><span class="line">this.length=Math.sqrt(this.R*this.R+this.S*this.S);</span><br><span class="line">this.P=this.z+this.R*0.5;this.Q=this.A+this.S*0.5;this.W=this.P;this.X=this.Q;this.Aa=this.za=this.I=this.H=0;this.ga=k;this.Da=this.ga/11;this.Ca=this.M=this.F=this.la=0;this.ca=Math.atan2(this.S,this.R);this.ba=Math.sin(this.ca);this.ma=Math.cos(this.ca);a=Math.PI/2-this.ca;this.Pa=Math.sin(a);this.Oa=Math.cos(a);this.index=n;this.lineWidth=e;this.na=f;this.Ba=i;this.aa=this.na;this.color=this.w;this.w=Ea(this.na);this.da=Ea(this.Ba);this.B=this.k=0;this.Z=this.O=this.L=!1;this.oa=1;this.i=l;this.Y=q;this.v=M;this.o=(e=this.length&gt;100)?7.5:5;this.Sa=0.88+(0.85-0.88)*this.Da;this.Ta=1.4+1.5*this.Da;this.$=0;</span><br><span class="line">if(!this.i)this.G=document.createElement(&quot;div&quot;),this.G.className=&quot;hplogo-str&quot;,this.G.style.left=this.z+1+&quot;px&quot;,this.G.style.top=this.A-10+&quot;px&quot;,this.G.style.width=this.length,this.Ua=e?-475:-730,this.Y.appendChild(this.G)</span><br><span class="line">&#125;;</span><br><span class="line">h=Da.prototype;h.ya=function()&#123;if(this.G)this.Y.removeChild(this.G),this.G=g&#125;;</span><br><span class="line">h.gb=function()&#123;</span><br><span class="line">var a,b;(this.L||this.Z)&amp;&amp;this.H&amp;&amp;this.I?(a=this.H,b=this.I):(a=this.W,b=this.X);</span><br><span class="line">var c=a-this.z,d=b-this.A,e=this.ea-a,f=this.fa-b;</span><br><span class="line">this.i?(this.i.beginPath(),this.i.lineCap=&quot;round&quot;,this.i.strokeStyle=this.aa,this.i.lineWidth=this.lineWidth,this.i.shadowOffsetX=2,this.i.shadowOffsetY=3,this.i.shadowBlur=2,this.i.shadowColor=&quot;rgba(0, 0, 0, 0.35)&quot;,c=Math.sqrt(c*c+d*d),f=Math.sqrt(e*e+f*f),e=0.45*c*this.ma,c=0.45*c*this.ba,d=0.45*f*this.ma,f=0.45*f*this.ba,this.i.moveTo(this.z,this.A),this.i.bezierCurveTo(a-e,b-c,a+d,b+f,this.ea,this.fa),this.i.stroke(),this.i.closePath()):this.G.style.backgroundPosition=this.Ua+&quot;px &quot;+-(3+Math.round(d/2))*20+&quot;px&quot;</span><br><span class="line">&#125;;</span><br><span class="line">h.hb=function()&#123;this.L?this.Na():this.O&amp;&amp;this.db()&#125;;</span><br><span class="line">h.db=function()&#123;</span><br><span class="line">if(this.Z)&#123;</span><br><span class="line">this.aa=this.Ba;</span><br><span class="line">var a=this.za-this.H,b=this.Aa-this.I;</span><br><span class="line">this.H+=a*0.8;this.I+=b*0.8;</span><br><span class="line">if(Math.abs(a)&lt;2&amp;&amp;Math.abs(b)&lt;2)this.$=0,this.oa=1,this.Z=!1,(a&gt;=0?1:-1)!=(this.ba&gt;=0?1:-1)&amp;&amp;(this.oa*=-1)</span><br><span class="line">&#125;else if(this.color=[this.w[0]+(this.da[0]-this.w[0])*(this.k&gt;this.o*0.25?1:this.k/(this.o*0.25)),this.w[1]+(this.da[1]-this.w[1])*(this.k&gt;this.o*0.25?1:this.k/(this.o*0.25)),this.w[2]+(this.da[2]-this.w[2])*(this.k&gt;this.o*0.25?1:this.k/(this.o*0.25)),this.w[3]+(this.da[3]-this.w[3])*(this.k&gt;this.o*0.25?1:this.k/(this.o*0.25))],this.aa=&quot;rgb(&quot;+Math.round(this.color[0])+&quot;,&quot;+Math.round(this.color[1])+&quot;,&quot;+Math.round(this.color[2])+&quot;)&quot;,this.$+=this.Ta*this.oa,a=Math.sin(this.$),this.k*=this.Sa,this.W=this.P+a*this.ba*this.k,this.X=this.Q-a*this.ma*this.k,this.k&lt;=0.15)</span><br><span class="line">this.k=0,this.O=!1,this.color=this.w,this.aa=this.na,this.v.Va()</span><br><span class="line">&#125;;</span><br><span class="line">h.Na=function()&#123;</span><br><span class="line">var a=this.v.T(),b=this.v.ia(),c=a-this.z,d=b-this.A,e=this.ca-Math.atan2(d,c),c=Math.sqrt(c*c+d*d);</span><br><span class="line">this.F=c*Math.sin(e);this.Ea(R(c*Math.cos(e)/this.length,1));this.B=R(Math.abs(this.F)/this.o,1);Math.abs(this.F)&gt;this.la?this.Wa():(this.H=a,this.I=b)</span><br><span class="line">&#125;;</span><br><span class="line">h.Ea=function(a)&#123;this.M=a;this.Ca=this.M&lt;=0.5?this.M/0.5:1-(this.M-0.5)/0.5;this.la=this.o*this.Ca&#125;;</span><br><span class="line">h.Ma=function(a,b,c)&#123;</span><br><span class="line">this.H=a;this.I=b;</span><br><span class="line">var b=this.v.T()-this.z,d=this.v.ia()-this.A;this.Ea(R(Math.sqrt(b*b+d*d)/this.length,1));</span><br><span class="line">this.F=(1-(c?1:this.v.ha))*this.la;this.B=c?1:R(Math.abs(this.F)/this.o,1);if(this.F&lt;3)this.F=3;</span><br><span class="line">this.H+=this.F*this.Oa;</span><br><span class="line">this.I+=this.F*this.Pa;</span><br><span class="line">this.W=this.P;this.X=this.Q;</span><br><span class="line">this.O?(this.B=R(this.B/2+this.k/this.o,1),this.k=this.B*this.o):(this.k=this.B*this.o,this.Ga());</span><br><span class="line">this.Fa(this.B,this.v.Ha(a))</span><br><span class="line">&#125;;</span><br><span class="line">h.V=function()&#123;this.Ma(this.P,this.Q,!0)&#125;;</span><br><span class="line">h.Ya=function(a,b)&#123;this.L=!0;this.v.U=!0;this.H=a;this.I=b;this.Na()&#125;;</span><br><span class="line">h.Wa=function()&#123;this.L=!1;this.W=this.P;this.X=this.Q;this.k=this.B*this.o;this.Fa(this.B,this.v.Ha(this.v.T()));this.Ga()&#125;;</span><br><span class="line">h.Ga=function()&#123;this.v.U=!0;this.za=this.z+this.M*this.R;this.Aa=this.A+this.M*this.S;this.$=0;this.Z=this.O=!0&#125;;</span><br><span class="line">h.Fa=function(a,b)&#123;</span><br><span class="line">if(r)try&#123;s.playTrack(&quot;guitar-&quot;+(this.ga&lt;10?&quot;0&quot;:&quot;&quot;)+this.ga,this.ga,0.4+(0.6-0.4)*a,-0.8+1.6*b)&#125;catch(c)&#123;r=!1&#125;B&amp;&amp;B([this.index-1])</span><br><span class="line">&#125;;</span><br><span class="line">var Fa=function()&#123;if(r)for(var a=0;a&lt;12;a++)if(r)try&#123;s.stopChannel(a)&#125;catch(b)&#123;r=!1&#125;&#125;,</span><br><span class="line">Ha=function()&#123;u&amp;&amp;(Ga(&quot;guitar11-sound-player&quot;)||Ga(&quot;guitar11-sound-player-2&quot;))&#125;,</span><br><span class="line">Ga=function(a)&#123;return(a=u.getElementById(a))&amp;&amp;a.playTrack?(s=a,r=!0,Ia(),!0):!1&#125;,</span><br><span class="line">S=function(a,b)&#123;if(a&lt;b)return-1;else if(a&gt;b)return 1;return 0&#125;,</span><br><span class="line">T=function(a)&#123;a=a.match(/[\d]+/g);a.length=3;return a.join(&quot;.&quot;)&#125;,</span><br><span class="line">Ja=function()&#123;</span><br><span class="line">var a=!1,b=&quot;&quot;;</span><br><span class="line">if(navigator.plugins&amp;&amp;navigator.plugins.length)&#123;var c=navigator.plugins[&quot;Shockwave Flash&quot;];c&amp;&amp;(a=!0,c.description&amp;&amp;(b=T(c.description)));navigator.plugins[&quot;Shockwave Flash 2.0&quot;]&amp;&amp;(a=!0,b=&quot;2.0.0.11&quot;)&#125; else if(navigator.mimeTypes&amp;&amp;navigator.mimeTypes.length)(a=(c=navigator.mimeTypes[&quot;application/x-shockwave-flash&quot;])&amp;&amp;c.enabledPlugin)&amp;&amp;(b=T(c.enabledPlugin.description));else try&#123;c=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash.7&quot;),a=!0,b=T(c.GetVariable(&quot;$version&quot;))&#125;catch(d)&#123;try&#123;c=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash.6&quot;),a=!0,b=&quot;6.0.21&quot;&#125;catch(e)&#123;try&#123;c=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash&quot;),a=!0,b=T(c.GetVariable(&quot;$version&quot;))&#125;catch(f)&#123;&#125;&#125;&#125;aa=a;ba=b</span><br><span class="line">&#125;,</span><br><span class="line">Ka=function()&#123;</span><br><span class="line">for(var a=0,b=String(ba).replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;).split(&quot;.&quot;),c=String(&quot;9.0.0.0&quot;).replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;).split(&quot;.&quot;),d=Math.max(b.length,c.length),e=0;a==0&amp;&amp;e&lt;d;e++)</span><br><span class="line">&#123;</span><br><span class="line">var f=b[e]||&quot;&quot;,i=c[e]||&quot;&quot;,n=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),k=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);</span><br><span class="line">do&#123;</span><br><span class="line">var l=n.exec(f)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],q=k.exec(i)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];</span><br><span class="line">if(l[0].length==0&amp;&amp;q[0].length==0)break;</span><br><span class="line">a=S(l[1].length==0?0:parseInt(l[1],10),q[1].length==0?0:parseInt(q[1],10))||S(l[2].length==0,q[2].length==0)||S(l[2],q[2])</span><br><span class="line">&#125;</span><br><span class="line">while(a==0)&#125;return a&gt;=0&#125;,</span><br><span class="line">U,La=&#123;c:2,d:6,e:3,f:0,g:7,a:1,b:8,C:4,D:9,E:5,1:2,2:6,3:3,4:0,5:7,6:1,7:8,8:4,9:9,0:5&#125;,</span><br><span class="line">Ma=function(a,b)&#123;</span><br><span class="line">if(!(typeof a!=&quot;number&quot;||typeof b!=&quot;string&quot;))&#123;</span><br><span class="line">U!==void 0&amp;&amp;window.clearInterval(U);var c=Math.floor(6E4/a);if(!(c&lt;30)&amp;&amp;!(6E4*(b.replace(&quot;[&quot;,&quot;&quot;).replace(&quot;]&quot;,&quot;&quot;).length/a)&gt;28E3))&#123;</span><br><span class="line">var d=0;F(5);</span><br><span class="line">U=window.setInterval(function()&#123;d&gt;=b.length&amp;&amp;j==5&amp;&amp;F(4);if(j!=5)window.clearInterval(U);else&#123;var a=b.charAt(d++);</span><br><span class="line">if(a!=&quot;-&quot;)&#123;</span><br><span class="line">var c=[];if(a==&quot;[&quot;)&#123;for(;d&lt;b.length&amp;&amp;b.charAt(d)!=&quot;]&quot;;)c.push(b.charAt(d++));d++&#125;else c.push(a);for(var a=0,i;i=c[a++];)La.hasOwnProperty(i)&amp;&amp;o.V(La[i])&#125;</span><br><span class="line">&#125;&#125;,c)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">V=g,W=g,</span><br><span class="line">Na=function()&#123;</span><br><span class="line">if(!V)&#123;V=&#123;&#125;;W=&#123;&#125;;</span><br><span class="line">for(var a=0;a&lt;65;a++)V[a]=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_*&quot;.charAt(a),W[V[a]]=a;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">Y=function(a,b)&#123;this.N=a;this.duration=Math.max(b,0);var c=0;c+=this.N.length==1?5:11;c+=this.duration&lt;Math.pow(2,5)?6:21;this.size=c&#125;;</span><br><span class="line">//Y.prototype.play=function()&#123;for(var a=0;a&lt;this.N.length;++a)o.V(this.N[a])&#125;;</span><br><span class="line">Y.prototype.play=function()&#123;o.V(this.N)&#125;;</span><br><span class="line">var Z=function(a,b)&#123;for(var c=[],d=0;d&lt;b;++d)c.push(!!(a&amp;1)),a&gt;&gt;=1;return c&#125;,</span><br><span class="line">Oa=function(a,b,c)&#123;if(b+c&gt;a.length)return-1;for(var d=0,e=0;e&lt;c;++e)d*=2,d|=a[b+c-e-1]?1:0;return d&#125;,</span><br><span class="line">Pa=function(a)&#123;for(var b=[],c=0;c&lt;10;++c)b.push(!1);for(c=0;c&lt;a.length;++c)b[a[c]]=!0;return b&#125;;</span><br><span class="line">Y.prototype.xa=function()&#123;</span><br><span class="line">var a=[];</span><br><span class="line">this.N.length==1?(a.push(!1),a=a.concat(Z(this.N[0],4))):(a.push(!0),a=a.concat(Pa(this.N)));</span><br><span class="line">this.duration&lt;Math.pow(2,5)?(a.push(!1),a=a.concat(Z(this.duration,5))):(a.push(!0),a=a.concat(Z(this.duration,20)));</span><br><span class="line">return a</span><br><span class="line">&#125;;</span><br><span class="line">var Qa=function(a,b)&#123;</span><br><span class="line">var c,d,e=b;if(b&lt;0||b&gt;=a.length)return g;</span><br><span class="line">if(a[b])&#123;c=b+1;if(c+10&gt;a.length)d=g;else&#123;d=[];for(var f=0;f&lt;10;++f)a[c+f]&amp;&amp;d.push(f)&#125;if(!d)return g;b+=11&#125;</span><br><span class="line">else&#123;c=Oa(a,b+1,4);if(c==-1)return g;d=[c];b+=5&#125;</span><br><span class="line">if(b&gt;=a.length)return g;a[b]?(c=Oa(a,b+1,20),b+=21):(c=Oa(a,b+1,5),b+=6);</span><br><span class="line">return c&lt;0?g:&#123;s:new Y(d,c),n:b-e&#125;</span><br><span class="line">&#125;,</span><br><span class="line">L=function(a)&#123;this.u=a||[];this.va=g;for(var b=this.duration=a=0;b&lt;this.u.length;++b)a+=this.u[b].size,b!=0&amp;&amp;(this.duration+=this.u[b].duration*50);this.size=a&#125;;</span><br><span class="line">L.prototype.Za=function(a)&#123;this.u.push(a);this.size+=a.size;this.u.size&gt;1&amp;&amp;(this.duration+=a.duration*50)&#125;;</span><br><span class="line">L.prototype.$a=function()&#123;return(this.size+4)*1.37/8&#125;;</span><br><span class="line">var Ra=g,</span><br><span class="line">Sa=function()&#123;j==1&amp;&amp;F(2)&#125;,Ta=g,</span><br><span class="line">Ua=function()&#123;(j==1||j==2)&amp;&amp;F(4)&#125;;</span><br><span class="line">L.prototype.ib=function()&#123;this.wa=0;this.K=[];this.cb=!0;var a=this;this.va=window.setTimeout(function()&#123;a.tick(!0)&#125;,50);return function(b)&#123;a.K.push(b)&#125;&#125;;</span><br><span class="line">L.prototype.tick=function(a)&#123;</span><br><span class="line">this.wa++;</span><br><span class="line">if(this.K&amp;&amp;this.K.length&gt;0)&#123;</span><br><span class="line">var b=this.wa;this.wa=0;var c;</span><br><span class="line">if(this.K.length==1)c=this.K[0];else&#123;for(var d=[],e=0;c=this.K[e++];)</span><br><span class="line">for(var f=0;f&lt;c.length;++f)d[c[f]]=1;c=[];</span><br><span class="line">for(e=0;e&lt;d.length;++e)d[e]&amp;&amp;c.push(e)&#125;this.K=[];</span><br><span class="line">this.Za(new Y(c,b));</span><br><span class="line">this.u.length==1&amp;&amp;(window.clearTimeout(Ta),Ta=window.setTimeout(Ua,28E3),window.clearTimeout(Ra),Ra=window.setTimeout(Sa,23E3));</span><br><span class="line">b=this.$a();</span><br><span class="line">if(b&gt;=1900||this.duration&gt;=28E3)&#123;F(4);return&#125;else b&gt;=1800&amp;&amp;F(2)</span><br><span class="line">&#125;</span><br><span class="line">if(a)&#123;var i=this;this.va=window.setTimeout(function()&#123;i.tick(!0)&#125;,50)&#125;</span><br><span class="line">&#125;;</span><br><span class="line">L.prototype.stop=function()&#123;</span><br><span class="line">window.clearTimeout(this.va);this.tick(!1);</span><br><span class="line">if(this.u.length&gt;0)this.u[0].duration=0;this.cb=!1;</span><br><span class="line">clearTimeout(google.clearp);</span><br><span class="line">&#125;;</span><br><span class="line">L.prototype.play=function(a)&#123;</span><br><span class="line">if(google.d || j==5)if(this.duration&gt;28E3)j==5&amp;&amp;F(4);</span><br><span class="line">else&#123;</span><br><span class="line">var b=a||0;b&gt;0&amp;&amp;this.u[b-1].play();</span><br><span class="line">if(b&gt;=this.u.length)j==5&amp;&amp;F(4);</span><br><span class="line">else&#123;var c=this;google.clearp=window.setTimeout(function()&#123;c.play(b+1)&#125;,this.u[b].duration*50)&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">eval(&quot;google.doodle.mod = (function(a,n)&#123;return a&quot;+&quot;%%&quot;.charAt(0)+&quot;n;&#125;)&quot;);</span><br><span class="line">L.prototype.xa=function()&#123;</span><br><span class="line">for(var a=[],b=0;b&lt;this.u.length;++b)a=a.concat(this.u[b].xa());</span><br><span class="line">for(window.bits=a;google.doodle.mod(a.length,8)!=0;)a.push(!1);</span><br><span class="line">return a</span><br><span class="line">&#125;;</span><br><span class="line">L.prototype.eb=function()&#123;</span><br><span class="line">if(this.u.length==0)return g;</span><br><span class="line">var a=&quot;http://www.google.com/webhp?&quot;,b=Va(window.location.toString()).hl;b&amp;&amp;(a+=&quot;hl=&quot;+b+&quot;&amp;&quot;);</span><br><span class="line">a+=&quot;tune=&quot;;</span><br><span class="line">for(var c=this.xa(),b=[],d=0;d&lt;c.length;d+=8)&#123;</span><br><span class="line">for(var e=0,f=0;f&lt;8;++f)e*=2,e|=c[d+f]?1:0;b.push(e)</span><br><span class="line">&#125;</span><br><span class="line">Na();c=V;d=[];</span><br><span class="line">for(e=0;e&lt;b.length;e+=3)&#123;</span><br><span class="line">var i=b[e],n=(f=e+1&lt;b.length)?b[e+1]:0,k=e+2&lt;b.length,l=k?b[e+2]:0,q=i&gt;&gt;2,i=(i&amp;3)*16|n&gt;&gt;4,n=(n&amp;15)*4|l&gt;&gt;6;l&amp;=63;k||(l=64,f||(n=64));d.push(c[q],c[i],c[n],c[l])</span><br><span class="line">&#125;return a+d.join(&quot;&quot;)</span><br><span class="line">&#125;;</span><br><span class="line">var Va=function(a)&#123;</span><br><span class="line">if(!a)return&#123;&#125;;</span><br><span class="line">for(var a=a.match(/\?[^#]*/),a=(a&amp;&amp;a.length&gt;0?a[0].substr(1):&quot;&quot;).split(&quot;&amp;&quot;),b=&#123;&#125;,c=0;c&lt;a.length;++c)&#123;var d=a[c];d&amp;&amp;(d=d.split(&quot;=&quot;),b[d[0]]=d[1]||&quot;&quot;)&#125;</span><br><span class="line">return b</span><br><span class="line">&#125;,</span><br><span class="line">Ia=function()&#123;</span><br><span class="line">var a=Va(window.location.href),b=parseInt(a.bpm,10),a=a.tune;b&amp;&amp;a&amp;&amp;Ma(b,unescape(a));</span><br><span class="line">if(a)&#123;</span><br><span class="line">Na();for(var c=W,b=[],d=0;d&lt;a.length;)&#123;var e=c[a.charAt(d++)],f=d&lt;a.length?c[a.charAt(d)]:0;++d;var i=d&lt;a.length?c[a.charAt(d)]:0;++d;var n=d&lt;a.length?c[a.charAt(d)]:0;++d;if(e==g||f==g||i==g||n==g)throw Error();b.push(e*4|f&gt;&gt;4);i!=64&amp;&amp;(b.push(f*16&amp;240|i&gt;&gt;2),n!=64&amp;&amp;b.push(i*64&amp;192|n))&#125;a=[];</span><br><span class="line">for(c=0;c&lt;b.length;++c)&#123;d=b[c];for(e=0;e&lt;8;++e)a.push(!!(d&amp;128)),d*=2&#125;</span><br><span class="line">if(a)&#123;var k;a:&#123;b=[];c=0;try&#123;for(;a.length-c&gt;=8;)&#123;var l=Qa(a,c);if(l)b.push(l.s),c+=l.n;else&#123;k=g;break a&#125;&#125;&#125;catch(q)&#123;k=g;break a&#125;k=new L(b)&#125;k&amp;&amp;(A=k,F(5),k.play())&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">Wa=!0,</span><br><span class="line">Xa=function()&#123;</span><br><span class="line">if(google.rein&amp;&amp;google.dstr&amp;&amp;!google.doodle.jb)google.doodle.jb=!0,google.rein.push(Xa),google.dstr.push($);</span><br><span class="line">if(document.getElementById(&quot;hplogo&quot;))&#123;</span><br><span class="line">$();google.psy&amp;&amp;google.psy.q&amp;&amp;google.msg&amp;&amp;google.msg.listen(22,function()&#123;$();return!0&#125;);google.doodle.url=na;p=document.getElementById(&quot;hplogo-g&quot;);</span><br><span class="line">v=document.createElement(&quot;canvas&quot;);</span><br><span class="line">v.getContext?(v.width=474,v.height=175,v.hideFocus=!0,ca=v.getContext(&quot;2d&quot;),p.appendChild(v)):v=g;xa();o=new Ca(ca,p);</span><br><span class="line">var a;r=!1;Ja();</span><br><span class="line">if(!aa||!Ka())a=!1;else&#123;</span><br><span class="line">google.doodle.flashLoaded=Ha;t=document.createElement(&quot;iframe&quot;);t.name=&quot;doodle-sound&quot;;t.style.position=&quot;absolute&quot;;t.style.top=&quot;-150px&quot;;t.style.border=0;t.style.width=&quot;100px&quot;;t.style.height=&quot;100px&quot;;document.getElementById(&quot;hplogo&quot;).appendChild(t);u=t.contentDocument;if(u==void 0||u==g)u=t.contentWindow.document;u.open();u.write(&quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;object classid=\&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\&quot; codebase=\&quot;http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0\&quot; width=\&quot;0\&quot; height=\&quot;0\&quot; id=\&quot;guitar11-sound-player\&quot; type=\&quot;application/x-shockwave-flash\&quot;&gt;&lt;param name=\&quot;movie\&quot; value=\&quot;http://www.cssass.com/blog/resource/guitar/guitar11.swf\&quot;&gt;&lt;param name=\&quot;allowScriptAccess\&quot; value=\&quot;always\&quot;&gt;&lt;object id=\&quot;guitar11-sound-player-2\&quot; type=\&quot;application/x-shockwave-flash\&quot; data=\&quot;http://www.cssass.com/blog/resource/guitar/guitar11.swf\&quot; width=\&quot;0\&quot; height=\&quot;0\&quot;&gt;&lt;param name=\&quot;allowScriptAccess\&quot; value=\&quot;always\&quot;&gt;&lt;/object&gt;&lt;/object&gt;&lt;/body&gt;&lt;/html&gt;&quot;);u.close();a=!0</span><br><span class="line">&#125;</span><br><span class="line">var b=document.getElementById(&quot;hplogot&quot;);</span><br><span class="line">b&amp;&amp;(sa=typeof b.style.opacity!=&quot;undefined&quot;);za();m=!0;Ya();!a&amp;&amp;Wa&amp;&amp;Ia();Wa=!1;ra();</span><br><span class="line">if(ea)try&#123;document.execCommand(&quot;BackgroundImageCache&quot;,!1,!0)&#125;catch(c)&#123;&#125;</span><br><span class="line">&#125;&#125;,</span><br><span class="line">Ya=function()&#123;</span><br><span class="line">o&amp;&amp;(o.kb(),da=window.setTimeout(Ya,30));</span><br><span class="line">var a=document.getElementById(&quot;hplogo-led&quot;);</span><br><span class="line">if(a&amp;&amp;G)a.style.backgroundPosition=-540-23*Math.abs(Math.round(5*Math.sin(G*Math.PI/12)))+&quot;px -139px&quot;,G++</span><br><span class="line">&#125;,</span><br><span class="line">K=function()&#123;</span><br><span class="line">var a=document.getElementById(&quot;hplogo-led&quot;);if(a)a.style.backgroundPosition=&quot;1000px 1000px&quot;&#125;,</span><br><span class="line">$=function()&#123;</span><br><span class="line">try&#123;window.clearTimeout(da);O();Fa();ja();o&amp;&amp;(o.ya(),o=g);t&amp;&amp;(C(t),t=g,r=!1);v&amp;&amp;(C(v),v=g);A&amp;&amp;A.stop();B=A=g;F(0);var a=document.getElementById(&quot;hplogo-lcd-text&quot;);if(a)a.value=&quot;&quot;;var b=document.getElementById(&quot;hplogo-lcd-screen&quot;);if(b)b.style.backgroundPosition=&quot;1000px 1000px&quot;;K();google.msg&amp;&amp;window.setTimeout(function()&#123;google.msg.unlisten(22,$)&#125;,0)&#125;catch(c)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Xa()</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>可以运行以上代码，也可以访问这个链接：<a href="http://www.cssass.com/blog/resource/guitar/">http://www.cssass.com/blog/resource/guitar/</a></p><p>最后罗列一些网上收集的曲谱：<br>欢乐颂：</p><p>uuiooiuyttyuuyy uuiooiuyttyuytt yyutyuiutyuiuytyw uuiooiuyttyuytt</p><p>爱情买卖：</p><p>3688368 77653 2226235 37753 3688368 00989 00989987 53566</p><p>茉莉花：</p><p>eetyiiyttyt eetyiiyttyt tttetyyt ewetewqqwq ewqwetyit ewetewqqwq</p><p>义勇军进行曲：</p><p>qr rrrqwer r yrtyi i yyryiytt o i t y iy iytyr y qwrryyiittw t qr ry yi rtiio i yriiiy r q r yriiiy r q r q r q r r</p><p>沧海一声笑:</p><p>pouyt uytew wewetyuopppou</p><p>童年：</p><p>35553 6676 66588886865 355536676 66658888668 9~</p><p>上海滩：</p><p>356666，352222，356865132</p><p>一闪一闪亮晶晶</p><p>1155665 4433221 5544332 5544332 1155665 4433221；</p><p>天空之城</p><p>6787807 365685 254573 874477 6787807 365685 34878908 876756 1232352<br>5878007 678789855 43213 376321 21253 376321 21276</p><p>春江花月夜</p><p>H-HHK-LHG～G-G-H-KLD～D-SDG-DGH～KL-;-K-L;LKH-G～</p><p>隐形的翅膀</p><p>358787 6568321 11186532122 358787 6568321 1118653211</p><p>可以复制曲谱到文本框中直接播放。欢迎读者提供更精彩的乐谱。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在6月9号Google 放出的纪念电吉他之父莱斯·保罗 96 周年诞辰的电吉他Doodle代码上，扩展了这个可播放曲谱的版本。&lt;br&gt;做这个扩展版的初衷是为了方便不是很熟悉键盘的童鞋。&lt;br&gt;童鞋们可以从网上复制曲谱进来自动播放（如果读者能自己谱曲，那真的就太棒了）。&lt;br</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>如何获取窗口高度、页面高度——解读各浏览器盒模型下的窗口、页面文档尺寸</title>
    <link href="https://www.cssass.com/2011/06/08/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%AA%97%E5%8F%A3%E9%AB%98%E5%BA%A6%E3%80%81%E9%A1%B5%E9%9D%A2%E9%AB%98%E5%BA%A6%E2%80%94%E2%80%94%E8%A7%A3%E8%AF%BB%E5%90%84%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9B%92%E6%A8%A1%E5%9E%8B%E4%B8%8B%E7%9A%84%E7%AA%97%E5%8F%A3%E3%80%81%E9%A1%B5%E9%9D%A2%E6%96%87%E6%A1%A3%E5%B0%BA%E5%AF%B8/"/>
    <id>https://www.cssass.com/2011/06/08/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%AA%97%E5%8F%A3%E9%AB%98%E5%BA%A6%E3%80%81%E9%A1%B5%E9%9D%A2%E9%AB%98%E5%BA%A6%E2%80%94%E2%80%94%E8%A7%A3%E8%AF%BB%E5%90%84%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9B%92%E6%A8%A1%E5%9E%8B%E4%B8%8B%E7%9A%84%E7%AA%97%E5%8F%A3%E3%80%81%E9%A1%B5%E9%9D%A2%E6%96%87%E6%A1%A3%E5%B0%BA%E5%AF%B8/</id>
    <published>2011-06-08T03:05:12.000Z</published>
    <updated>2023-06-29T03:05:57.984Z</updated>
    
    <content type="html"><![CDATA[<p>获取页面高度或窗口高度，是使用绝对层定位（弹出菜单定位，遮罩层尺寸设置）所经常用到的。<br>但是各个浏览器在这方面的效果却有着非常大的差异，本文将做一些总结，找出一些全兼容的方法来获取页面的高度，窗口的高度，页面文档的高度，滚动条滚过的距离，以方便今后使用。</p><p>开始之前，先提一些常识性的东西：<br>documentElement的对象元素就是html节点。<br>offsetHeight包括了clientHeight和border。<br>scrollHeight包括了滚动内的高度。<br>页面文档的高度指的是页面内实际内容的高度。</p><p>下面的demo中，我们将页面的内容设置为2000*1000px的尺寸。<br>此处没有对html,body做过width，height设置，否则将有所不同。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html &gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;各种浏览器盒模型下的窗口尺寸,页面文档尺寸&lt;/title&gt;</span><br><span class="line">&lt;meta name=&quot;author&quot; content=&quot;http://www.cssass.com/blog/index.php/2011/1048.html&quot; /&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">*&#123;padding:0;margin:0;&#125;</span><br><span class="line">body&#123;font-size:14px;line-height:1.8&#125;</span><br><span class="line">h3&#123;padding-top:15px;&#125;</span><br><span class="line">b&#123;color:#c00;&#125;</span><br><span class="line">em&#123;font-style:normal;text-decoration:underline;font-size:16px;&#125;</span><br><span class="line">strong&#123;font-size:16px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body &gt;</span><br><span class="line">&lt;div style=&#x27;height:1000px;width:2000px;&#x27;&gt;</span><br><span class="line">&lt;h3&gt;取得窗口的宽度：&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;试试body的offsetWidth</span><br><span class="line">&lt;button onclick=&quot;alert(document.body.offsetWidth)&quot;&gt;body节点的offsetWidth&lt;/button&gt;</span><br><span class="line">&lt;p&gt;但&lt;b&gt;ie6&lt;/b&gt;下body的offsetWidth值并不是窗口宽度，还包括了滚动条，成了整个页面的宽度——ie6的Box模型特殊。</span><br><span class="line">&lt;p&gt;所以通用的是&lt;em&gt;documentElement的offsetWidth&lt;/em&gt;</span><br><span class="line">&lt;button onclick=&quot;alert(document.documentElement.offsetWidth)&quot;&gt;&lt;strong&gt;&amp;lt;html&amp;gt;的offsetWidth&lt;/strong&gt;&lt;/button&gt;</span><br><span class="line">&lt;h3&gt;取得页面文档的宽度：&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;试试body的scrollWidth</span><br><span class="line">&lt;button onclick=&quot;alert(document.body.scrollWidth)&quot;&gt;body的scrollWidth&lt;/button&gt;</span><br><span class="line">&lt;p&gt;但在&lt;b&gt;firefox&lt;/b&gt;和&lt;b&gt;opera&lt;/b&gt;下body的scrollWidth却等于窗口宽度，并不是整个页面的宽度。</span><br><span class="line">&lt;p&gt;所以通用的是&lt;em&gt;documentElement的scrollWidth&lt;/em&gt;</span><br><span class="line">&lt;button onclick=&quot;alert(document.documentElement.scrollWidth)&quot;&gt;&lt;strong&gt;&amp;lt;html&amp;gt;的scrollWidth&lt;/strong&gt;&lt;/button&gt;</span><br><span class="line">&lt;h3&gt;取得窗口的高度：&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;先使用body的offsetHeight</span><br><span class="line">&lt;button onclick=&quot;alert(document.body.offsetHeight)&quot;&gt;body的offsetHeight&lt;/button&gt;</span><br><span class="line">&lt;p&gt;&lt;b&gt;所有浏览器&lt;/b&gt;都表示这是页面文档的高度。</span><br><span class="line">&lt;p&gt;使用documentElement的offsetHeight</span><br><span class="line">&lt;button onclick=&quot;alert(document.documentElement.offsetHeight)&quot;&gt;html的offsetHeight&lt;/button&gt;</span><br><span class="line">&lt;p&gt;除&lt;b&gt;ie之外，所有浏览器&lt;/b&gt;仍然表示这是页面文档的高度</span><br><span class="line">&lt;p&gt;试试documentElement的clientHeight&lt;button onclick=&quot;alert(document.documentElement.clientHeight)&quot;&gt;&lt;strong&gt;&amp;lt;html&amp;gt;的clientHeight&lt;/strong&gt;&lt;/button&gt;</span><br><span class="line">没错，窗口高度就得使用&lt;em&gt;documentElement的clientHeight&lt;/em&gt;</span><br><span class="line">&lt;h3&gt;取得页面文档的高度(注意，页面文档高度可以小于窗口高度)：&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;&lt;button onclick=&quot;alert(document.body.offsetHeight)&quot;&gt;body的offsetHeight&lt;/button&gt;</span><br><span class="line">&lt;button onclick=&quot;alert(document.body.scrollHeight)&quot;&gt;body的scrollHeight&lt;/button&gt;</span><br><span class="line">&lt;button onclick=&quot;alert(document.documentElement.scrollHeight)&quot;&gt;html的scrollHeight&lt;/button&gt;</span><br><span class="line">&lt;p&gt;似乎三者都等于页面高度,但当页面文档高度小于窗口尺寸时，&lt;b&gt;ie8&lt;/b&gt;下html的scrollHeight,&lt;b&gt;webkit&lt;/b&gt;下body的scrollHeight的值会等于窗口的高度。（这里的demo就不写了）</span><br><span class="line">&lt;p&gt;所以需使用&lt;em&gt;body的offsetHeight&lt;/em&gt;&lt;button onclick=&quot;alert(document.body.offsetHeight)&quot;&gt;&lt;strong&gt;&amp;lt;body&amp;gt;的offsetHeight&lt;/strong&gt;&lt;/button&gt;</span><br><span class="line">&lt;p&gt;（假如你想获取的是整个页面的高度，而不是说只是页面文档的高度，那可以在窗口高度&lt;em&gt;documentElement.clientHeight和页面文档高度body.offsetHeight之间取较大值&lt;/em&gt;。）</span><br><span class="line">&lt;h3&gt;取得窗口滚过的高度/宽度&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;先用documentElement的scrollTop</span><br><span class="line">&lt;button onclick=&quot;window.scrollTo(100,200);alert(document.documentElement.scrollTop)&quot;&gt;documentElement的scrollTop&lt;/button&gt;</span><br><span class="line">&lt;p&gt;发现webkit内核的浏览器&lt;b&gt;chrome&lt;/b&gt;和&lt;b&gt;safari&lt;/b&gt;下的值始终为0，其他浏览器如我所愿。</span><br><span class="line">&lt;p&gt;使用body的scrollTop</span><br><span class="line">&lt;button onclick=&quot;window.scrollTo(100,200);alert(document.body.scrollTop)&quot;&gt;body的scrollTop&lt;/button&gt;</span><br><span class="line">&lt;p&gt;浏览器表现则恰恰相反</span><br><span class="line">&lt;p&gt;所以需要兼容二者&lt;button onclick=&quot;window.scrollTo(100,200);alert(document.body.scrollTop || document.documentElement.scrollTop)&quot;&gt;&lt;strong&gt;document.body.scrollTop || document.documentElement.scrollTop&lt;/strong&gt;&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;获取页面高度或窗口高度，是使用绝对层定位（弹出菜单定位，遮罩层尺寸设置）所经常用到的。&lt;br&gt;但是各个浏览器在这方面的效果却有着非常大的差异，本文将做一些总结，找出一些全兼容的方法来获取页面的高度，窗口的高度，页面文档的高度，滚动条滚过的距离，以方便今后使用。&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>浅析圆形物体的碰撞检测及应用</title>
    <link href="https://www.cssass.com/2011/03/16/%E6%B5%85%E6%9E%90%E5%9C%86%E5%BD%A2%E7%89%A9%E4%BD%93%E7%9A%84%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
    <id>https://www.cssass.com/2011/03/16/%E6%B5%85%E6%9E%90%E5%9C%86%E5%BD%A2%E7%89%A9%E4%BD%93%E7%9A%84%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B%E5%8F%8A%E5%BA%94%E7%94%A8/</id>
    <published>2011-03-16T02:59:41.000Z</published>
    <updated>2023-06-29T03:02:41.089Z</updated>
    
    <content type="html"><![CDATA[<p>物体的碰撞检测是游戏动画中常涉及的内容，当然我没做过游戏，只是最近接触canvas比较多，也有不少热衷html5的canvas的人提起了这个碰撞检测，所以试着拿网上一位大牛的canvas检测算法做些分析注释。<br>先引用些链接：<br>重力版google：<a href="http://mrdoob.com/projects/chromeexperiments/google_gravity/%E2%80%94%E2%80%94%E9%9D%9E%E8%A7%84%E5%88%99%E7%89%A9%E4%BD%93%E7%9A%84%E7%A2%B0%E6%92%9E%E3%80%82">http://mrdoob.com/projects/chromeexperiments/google_gravity/——非规则物体的碰撞。</a><br>可融性水滴：<a href="http://hakim.se/experiments/html5/blob/03/%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E7%89%A9%E4%BD%93%E7%94%B1%E5%A4%9A%E4%B8%AA%E7%82%B9%E8%BF%9E%E6%8E%A5%E6%9E%84%E6%88%90%E3%80%82">http://hakim.se/experiments/html5/blob/03/——一个物体由多个点连接构成。</a></p><p>本文涉及的一个碰撞检测方法是针对于圆形物体的。显然这是比较有规律可循的，但也不要小看圆形物体的碰撞检测，一些非规则物体也可以包围球的形式使用圆形检测来检测。<br>代码来自：<a href="http://www.benjoffe.com/es/code/demos/collide/">http://www.benjoffe.com/es/code/demos/collide/</a><br>本文做了一些中文翻译，并会稍加分析。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&#x27;UTF-8&#x27; /&gt;</span><br><span class="line">&lt;title&gt;圆形物体碰撞检测&lt;/title&gt;</span><br><span class="line">&lt;meta name=&quot;author&quot; content=&quot;Benjamin Joffe&quot; /&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">#balls &#123; border: 1px solid #000;box-shadow: 0 1px 5px #777;-moz-box-shadow: 0 1px 5px #777;-webkit-box-shadow: 0 1px 5px #777;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;balls&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;请使用非ie浏览器，当然ie9也行&lt;/canvas&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">// Coliding Discs experiment</span><br><span class="line">// Copyright Benjamin Joffe, 2010</span><br><span class="line">// 中文注释:ONEBOYS &gt;&gt; http://www.cssass.com</span><br><span class="line">    var canvas = document.getElementById(&#x27;balls&#x27;);</span><br><span class="line">    var ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">    var co = [];</span><br><span class="line">    var starter = Math.random()*9 &gt;&gt; 0; //白球序号（随机值用右移位实现去尾取整）</span><br><span class="line">    for (var i=0; i&lt;9; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        co[i] = &#123;  //折行排列(x,y)</span><br><span class="line">            x: (760/3)*(0.5+i%3),</span><br><span class="line">            y: (760/3)*(0.5+((i/3)&gt;&gt;0)),</span><br><span class="line">            r: 2*(i*2+15),</span><br><span class="line">c: starter==i ? &#x27;#fff&#x27; : &#x27;#000&#x27;</span><br><span class="line">        &#125;;</span><br><span class="line">        // 随机速度（保证向量长度为1）</span><br><span class="line">        co[i].vx = 1-2*Math.random();</span><br><span class="line">        co[i].vy = Math.sqrt(1-co[i].vx*co[i].vx) * ( Math.random() &lt; 0.5 ? -1 : 1 );</span><br><span class="line">        // 起始阶段除白球外其他球保持静止。半径越小，i值越大，速度越大。</span><br><span class="line">        co[i].vx *= i==starter ? 200/co[i].r : 0;</span><br><span class="line">        co[i].vy *= i==starter ? 200/co[i].r : 0;</span><br><span class="line">    &#125;</span><br><span class="line">    function draw()</span><br><span class="line">    &#123;</span><br><span class="line">        ctx.fillStyle=&#x27;rgba(220,220,220,0.5)&#x27;;</span><br><span class="line">        ctx.fillRect(0,0,canvas.width, canvas.height); //涂白清屏（带透明度）</span><br><span class="line">        for (i=0; i&lt;co.length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">ctx.fillStyle=co[i].c;</span><br><span class="line">            ctx.beginPath();</span><br><span class="line">            ctx.moveTo(co[i].x+co[i].r, co[i].y);</span><br><span class="line">            ctx.arc(co[i].x, co[i].y, co[i].r, 0, Math.PI*2, true);</span><br><span class="line">            ctx.fill();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function move()</span><br><span class="line">    &#123;</span><br><span class="line">        var total_time_left = 5;</span><br><span class="line">        var t=0;</span><br><span class="line">        var col_index; // 肇事球</span><br><span class="line">        var col_index2 // 被撞球</span><br><span class="line">        var col_time; // 距离发生碰撞的时间</span><br><span class="line">        var ball_time; // 碰撞倒计时</span><br><span class="line">        var temp;</span><br><span class="line">        var i, j, test_method;</span><br><span class="line">        var col_method; //碰撞方式</span><br><span class="line">        while (true)</span><br><span class="line">        &#123;</span><br><span class="line">            col_index = -1; // choose an invalid index initially</span><br><span class="line">            col_time = total_time_left;</span><br><span class="line">            // this loop finds the ball that will collide first</span><br><span class="line">            for (i=0; i&lt;co.length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                // (god forbid) 若发生了灵异现象，超出了屏幕，立即反向。</span><br><span class="line">                if (co[i].vx &lt; 0 &amp;&amp; co[i].x &lt; co[i].r || co[i].vx &gt; 0 &amp;&amp; co[i].x + co[i].r &gt; canvas.width)</span><br><span class="line">                &#123;</span><br><span class="line">                    co[i].vx *= -1;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                if (co[i].vy &lt; 0 &amp;&amp; co[i].y &lt; co[i].r || co[i].vy &gt; 0 &amp;&amp; co[i].y + co[i].r &gt; canvas.height)</span><br><span class="line">                &#123;</span><br><span class="line">                    co[i].vy *= -1;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                // now for the real collision checks</span><br><span class="line">                // 球与墙之间检测</span><br><span class="line">                for (test_method = 0; test_method &lt; 4; test_method++ )</span><br><span class="line">                &#123;</span><br><span class="line">                    switch (test_method)</span><br><span class="line">                    &#123;</span><br><span class="line">                        case 0 :</span><br><span class="line">                            ball_time = (co[i].r - co[i].x) / co[i].vx; //球与左壁发生碰撞的倒计时</span><br><span class="line">                            break;</span><br><span class="line">                        case 1 :</span><br><span class="line">                            ball_time = (co[i].r - co[i].y) / co[i].vy; // top wall</span><br><span class="line">                            break;</span><br><span class="line">                        case 2 :</span><br><span class="line">                            ball_time = (canvas.width - co[i].r - co[i].x) / co[i].vx; // right wall</span><br><span class="line">                            break;</span><br><span class="line">                        case 3 :</span><br><span class="line">                            ball_time = (canvas.height - co[i].r - co[i].y) / co[i].vy; // bottom wall</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (ball_time &gt; 0 &amp;&amp; ball_time &lt; col_time) //碰撞时间为正值，且小于之前算出的碰撞时间（求出最迫切的碰撞）。</span><br><span class="line">                    &#123;</span><br><span class="line">                        col_time = ball_time;</span><br><span class="line">                        col_index = i;</span><br><span class="line">                        col_method = test_method;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                // 球球之间检测(检测第i球与后面所有球)</span><br><span class="line">                for (j = i+1; j &lt; co.length; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    ball_time = check_collision(co[i], co[j]);  /* **球球检测算法** */</span><br><span class="line">                    if (ball_time &gt; 0 &amp;&amp; ball_time &lt; col_time)</span><br><span class="line">                    &#123;</span><br><span class="line">                        col_method = 5;</span><br><span class="line">                        col_time = ball_time;</span><br><span class="line">                        col_index = i;</span><br><span class="line">                        col_index2 = j;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // 增加位移</span><br><span class="line">            for (i=0; i&lt;co.length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                co[i].x += col_time * co[i].vx;</span><br><span class="line">                co[i].y += col_time * co[i].vy;</span><br><span class="line">            &#125;</span><br><span class="line">            if (col_index == -1) break; // 如无碰撞，退出循环</span><br><span class="line">            // 撞到屏幕，反向</span><br><span class="line">            if (col_method == 0 || col_method == 2) // side walls</span><br><span class="line">            &#123;</span><br><span class="line">                co[col_index].vx*=-1;</span><br><span class="line">            &#125;</span><br><span class="line">            if (col_method == 1 || col_method == 3) // top and bottom walls</span><br><span class="line">            &#123;</span><br><span class="line">                co[col_index].vy*=-1;</span><br><span class="line">            &#125;</span><br><span class="line">//球球相撞</span><br><span class="line">            if (col_method == 5)</span><br><span class="line">            &#123;</span><br><span class="line">                apply_collision(co[col_index], co[col_index2]); /* ** 球球碰撞后果 ** */</span><br><span class="line">            &#125;</span><br><span class="line">            total_time_left -= col_time;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 球球相撞检测</span><br><span class="line">     function check_collision(b1, b2)&#123; //返回当b1,b2接触所需要的时间。</span><br><span class="line">var a = b1.x - b2.x,</span><br><span class="line">    b = b1.vx - b2.vx,</span><br><span class="line">    c = b1.y - b2.y,</span><br><span class="line">    d = b1.vy - b2.vy;</span><br><span class="line">// I probably shouldn&#x27;t have crushed the following logic into one line, makes it just a wee bit unreadable 作者在此处做了一些代码混淆。下面3行是我重写的。</span><br><span class="line">//return b==0&amp;&amp;d==0||(c=(b=2*(a*b+c*d)+0*(d=b*b+d*d))*b-4*d*(a*a+c*c-(c=b1.r+b2.r)*c))&lt;0?-1:(-b-Math.sqrt(c))/(2*d);</span><br><span class="line">if(b==0&amp;&amp;d==0 ) return -1;</span><br><span class="line">var p=(a*b+c*d)/(b*b+d*d);</span><br><span class="line">return -p-Math.sqrt(((b1.r+b2.r)*(b1.r+b2.r)-(a*a+c*c))/(b*b+d*d)+p*p);</span><br><span class="line">&#125;</span><br><span class="line">    // 球球相撞处理</span><br><span class="line">    function apply_collision(b1, b2)&#123; //b1,b2已接触</span><br><span class="line">        var</span><br><span class="line">            a = (b2.r * b2.r) / (b1.r * b1.r) ,//半径的平方比（反映质量比）</span><br><span class="line">            b = (b1.y - b2.y) / (b1.x - b2.x) , //球心连线构成的正切值</span><br><span class="line">            c = 2*( (b1.vx - b2.vx) +b* ( b1.vy - b2.vy ) )/((1+b*b)*(1+a)); //改变的速度发生在球心连线上。</span><br><span class="line">        b2.vx += c;</span><br><span class="line">        b2.vy += c*b;</span><br><span class="line">        b1.vx -= c*a;</span><br><span class="line">        b1.vy -= c*a*b;</span><br><span class="line">    &#125;</span><br><span class="line">    setInterval(function()</span><br><span class="line">    &#123;</span><br><span class="line">        move();</span><br><span class="line">        draw();</span><br><span class="line">    &#125;,30);</span><br><span class="line">    draw();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">// Coliding Discs experiment</span><br><span class="line">// Copyright Benjamin Joffe, 2010</span><br><span class="line"> </span><br><span class="line">    var canvas = document.getElementById(&#x27;balls&#x27;);</span><br><span class="line">    var ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">    var co = [];</span><br><span class="line">    var starter = Math.random()*9 &gt;&gt; 0; //白球序号（随机值用右移位实现去尾取整）</span><br><span class="line">    </span><br><span class="line">    for (var i=0; i&lt;9; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        co[i] = &#123;  //折行排列(x,y)</span><br><span class="line">            x: (760/3)*(0.5+i%3),         </span><br><span class="line">            y: (760/3)*(0.5+((i/3)&gt;&gt;0)),   </span><br><span class="line">            r: 2*(i*2+15),             </span><br><span class="line">c: starter==i ? &#x27;#fff&#x27; : &#x27;#000&#x27;</span><br><span class="line">        &#125;;</span><br><span class="line">        // 随机速度（保证向量长度为1）</span><br><span class="line">        co[i].vx = 1-2*Math.random(); </span><br><span class="line">        co[i].vy = Math.sqrt(1-co[i].vx*co[i].vx) * ( Math.random() &lt; 0.5 ? -1 : 1 );</span><br><span class="line">        </span><br><span class="line">        // 起始阶段除白球外其他球保持静止。半径越小，i值越大，速度越大。</span><br><span class="line">        co[i].vx *= i==starter ? 200/co[i].r : 0;</span><br><span class="line">        co[i].vy *= i==starter ? 200/co[i].r : 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function draw()</span><br><span class="line">    &#123;     </span><br><span class="line">        ctx.fillStyle=&#x27;rgba(220,220,220,0.5)&#x27;;</span><br><span class="line">        ctx.fillRect(0,0,canvas.width, canvas.height); //涂白清屏（带透明度）</span><br><span class="line">        for (i=0; i&lt;co.length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">ctx.fillStyle=co[i].c;</span><br><span class="line">            ctx.beginPath();</span><br><span class="line">            ctx.moveTo(co[i].x+co[i].r, co[i].y);</span><br><span class="line">            ctx.arc(co[i].x, co[i].y, co[i].r, 0, Math.PI*2, true);</span><br><span class="line">            ctx.fill();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function move()</span><br><span class="line">    &#123;</span><br><span class="line">        var total_time_left = 5;</span><br><span class="line">        var t=0;</span><br><span class="line">        var col_index; // 肇事球</span><br><span class="line">        var col_index2 // 被撞球</span><br><span class="line">        </span><br><span class="line">        var col_time; // 距离发生碰撞的时间</span><br><span class="line">        var ball_time; // 碰撞倒计时</span><br><span class="line">        var temp;</span><br><span class="line">        </span><br><span class="line">        var i, j, test_method;</span><br><span class="line">        var col_method; //碰撞方式</span><br><span class="line"> </span><br><span class="line">        while (true)</span><br><span class="line">        &#123;</span><br><span class="line">        </span><br><span class="line">            col_index = -1; // choose an invalid index initially</span><br><span class="line">            col_time = total_time_left;</span><br><span class="line">            </span><br><span class="line">            // this loop finds the ball that will collide first</span><br><span class="line">            for (i=0; i&lt;co.length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                // (god forbid) 若发生了灵异现象，超出了屏幕，立即反向。</span><br><span class="line">                if (co[i].vx &lt; 0 &amp;&amp; co[i].x &lt; co[i].r || co[i].vx &gt; 0 &amp;&amp; co[i].x + co[i].r &gt; canvas.width)</span><br><span class="line">                &#123;</span><br><span class="line">                    co[i].vx *= -1;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">          </span><br><span class="line">                if (co[i].vy &lt; 0 &amp;&amp; co[i].y &lt; co[i].r || co[i].vy &gt; 0 &amp;&amp; co[i].y + co[i].r &gt; canvas.height)</span><br><span class="line">                &#123;</span><br><span class="line">                    co[i].vy *= -1;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                // now for the real collision checks</span><br><span class="line">            </span><br><span class="line">                // 球与墙之间检测</span><br><span class="line">                for (test_method = 0; test_method &lt; 4; test_method++ )</span><br><span class="line">                &#123;</span><br><span class="line">                    switch (test_method)</span><br><span class="line">                    &#123;</span><br><span class="line">                        case 0 :</span><br><span class="line">                            ball_time = (co[i].r - co[i].x) / co[i].vx; //球与左壁发生碰撞的倒计时</span><br><span class="line">                            break;</span><br><span class="line">                        case 1 :</span><br><span class="line">                            ball_time = (co[i].r - co[i].y) / co[i].vy; // top wall</span><br><span class="line">                            break;</span><br><span class="line">                        case 2 :</span><br><span class="line">                            ball_time = (canvas.width - co[i].r - co[i].x) / co[i].vx; // right wall</span><br><span class="line">                            break;</span><br><span class="line">                        case 3 :</span><br><span class="line">                            ball_time = (canvas.height - co[i].r - co[i].y) / co[i].vy; // bottom wall</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (ball_time &gt; 0 &amp;&amp; ball_time &lt; col_time) //碰撞时间为正值，且小于之前算出的碰撞时间（求出最迫切的碰撞）。</span><br><span class="line">                    &#123;</span><br><span class="line">                        col_time = ball_time;</span><br><span class="line">                        col_index = i;</span><br><span class="line">                        col_method = test_method;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                                </span><br><span class="line">                // 球球之间检测(检测第i球与后面所有球)</span><br><span class="line">                for (j = i+1; j &lt; co.length; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    ball_time = check_collision(co[i], co[j]);  /* **球球检测算法** */</span><br><span class="line">                    if (ball_time &gt; 0 &amp;&amp; ball_time &lt; col_time)</span><br><span class="line">                    &#123;</span><br><span class="line">                        col_method = 5;</span><br><span class="line">                        col_time = ball_time;</span><br><span class="line">                        col_index = i;</span><br><span class="line">                        col_index2 = j;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 增加位移</span><br><span class="line">            for (i=0; i&lt;co.length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                co[i].x += col_time * co[i].vx;</span><br><span class="line">                co[i].y += col_time * co[i].vy;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            if (col_index == -1) break; // 如无碰撞，退出循环</span><br><span class="line">            </span><br><span class="line">            // 撞到屏幕，反向</span><br><span class="line">            if (col_method == 0 || col_method == 2) // side walls</span><br><span class="line">            &#123;</span><br><span class="line">                co[col_index].vx*=-1;</span><br><span class="line">            &#125;</span><br><span class="line">            if (col_method == 1 || col_method == 3) // top and bottom walls</span><br><span class="line">            &#123;</span><br><span class="line">                co[col_index].vy*=-1;</span><br><span class="line">            &#125;</span><br><span class="line">//球球相撞</span><br><span class="line">            if (col_method == 5)</span><br><span class="line">            &#123;</span><br><span class="line">                apply_collision(co[col_index], co[col_index2]); /* ** 球球碰撞后果 ** */</span><br><span class="line">            &#125;</span><br><span class="line">            total_time_left -= col_time;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 球球相撞检测</span><br><span class="line">     function check_collision(b1, b2)&#123; //返回当b1,b2接触所需要的时间。</span><br><span class="line">var a = b1.x - b2.x,   </span><br><span class="line">    b = b1.vx - b2.vx, </span><br><span class="line">    c = b1.y - b2.y,   </span><br><span class="line">    d = b1.vy - b2.vy;</span><br><span class="line">// I probably shouldn&#x27;t have crushed the following logic into one line, makes it just a wee bit unreadable 作者在此处做了一些代码混淆。下面3行是我重写的。</span><br><span class="line">//return b==0&amp;&amp;d==0||(c=(b=2*(a*b+c*d)+0*(d=b*b+d*d))*b-4*d*(a*a+c*c-(c=b1.r+b2.r)*c))&lt;0?-1:(-b-Math.sqrt(c))/(2*d);</span><br><span class="line">if(b==0&amp;&amp;d==0 ) return -1;</span><br><span class="line">var p=(a*b+c*d)/(b*b+d*d);</span><br><span class="line">return -p-Math.sqrt(((b1.r+b2.r)*(b1.r+b2.r)-(a*a+c*c))/(b*b+d*d)+p*p);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    // 球球相撞处理</span><br><span class="line">    function apply_collision(b1, b2)&#123; //b1,b2已接触</span><br><span class="line">        var</span><br><span class="line">            a = (b2.r * b2.r) / (b1.r * b1.r) , //半径的平方比（反映质量比）</span><br><span class="line">            b = (b1.y - b2.y) / (b1.x - b2.x) , //球心连线构成的正切值</span><br><span class="line">            c = 2*( (b1.vx - b2.vx) +b* ( b1.vy - b2.vy ) )/((1+b*b)*(1+a)); //改变的速度发生在球心连线上。</span><br><span class="line">        b2.vx += c;</span><br><span class="line">        b2.vy += c*b;</span><br><span class="line">        b1.vx -= c*a;</span><br><span class="line">        b1.vy -= c*a*b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setInterval(function()</span><br><span class="line">    &#123;</span><br><span class="line">        move();</span><br><span class="line">        draw();</span><br><span class="line">    &#125;,30);</span><br><span class="line">    draw();</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>再简略说一下两球之间的碰撞检测方法check_collision：<br>当前位置两球的x方向距离为a，y方向距离为c，两球x方向上的相对速度为b，y方向上为d。<br>假设经过时间t之后，两球相撞。<br>此时，两球的距离为（r1+r2），而在x方向上的距离应为(a+bt),y方向上距离为(c+dt)<br>根据直角三角形性质：(a+bt)^2+(c+dt)^2&#x3D;(r1+r2)^2<br>经过数学换算可得：t&#x3D;-(a<em>b+c</em>d)&#x2F;(b<em>b+d</em>d)-Math.sqrt(((b1.r+b2.r)<em>(b1.r+b2.r)-(a</em>a+c<em>c))&#x2F;(b</em>b+d<em>d)+((a</em>b+c<em>d)&#x2F;(b</em>b+d<em>d))</em>((a<em>b+c</em>d)&#x2F;(b<em>b+d</em>d)))<br>如果你不会换算，可以看看这个链接：<a href="http://www.wolframalpha.com/input/?i=(a+b*t)%5E2+(c+d*t)%5E2=(r1+r2)%5E2">http://www.wolframalpha.com/input/?i=(a%2Bb*t)^2%2B(c%2Bd*t)^2%3D(r1%2Br2)^2</a></p><p>碰撞检测符合碰撞条件之后之后，就是碰撞反弹了apply_collision。<br>碰撞问题其实在高中物理中，已经有所学习了。我们要解的这个问题就是一个弹性斜碰撞的问题。<br>这种碰撞符合的定律是：动量守恒（碰撞前后矢量和相等）和动能守恒（碰撞后起码不增加）定律。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;物体的碰撞检测是游戏动画中常涉及的内容，当然我没做过游戏，只是最近接触canvas比较多，也有不少热衷html5的canvas的人提起了这个碰撞检测，所以试着拿网上一位大牛的canvas检测算法做些分析注释。&lt;br&gt;先引用些链接：&lt;br&gt;重力版google：&lt;a href=</summary>
      
    
    
    
    
  </entry>
  
</feed>

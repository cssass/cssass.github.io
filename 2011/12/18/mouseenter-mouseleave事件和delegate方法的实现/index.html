<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <title>
      
        mouseenter/mouseleave事件和delegate方法的实现 | Mr.Drive2Far
      
    </title>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png"/>
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color=""/>
    
    
    <link rel="stylesheet" type="text/css" href="/css/layout.css"/>
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css"/>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"/>

  <!-- hexo injector head_end start --><style type="text/css">.runcode {zoom:1;}
.runcode p{margin:0;}
.runcode_text {display: block;height: 180px;width: 100%;color:#ccc;overflow-x:hidden;letter-spacing:1px;text-shadow:1px 1px 1px #111;font-family:Consolas,Fixedsys;padding:2px;font-size:13px;line-height:1.5em;background:#404040;border:3px inset #eee;}
.runcode_button{border:1px solid #ccc;font-size:16px;font-weight:bold;cursor: pointer;
	border-radius:3px;
	text-shadow:1px 1px 0 #eee;
	box-shadow:1px 0 1px #999;
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#eee, endColorstr=#aaa);
	background: linear-gradient(top, #eee, #ccc ,#aaa,#aaa,#aaa);
	background: -moz-linear-gradient(top, #eee, #ccc ,#aaa,#aaa,#aaa);
	background: -webkit-gradient(linear, 0 0, 0 100% , from(#eee),to(#aaa));
	background: -webkit-linear-gradient(0 0, #eee, #ccc ,#aaa,#aaa,#aaa);
}
</style><script type="text/javascript">var runcode = {};
runcode.open=function(element){
	var code = document.getElementById(element).value;
	var win = window.open("", "", "");
	win.opener = null;
	win.document.write(code);
	win.document.close();
}
runcode.copy=function(element){
	var codeobj = document.getElementById(element) ;
	if (window.clipboardData)
	{	
		window.clipboardData.setData("Text", codeobj.value);
	}else{
		codeobj.select(); 	
		codeobj.setSelectionRange(0, codeobj.value.length);
		document.execCommand('copy');
		setTimeout(function(){
			codeobj.blur()
		},300);
	}
}



</script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Mr.Drive2Far" type="application/atom+xml">
</head>
  <body>
    <div class="head">
      <div class="nav">
        <a href="/" class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg" />
        </a>
        <input id="navBtn" type="checkbox"/>
        <div class="nav-menu">
          
            
              <a class="nav-menu-item" href="/developer">Developer</a>
            
              <a class="nav-menu-item" href="/scientist">Scientist</a>
            
              <a class="nav-menu-item" href="/economic">Economic</a>
            
              <a class="nav-menu-item" href="/essay">闲情偶寄</a>
            
          
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner">
      <div class="post-content__head">
        <div class="post-title">mouseenter/mouseleave事件和delegate方法的实现</div>
        <div class="post-info">
          
  
    <a href="/tags/DOM/" class="post-tag">#DOM</a>
  


          <span class="post-date">2011-12-18</span>
        </div>
      </div>
      <div id="postBody" class="post-content__body">
        <div id="tocAnchor" class="toc-anchor">
          <ol id="toc" class="post-toc">
            
          </ol>
        </div>
        
          <div class="post-gallery">
            
          </div>
        
        <p>众所周知，事件onmouseover和onmouseout有一个极其不好的问题，就是在绑定元素内部的子元素上滑动会反复触发事件，及执行绑定的方法。</p>
<p>而ie在很早的时候有提供了另一对事件：mouseenter和mouseleaver。顾名思义，就是只有当mouse滑进滑出绑定元素的时候，才会触发。</p>
<p>但是，这本来只是ie的私有属性，虽然已属于DOM3 Event草案当中，其他浏览器的支持率并不是很高，目前看来，Opera11.10已提供支持，而Firefox到10.0会提供支持，Webkit的暂无消息。<br>所以，如果想要用，我们得自己动手。</p>
<p>先搞一个通用的事件绑定函数：<br> <p><textarea class="runcode_text" id="runcode_bfbd1774-52c3-493a-b07c-e9613f4b2af0">var addEvent = function( target,type,fn ) {
    if(target.addEventListener)
    {
        target.addEventListener(type,fn,false);
    }
    else if(target.attachEvent)
    {
        target.attachEvent("on" + type,fn);
    }
};
var removeEvent = function(target,type,fn ) {
    if(target.addEventListener)
    {
        target.removeEventListener(type,fn,false);
    }
    else if(target.attachEvent)
    {
        target.detachEvent("on" + type,fn);
    }
};
 </textarea><input type="button" value="Run" class="runcode_button" onclick="runcode.open('runcode_bfbd1774-52c3-493a-b07c-e9613f4b2af0');" />&nbsp;<input type="button" value="Copy" class="runcode_button" onclick="runcode.copy('runcode_bfbd1774-52c3-493a-b07c-e9613f4b2af0');" /></p><br>我们的mouseenter&#x2F;leave是通过mouseover&#x2F;out来实现的，只需屏蔽mouseover&#x2F;out在元素内部触发时的事件传播即可。<br> <p><textarea class="runcode_text" id="runcode_6ebc2ff6-03e3-4b01-be63-557824346ae2"><!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>实现mouseenter、mouseleave事件</title>
<style>
.outer{padding:50px;background:#aaa;}
.inner{height:100px;background:#eee;}
</style>
</head>
<body>
<div id="outer" class="outer">
	只有移进移出外框的时候才执行方法。对内框操作不执行。click点击解除绑定。
	<div id="inner" class="inner"></div>
</div>
</body>
<script>
var $id=function(o){return document.getElementById(o) || o;}
var events = {}
events._mouseFn ={}; //保存“onmouseenter”和“onmouseleave”所绑定的方法
events._mouseHandle = function(fn){
	/* 转换方法，符合条件时才会执行 */
	var func = function(event){
		var target = event.target;
		var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点
		while( parent && parent != this ){
			try{ parent = parent.parentNode; }
			catch(e){break;}
		}
		/* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */
		( parent != this ) && (fn.call(target,event));
	};
	return func;
}
events.addEvent = function( obj,type,fn ) {
	if(obj.addEventListener)
    {
		if(obj.onmouseenter !== undefined){
			//for opera11，firefox10。他们也支持“onmouseenter”和“onmouseleave”，可以直接绑定
			obj.addEventListener(type,fn,false);
			return ;
		}
		if(type=="mouseenter" || type=="mouseleave" ){
			var eType = (type=="mouseenter") ? "mouseover" : "mouseout";
			var fnNew = events._mouseHandle(fn);
			obj.addEventListener(eType,fnNew,false);
			 /* 将方法存入events._mouseFn，以便以后remove */
			if(!events._mouseFn[obj]) events._mouseFn[obj] = {};
			if(!events._mouseFn[obj][eType]) events._mouseFn[obj][eType] = {};
				events._mouseFn[obj][eType][fn] = fnNew;
		}else{
			obj.addEventListener(type,fn,false);
		}
    }else if(obj.attachEvent)
    {
		// for ie
        obj.attachEvent("on" + type,fn);
    }
};
events.removeEvent = function(obj,type,fn ) {
    if(obj.addEventListener)
    {
		if(obj.onmouseenter !== undefined){
			obj.removeEventListener(type,fn,false);
			return ;
		}
		if(type=="mouseenter" || type=="mouseleave" ){
			var eType = (type=="mouseenter") ? "mouseover" : "mouseout";
			if(!events._mouseFn[obj][eType][fn]) return;
			obj.removeEventListener(eType,events._mouseFn[obj][eType][fn],false);
			events._mouseFn[obj][eType][fn] = null;
		}else{
			obj.removeEventListener(type,fn,false);
		}
    }
    else if(obj.attachEvent)
    {
        obj.detachEvent("on" + type,fn);
    }
};
(function(){
	/* 这里是演示demo 绑定解除事件 */
	var outer = $id("outer"),
		inner = $id("inner");
	events.addEvent(outer,"mouseenter",add);
	events.addEvent(outer,"mouseleave",add);
	events.addEvent(outer,"click",remove);
	function add(){
		var e = arguments[0] || window.event;
		var target = e.srcElement || e.target;
		inner.innerHTML = target.id + ' ' + e.type;
	}
	function remove(){
		events.removeEvent(outer,"mouseenter",add);
		events.removeEvent(outer,"mouseleave",add)
		inner.innerHTML = "click";
	}
})()
</script>
 </textarea><input type="button" value="Run" class="runcode_button" onclick="runcode.open('runcode_6ebc2ff6-03e3-4b01-be63-557824346ae2');" />&nbsp;<input type="button" value="Copy" class="runcode_button" onclick="runcode.copy('runcode_6ebc2ff6-03e3-4b01-be63-557824346ae2');" /></p><br>为了解除绑定，我们设计了一个events._mouseFn来保存绑定的方法，在解除操作时读取对应的方法进行解绑。因为事件可以绑定多个方法，我们需要保存对应的方法，以便之后对应解除。<br>当然如果这里如果按面向对象的思路实现，就可以各自保存，而不需要保持在同一个events._mouseFn对象下。但每绑定一个事件，都需实例化一个对象，显得很多余，所以不采用面向对象的模式。</p>
<p>接下来是文章的第二部分，我们来实现下jquery中提供的delegate方法。<br>（delegate是live方法的扩展版。delegate是基于live的，live是基于bind的。在jquery1.7中又被封装进了on方法。1.7中的on方法是一个很辽阔的方法。其实封装的越厉害，效率就越差了，这也是为什么我们选择自己做简单封装的原因，而不是使用jquery已封装好的）。<br>这个方法可以将想要绑定在子级元素上的事件方法，委托绑定在其父级上，用事件传播机制来触发执行。<br>这么做的好处有：<br>1：如果子级有n个并列元素需要绑定，绑子级需要绑n次，而将其绑定在父级上则只需绑定一次，这是很高效的。<br>2：如果子级元素有动态增加的话，新增元素是没有绑定过任何事件方法的。而如果之前选择的是绑定其父级，就不会有这个问题。<br> <p><textarea class="runcode_text" id="runcode_07cbb643-1336-4d71-a4b1-67d39436165a"><!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>delegate委托绑定事件方法的实现</title>
<style>
.outer{padding:50px;background:#aaa;zoom:1;}
.inner{display:block;height:50px;margin:5px;background:#eee;border:1px solid #ccc;}
</style>
</head>
<body>
<div id="outer" class="outer">
	<div id="message">点击下面框体</div>
	<span class="inner">1:</span>
	<span class="inner">2:</span>
	<span class="inner">3:</span>
	<span class="inner">4:</span>
	<span class="inner">5:</span>
	<div id="unbind">点击解除绑定</div>
</div>
</body>
<script>
//一些通用方法
var $id=function(o){return document.getElementById(o) || o;}
var isDOMs = function(target){
	return target.length >= 0 && target !== window && !target.tagName;  //!target.tagName排除FORM,SELECT等元素
};
var hasClass = function(target,className){
	if(!target || !className) return false;
	if(target[0]) target = target[0];
	var pattern = new RegExp("(^|\\s)"+className+"(\\s|$)");
	return pattern.test(target.className);
}
//正式开始
window.events = {}
events._deleFn = {}; //保存delegate所绑定的方法
events._mouseFn ={}; //保存“onmouseenter”和“onmouseleave”所绑定的方法
events._ieFunc = {}; //由于保存在ie下绑定的方法
events._mouseHandle = function(fn){
	/* 实现mouseenter/leave 的转换方法，符合条件时才会执行 */
	var func = function(event){
		var target = event.target;
		var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点
		while( parent && parent != this ){
			try{ parent = parent.parentNode; }
			catch(e){break;}
		}
		/* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */
		( parent != this ) && (fn.call(target,event));
	};
	return func;
}
events._delegateHandle = function(obj,selector,fn){
	/* 实现delegate 的转换方法，符合条件时才会执行 */
	var func = function(event){
		var event = event || window.event;
		var target = event.srcElement || event.target;
		var parent = target;
		function contain(item,elmName){
			if(elmName.split('#')[1]){ //by id
				if(item.id && item.id === elmName.split('#')[1]) return true;
			}
			if(elmName.split('.')[1]){ //by class
				if(hasClass(item, elmName.split('.')[1])) return true;
			}
			if(item.tagName == elmName.toUpperCase())  return true; //by tagname
			return false;
		}
		while(parent){
			/* 如果触发的元素，属于(selector)元素的子级。 */
			if(obj == parent) return false; //触发元素是自己
			if(contain(parent,selector)){
				fn.call(obj,event);
				return;
			}
			parent = parent.parentNode;
		}
	};
	return func;
};
events.addEvent = function(target,type,fn){
	if (!target) return false;
	var add = function(obj){
		if(obj.addEventListener){
			obj.addEventListener(type,fn,false);
		}else{
			// for ie
			if(!events._ieFunc[obj]) events._ieFunc[obj] = {};
			if(!events._ieFunc[obj][type]) events._ieFunc[obj][type] = {};
			events._ieFunc[obj][type][fn] = function(){
				fn.apply(obj,arguments);
			};
			obj.attachEvent("on" + type,events._ieFunc[obj][type][fn]);
		}
	}
	if(isDOMs(target)) {
		for(var i=0, l = target.length; i < l; i++){
			add(target[i])
		}
	}else{
		add(target);
	}
};
events.removeEvent = function(target,type,fn) {
	if (!target) return false;
    var remove = function(obj){
    	if(obj.addEventListener){
			if(obj.onmouseenter !== undefined){
				obj.removeEventListener(type,fn,false);
				return ;
			}
			obj.removeEventListener(type,fn,false);
		}else{
			//for ie
			if(!events._ieFunc[obj] ||!events._ieFunc[obj][type] || !events._ieFunc[obj][type][fn]) return;
			obj.detachEvent("on" + type, events._ieFunc[obj][type][fn],false);
			events._ieFunc[obj][type][fn]={};
		}
    }
    if(isDOMs(target)) {
		for(var i=0, l = target.length; i < l; i++){
			remove(target[i])
		}
	}else{
		remove(target);
	}
};
events.delegate = function(obj,selector,type,fn){
	if (!obj || !selector) return false;
	var fnNew = events._delegateHandle(obj,selector,fn);
	events.addEvent(obj,type,fnNew);
	/* 将绑定的方法存入events._deleFn，以便之后解绑操作 */
	if(!events._deleFn[selector]) events._deleFn[selector] = {};
	if(!events._deleFn[selector][type]) events._deleFn[selector][type] = {};
	events._deleFn[selector][type][fn] = fnNew;
};
events.undelegate = function(obj,selector,type,fn){
	if (!obj || !selector || !events._deleFn[selector]) return false;
	var fnNew = events._deleFn[selector][type][fn];
	if(!fnNew) return;
	events.removeEvent(obj,type,fnNew);
	events._deleFn[selector][type][fn] = null;
};
(function(){
	/* 这里是演示demo*/
	var outer = $id("outer"),
		msg = $id("message");
	var add = function(){
		var e = arguments[0] || window.event;
		var target = e.srcElement || e.target;
		msg.innerHTML =  target.innerHTML + ' ' + e.type;
	}
	function color(){
		msg.style.color = "#c00"
	}
	function remove(){
		events.undelegate(outer,".inner","click",color);
		events.undelegate(outer,"#unbind","click",remove);
		msg.style.color = "#000"
		msg.innerHTML = "已解除绑定color方法.add方法仍在";
	}
	events.delegate(outer,".inner","click",add);
	events.delegate(outer,".inner","click",color);
	events.delegate(outer,"#unbind","click",remove);
})()
</script>
 </textarea><input type="button" value="Run" class="runcode_button" onclick="runcode.open('runcode_07cbb643-1336-4d71-a4b1-67d39436165a');" />&nbsp;<input type="button" value="Copy" class="runcode_button" onclick="runcode.copy('runcode_07cbb643-1336-4d71-a4b1-67d39436165a');" /></p><br>这里的实现思路是这样的：如果触发事件的元素，是你想要绑定的元素的子级（当然他肯定已是委托实际绑定元素的子级），就执行绑定的事件方法，否则方法就不执行，看上去就像方法没绑定过一样。<br>同实现onmouseenter一样，我们也设计了一个events._deleFn来用于后面的解绑方法undelegate的实现。<br>另外针对ie，我们还解决了两个问题：</p>
<ol>
<li>绑定方法内的this指向问题。我们用.apply执行绑定方法来解决。</li>
<li>使用apply调用绑定方法，就必须考虑如何解绑方法。原理和_mouseFn还有_deleFn一样。</li>
</ol>
<p>在使用delegate时，我们同样遇到了mouseover&#x2F;out的问题。<br>我们的解决方案是：不罗嗦，直接将mouseover&#x2F;out处理成mouseenter&#x2F;leave<br> <p><textarea class="runcode_text" id="runcode_c30377c0-ac26-49fc-8ea9-856b7d80c129"><!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>delegate委托绑定事件方法的实现</title>
<style>
.outer{padding:50px;background:#aaa;zoom:1;}
.inner{display:block;height:50px;background:#eee;border:1px solid #ccc;}
</style>
</head>
<body>
<div id="outer" class="outer">
	<div id="message">划过下面框体</div>
	<span class="inner">1:</span>
	<span class="inner">2:</span>
	<span class="inner">3:</span>
	<span class="inner">4:</span>
	<span class="inner">5:</span>
	<div id="unbind">点击解除绑定</div>
</div>
</body>
<script>
var $id=function(o){return document.getElementById(o) || o;}
var isDOMs = function(target){
	return target.length >= 0 && target !== window && !target.tagName;  //!target.tagName排除FORM,SELECT等元素
};
window.events = {}
events._deleFn = {}; //保存delegate所绑定的方法
events._mouseFn ={}; //保存“onmouseenter”和“onmouseleave”所绑定的方法
events._ieFunc = {}; //由于保存在ie下绑定的方法
events._mouseHandle = function(fn){
	/* 实现mouseenter/leave 的转换方法，符合条件时才会执行 */
	var func = function(event){
		var target = event.target;
		var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点
		while( parent && parent != this ){
			try{ parent = parent.parentNode; }
			catch(e){break;}
		}
		/* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */
		( parent != this ) && (fn.call(target,event));
	};
	return func;
}
events._delegateHandle = function(obj,selector,fn){
	/* 实现delegate 的转换方法，符合条件时才会执行 */
	var func = function(event){
		var event = event || window.event;
		var target = event.srcElement || event.target;
		var parent = target;
		function contain(item,elmName){
			if(elmName.split('#')[1]){ //by id
				if(item.id && item.id === elmName.split('#')[1]) return true;
			}
			if(elmName.split('.')[1]){ //by class
				if(hasClass(item, elmName.split('.')[1])) return true;
			}
			if(item.tagName == elmName.toUpperCase())  return true; //by tagname
			return false;
		}
		while(parent){
			/* 如果触发的元素，属于(selector)元素的子级。 */
			if(obj == parent) return false; //触发元素是自己
			if(contain(parent,selector)){
				if(event.type == 'mouseover' || event.type == 'mouseout'){
					/*
					* 将mouseover/out直接处理成mouseenter/leave: 事件相关元素不属于绑定元素的子级，才绑定方法
					*/
					//事件相关元素。ie下使用toElement和fromElement，其他用relatedTarget。
					var related = event.relatedTarget || ((event.type == 'mouseout') ? event.toElement : event.fromElement);
					if(contain(target,selector) || contain(related,selector)) {
						/* 如果，触发元素或相关元素属于绑定元素(selector)。执行方法 */
						fn.call(obj,event);
						return;
					}
					while( related && !contain(related,selector)){
						  related = related.parentNode;
					}
					/* 事件相关元素，不属于绑定元素(selector)的子级，执行方法  */
					!contain(related,selector) && (fn.call(obj,event));
				}else{
					fn.call(obj,event);
				}
				return;
			}
			parent = parent.parentNode;
		}
	};
	return func;
};
events.addEvent = function(target,type,fn){
	if (!target) return false;
	var add = function(obj){
		if(obj.addEventListener){
			if(obj.onmouseenter !== undefined){
				//for opera11，firefox10。他们也支持“onmouseenter”和“onmouseleave”，可以直接绑定
				obj.addEventListener(type,fn,false);
				return ;
			}
			if(type=="mouseenter" || type=="mouseleave" ){
				var eType = (type=="mouseenter") ? "mouseover" : "mouseout";
				var fnNew = events._mouseHandle(fn);
				obj.addEventListener(eType,fnNew,false);
				 /* 将方法存入events._mouseFn，以便以后remove */
				if(!events._mouseFn[obj]) events._mouseFn[obj] = {};
				if(!events._mouseFn[obj][eType]) events._mouseFn[obj][eType] = {};
					events._mouseFn[obj][eType][fn] = fnNew;
			}else{
				obj.addEventListener(type,fn,false);
			}
		}else{
			// for ie
			if(!events._ieFunc[obj]) events._ieFunc[obj] = {};
			if(!events._ieFunc[obj][type]) events._ieFunc[obj][type] = {};
			events._ieFunc[obj][type][fn] = function(){
				fn.apply(obj,arguments);
			};
			obj.attachEvent("on" + type,events._ieFunc[obj][type][fn]);
		}
	}
	if(isDOMs(target)) {
		for(var i=0, l = target.length; i < l; i++){
			add(target[i])
		}
	}else{
		add(target);
	}
};
events.removeEvent = function(target,type,fn) {
	if (!target) return false;
    var remove = function(obj){
    	if(obj.addEventListener){
			if(obj.onmouseenter !== undefined){
				obj.removeEventListener(type,fn,false);
				return ;
			}
			if(type=="mouseenter" || type=="mouseleave" ){
				var eType = (type=="mouseenter") ? "mouseover" : "mouseout";
				if(!events._mouseFn[obj][eType][fn]) return;
				obj.removeEventListener(eType,events._mouseFn[obj][eType][fn],false);
				events._mouseFn[obj][eType][fn]={};
			}else{
				obj.removeEventListener(type,fn,false);
			}
		}else{
			//for ie
			if(!events._ieFunc[obj] ||!events._ieFunc[obj][type] || !events._ieFunc[obj][type][fn]) return;
			obj.detachEvent("on" + type, events._ieFunc[obj][type][fn],false);
			events._ieFunc[obj][type][fn]={};
		}
    }
    if(isDOMs(target)) {
		for(var i=0, l = target.length; i < l; i++){
			remove(target[i])
		}
	}else{
		remove(target);
	}
};
events.delegate = function(obj,selector,type,fn){
	if (!obj || !selector) return false;
	var fnNew = events._delegateHandle(obj,selector,fn);
	events.addEvent(obj,type,fnNew);
	/* 将绑定的方法存入events._deleFn，以便之后解绑操作 */
	if(!events._deleFn[selector]) events._deleFn[selector] = {};
	if(!events._deleFn[selector][type]) events._deleFn[selector][type] = {};
	events._deleFn[selector][type][fn] = fnNew;
};
events.undelegate = function(obj,selector,type,fn){
	if (!obj || !selector || !events._deleFn[selector]) return false;
	var fnNew = events._deleFn[selector][type][fn];
	if(!fnNew) return;
	events.removeEvent(obj,type,fnNew);
	events._deleFn[selector][type][fn] = null;
};
(function(){
	/* 这里是演示demo*/
	var outer = $id("outer"),
		msg = $id("message");
	events.delegate(outer,'span',"mouseover",add);
	events.delegate(outer,'span',"mouseout",add);
	events.delegate(outer,'#unbind',"click",remove);
	function add(){
		var e = arguments[0] || window.event;
		var target = e.srcElement || e.target;
		msg.innerHTML =  target.innerHTML + ' ' + e.type;
	}
	function remove(){
		events.undelegate(outer,'span',"mouseover",add);
		events.undelegate(outer,'span',"mouseout",add);
		events.undelegate(outer,'#unbind',"click",remove);
	}
})()
</script>
 </textarea><input type="button" value="Run" class="runcode_button" onclick="runcode.open('runcode_c30377c0-ac26-49fc-8ea9-856b7d80c129');" />&nbsp;<input type="button" value="Copy" class="runcode_button" onclick="runcode.copy('runcode_c30377c0-ac26-49fc-8ea9-856b7d80c129');" /></p><br>最后，整理一下，封装一个支持mouseenter 和 mouseleave事件，delegate方法 及其他们的解除绑定的方法的 功能函数库。<br> <p><textarea class="runcode_text" id="runcode_a3139a30-fd70-4c0b-8134-524f9bb136ca">window.events = {}
events._deleFn = {}; //保存delegate所绑定的方法   
events._mouseFn ={}; //保存“onmouseenter”和“onmouseleave”所绑定的方法
events._ieFunc = {}; //由于保存在ie下绑定的方法
 
events._mouseHandle = function(fn){
    /* 实现mouseenter/leave 的转换方法，符合条件时才会执行 */
    var func = function(event){
        var target = event.target;
        var parent = event.relatedTarget; //在onmouseover/out操作中，相关的另一个节点
        while( parent && parent != this ){ 
            try{ parent = parent.parentNode; }
            catch(e){break;}
        }
        /* 只有当相关节点的父级不会是绑定的节点时（即二者不是父子的包含关系），才调用fn，否则不做处理 */
        ( parent != this ) && (fn.call(target,event));
    };
    return func;
}
 
events._delegateHandle = function(obj,selector,fn){
    /* 实现delegate 的转换方法，符合条件时才会执行 */
    var func = function(event){
        var event = event || window.event;
        var target = event.srcElement || event.target;
        var parent = target;
        function contain(item,elmName){
            if(elmName.split('#')[1]){ //by id
                if(item.id && item.id === elmName.split('#')[1]) return true;
            } 
            if(elmName.split('.')[1]){ //by class
                if(hasClass(item, elmName.split('.')[1])) return true;
            }
            if(item.tagName == elmName.toUpperCase())  return true; //by tagname
            return false;
        }
 
        while(parent){
            /* 如果触发的元素，属于(selector)元素的子级。 */
            if(obj == parent) return false; //触发元素是自己
            if(contain(parent,selector)){
                if(event.type == 'mouseover' || event.type == 'mouseout'){
                    /*
                    * 将mouseover/out直接处理成mouseenter/leave: 事件相关元素不属于绑定元素的子级，才绑定方法
                    */
                    //事件相关元素。ie下使用toElement和fromElement，其他用relatedTarget。
                    var related = event.relatedTarget || ((event.type == 'mouseout') ? event.toElement : event.fromElement);
                    if(contain(target,selector) || contain(related,selector)) {
                        /* 如果，触发元素或相关元素属于绑定元素(selector)。执行方法 */
                        fn.call(obj,event);
                        return;
                    }
                    while( related && !contain(related,selector)){ 
                          related = related.parentNode;
                    }
                    /* 事件相关元素，不属于绑定元素(selector)的子级，执行方法  */
                    !contain(related,selector) && (fn.call(obj,event));
                }else{
                    fn.call(obj,event);
                }
                return;
            }
            parent = parent.parentNode;   
        }
    };
    return func;
};
 
events.addEvent = function(target,type,fn){
    if (!target) return false;
    var add = function(obj){
        if(obj.addEventListener){   
            if(obj.onmouseenter !== undefined){
                //for opera11，firefox10。他们也支持“onmouseenter”和“onmouseleave”，可以直接绑定
                obj.addEventListener(type,fn,false); 
                return ;
            }
            if(type=="mouseenter" || type=="mouseleave" ){ 
                var eType = (type=="mouseenter") ? "mouseover" : "mouseout";
                var fnNew = events._mouseHandle(fn);
                obj.addEventListener(eType,fnNew,false);
                 /* 将方法存入events._mouseFn，以便以后remove */
                if(!events._mouseFn[obj]) events._mouseFn[obj] = {};
                if(!events._mouseFn[obj][eType]) events._mouseFn[obj][eType] = {};
                    events._mouseFn[obj][eType][fn] = fnNew;
            }else{
                obj.addEventListener(type,fn,false);
            }
        }else{
            // for ie
            if(!events._ieFunc[obj]) events._ieFunc[obj] = {};
            if(!events._ieFunc[obj][type]) events._ieFunc[obj][type] = {};
            events._ieFunc[obj][type][fn] = function(){
                fn.apply(obj,arguments);
            };
            obj.attachEvent("on" + type,events._ieFunc[obj][type][fn]);
        }
    }
    if(isDOMs(target)) {
        for(var i=0, l = target.length; i < l; i++){
            add(target[i])
        }
    }else{
        add(target);
    }
};
 
events.removeEvent = function(target,type,fn) {
    if (!target) return false;
    var remove = function(obj){
        if(obj.addEventListener){   
            if(obj.onmouseenter !== undefined){
                obj.removeEventListener(type,fn,false); 
                return ;
            }
            if(type=="mouseenter" || type=="mouseleave" ){ 
                var eType = (type=="mouseenter") ? "mouseover" : "mouseout";
                if(!events._mouseFn[obj][eType][fn]) return;
                obj.removeEventListener(eType,events._mouseFn[obj][eType][fn],false);
                events._mouseFn[obj][eType][fn]={};
            }else{
                obj.removeEventListener(type,fn,false);
            }
        }else{
            //for ie
            if(!events._ieFunc[obj] ||!events._ieFunc[obj][type] || !events._ieFunc[obj][type][fn]) return;
            obj.detachEvent("on" + type, events._ieFunc[obj][type][fn],false);
            events._ieFunc[obj][type][fn]={};
        }
    }
    if(isDOMs(target)) {
        for(var i=0, l = target.length; i < l; i++){
            remove(target[i])
        }
    }else{
        remove(target);
    }
};
 
events.delegate = function(obj,selector,type,fn){
    if (!obj || !selector) return false;
    var fnNew = events._delegateHandle(obj,selector,fn);
    events.addEvent(obj,type,fnNew);
    /* 将绑定的方法存入events._deleFn，以便之后解绑操作 */
    if(!events._deleFn[selector]) events._deleFn[selector] = {};
    if(!events._deleFn[selector][type]) events._deleFn[selector][type] = {};
    events._deleFn[selector][type][fn] = fnNew;
};
 
events.undelegate = function(obj,selector,type,fn){
    if (!obj || !selector || !events._deleFn[selector]) return false;
    var fnNew = events._deleFn[selector][type][fn];
    if(!fnNew) return;
    events.removeEvent(obj,type,fnNew);
    events._deleFn[selector][type][fn] = null;
};
 </textarea><input type="button" value="Run" class="runcode_button" onclick="runcode.open('runcode_a3139a30-fd70-4c0b-8134-524f9bb136ca');" />&nbsp;<input type="button" value="Copy" class="runcode_button" onclick="runcode.copy('runcode_a3139a30-fd70-4c0b-8134-524f9bb136ca');" /></p></p>

      </div>
    </div>
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2012/01/04/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E7%9A%84%E5%B0%BA%E5%AF%B8%E5%92%8C%E4%BD%8D%E7%BD%AE%E2%80%94%E2%80%94%E4%B8%A4%E4%B8%AA%E5%86%B7%E9%97%A8%E6%96%B9%E6%B3%95/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>如何获取元素的尺寸和位置——两个冷门方法</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2011/10/12/%E7%80%91%E5%B8%83%E6%B5%81%E5%B8%83%E5%B1%80%E5%8F%8A%E6%89%A9%E5%B1%95%E2%80%94%E2%80%94%E6%A0%BC%E5%AD%90%E5%9D%97%E7%9A%84%E6%99%BA%E8%83%BD%E5%A0%86%E7%A0%8C/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
      </div>
      瀑布流布局及扩展——格子块的智能堆砌
    </a>
  
</div>

    
    
      <div id="gitalk-container"></div>
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              <div class="matts">海</div><div class="matts">内</div><div class="matts">存</div><div class="matts">知</div><div class="matts">己</div>
            </div>
          
            <div class="foot-line">
              <div class="matts">天</div><div class="matts">涯</div><div class="matts">若</div><div class="matts">比</div><div class="matts">邻</div>
            </div>
          
        </div>
        <div class="foot__body">
          
            <div class="foot-item">
              <div class="foot-item__head">朋友</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link"
                         height="20px"
                         width="20px"
                         src="/images/icon/icon-link.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">Theme Tranquility</a>
                  </div>
                
                <div class="text">
                  <img alt="link"
                       height="20px"
                       width="20px"
                       src="/images/icon/icon-link+.svg"/>
                  <a class="foot-link"
                     href="mailto:neoxone2@gmail.com?subject=%E7%94%B3%E8%AF%B7%20Hozen.site%20%E7%9A%84%E5%8F%8B%E9%93%BE%E4%BD%8D%E7%BD%AE">
                  申请友链</a>
                </div>
              </div>
            </div>
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/neoxone2">github</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-zh.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://www.zhihu.com/people/neoxone">知乎</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link"
                     height="20px"
                     width="20px"
                     src="/images/icon/icon-email.svg"/>
                <a class="foot-link" href="mailto:neoxone2@gmail.com">neoxone2@gmail.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="https://www.cssass.com">Mr.Drive2Far</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)"
            d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z" />
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)"
            d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z" />
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)"
            d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z" />
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
          &nbsp;&nbsp;
          <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">浙ICP备09004927号</a>
        </div>
      </div>
    </div>
    
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script type="text/javascript">
  const param = JSON.parse('{"enable":true,"owner":"neoxone2","admin":"neoxone2","repo":"https://github.com/neoxone2/hexo_comments.git","clientID":"bc87b42f6b10a638d798","clientSecret":"bf741d0c9c429f37a79b88c8cabc3955ab64af41","distractionFreeMode":false,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN"}')
  param.id = location.pathname
  const gitalk = new Gitalk(param)
  gitalk.render('gitalk-container')
</script>

  
  

  </body>
</html>
